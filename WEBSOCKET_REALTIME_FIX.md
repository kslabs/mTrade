# WebSocket Real-Time Data Fix üîß

**–î–∞—Ç–∞:** 6 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.6

## –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### 1. –ú–∏–≥–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤ ‚ö°
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∞–ª—é—Ç –±–∞–ª–∞–Ω—Å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –º–µ–Ω—è–ª—Å—è –º–µ–∂–¥—É —Ä–µ–∞–ª—å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º –∏ –Ω—É–ª–µ–º.

**–ü—Ä–∏—á–∏–Ω–∞:**
- –§—É–Ω–∫—Ü–∏—è `loadMarketData()` –≤—ã–∑—ã–≤–∞–ª–∞—Å—å –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã –∏ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è –≤—ã–∑—ã–≤–∞–ª–∞ `loadPairBalances()`
- –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∞–ª—é—Ç `loadMarketData()` –≤—ã–∑—ã–≤–∞–ª–∞—Å—å —Å—Ä–∞–∑—É, –Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è WebSocket
- –î–∞–Ω–Ω—ã–µ API –∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º WebSocket —É—Å–ø–µ–≤–∞–ª –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// –£–±—Ä–∞–ª–∏ –≤—ã–∑–æ–≤ loadPairBalances() –∏–∑ loadMarketData()
// –°–æ–∑–¥–∞–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã:
setInterval(loadMarketData, 3000);        // –ö–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è —Å—Ç–∞–∫–∞–Ω–∞
setInterval(loadPairBalances, 30000);     // –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –±–∞–ª–∞–Ω—Å–æ–≤

// –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∞–ª—é—Ç –¥–∞–µ–º –≤—Ä–µ–º—è WebSocket –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è:
setTimeout(() => {
    loadMarketData();
    loadPairBalances();
}, 1500);
```

### 2. –ü—É—Å—Ç–æ–π —Å—Ç–∞–∫–∞–Ω üìä
**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç–∞–∫–∞–Ω –æ—Ä–¥–µ—Ä–æ–≤ –æ—Å—Ç–∞–≤–∞–ª—Å—è –ø—É—Å—Ç—ã–º, –¥–∞–Ω–Ω—ã–µ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –≤ real-time —Ä–µ–∂–∏–º–µ.

**–ü—Ä–∏—á–∏–Ω—ã:**
1. WebSocket –ø–æ–¥–∫–ª—é—á–∞–ª—Å—è, –Ω–æ –¥–∞–Ω–Ω—ã–µ –æ—Ç Gate.io –º–æ–≥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
2. –ù–µ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Å—Ç–∞–∫–∞–Ω–µ
3. –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –∏–Ω–¥–∏–∫–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è WebSocket

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// –î–æ–±–∞–≤–∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞–∫–∞–Ω–∞:
if (data.orderbook && data.orderbook.asks && data.orderbook.bids) {
    updateOrderBook(data.orderbook);
} else {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è
    document.getElementById('orderbookAsks').innerHTML = '<div class="loading">–û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</div>';
    document.getElementById('orderbookBids').innerHTML = '<div class="loading">–û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</div>';
}

// –î–æ–±–∞–≤–∏–ª–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ WebSocket:
<span id="wsStatus">üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket...</span>
```

### 3. –ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π ‚è±Ô∏è
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API –ø–µ—Ä–µ–≥—Ä—É–∂–∞–ª–∏ —Å–∏—Å—Ç–µ–º—É.

**–†–µ—à–µ–Ω–∏–µ - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã:**
- **–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞:** –∫–∞–∂–¥—É—é 1 —Å–µ–∫—É–Ω–¥—É (–¥–ª—è —Ç–æ—á–Ω–æ–≥–æ uptime)
- **–†—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Å—Ç–∞–∫–∞–Ω, —Ü–µ–Ω–∞):** –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã (—á–µ—Ä–µ–∑ WebSocket)
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞:** –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
- **–ë–∞–ª–∞–Ω—Å—ã:** –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ (–Ω–µ –Ω—É–∂–Ω–æ —á–∞—â–µ, –¥–∞–Ω–Ω—ã–µ —Ä–µ–¥–∫–æ –º–µ–Ω—è—é—Ç—Å—è)

## WebSocket Ping-Pong Mechanism

### –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
Gate.io WebSocket —Ç—Ä–µ–±—É–µ—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ ping –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:
- –°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `{"ping": timestamp}`
- –ö–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å `{"pong": timestamp}`

### –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
```python
class GateIOWebSocket:
    def __init__(self):
        self.ping_interval = 20  # –ü–∏–Ω–≥ –∫–∞–∂–¥—ã–µ 20 —Å–µ–∫—É–Ω–¥ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç Gate.io)
        self.last_data_time = time.time()
        self.ping_thread = None
    
    def _ping_loop(self):
        """–û—Ç–ø—Ä–∞–≤–∫–∞ ping –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è"""
        while self.is_running:
            time.sleep(self.ping_interval)
            if self.ws and self.is_running:
                # –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å > 5 —Å–µ–∫—É–Ω–¥, –ø–∏–Ω–≥—É–µ–º —á–∞—â–µ
                time_since_update = time.time() - self.last_data_time
                if time_since_update > 5:
                    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º ping
                    ping_msg = {"time": int(time.time()), "channel": "spot.ping"}
                    self.ws.send(json.dumps(ping_msg))
```

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã ‚úÖ

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. ‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Gate.io
2. ‚úÖ –ü–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
   - `spot.tickers` - —Ç–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã
   - `spot.order_book_update` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞–∫–∞–Ω–∞
   - `spot.trades` - –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–¥–µ–ª–∫–∏
3. ‚úÖ –ë–∞–ª–∞–Ω—Å—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ REST API
4. ‚úÖ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–ª–∞–≤–Ω–æ –±–µ–∑ –º–∏–≥–∞–Ω–∏–π
5. ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∞–ª—é—Ç–∞–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –ß—Ç–æ –Ω—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å:
1. ‚è≥ **–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç Gate.io WebSocket** - —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –Ω–æ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –∏–ª–∏ –≤–æ–æ–±—â–µ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø–∞—Ä
2. ‚è≥ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π ping-pong** - –¥–æ–±–∞–≤–∏—Ç—å –ø–æ—Ç–æ–∫ –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ ping
3. ‚è≥ **Reconnect mechanism** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —Ä–∞–∑—Ä—ã–≤–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
4. ‚è≥ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã WebSocket

### –¢–µ—Å—Ç —á–µ—Ä–µ–∑ API:
```powershell
# 1. –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø–∞—Ä—É
$body = @{ base_currency = "WLD"; quote_currency = "USDT" } | ConvertTo-Json
Invoke-WebRequest -Uri "http://localhost:5000/api/pair/subscribe" -Method POST -ContentType "application/json" -Body $body

# 2. –ü–æ–¥–æ–∂–¥–∞—Ç—å 5-10 —Å–µ–∫—É–Ω–¥

# 3. –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
curl http://localhost:5000/api/pair/data?base_currency=WLD&quote_currency=USDT | ConvertFrom-Json | ConvertTo-Json -Depth 5
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```json
{
  "success": true,
  "pair": "WLD_USDT",
  "data": {
    "ticker": {
      "last": "2.1234",
      ...
    },
    "orderbook": {
      "asks": [[price, amount], ...],
      "bids": [[price, amount], ...]
    },
    "trades": [...]
  }
}
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ üéØ

1. **–û—Ç–ª–∞–¥–∫–∞ WebSocket –¥–∞–Ω–Ω—ã—Ö:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø—Ä–∏—Ö–æ–¥—è—Ç –ª–∏ –¥–∞–Ω–Ω—ã–µ –æ—Ç Gate.io –¥–ª—è –ø–∞—Ä—ã WLD_USDT
   - –ï—Å–ª–∏ –Ω–µ—Ç - –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø–∞—Ä—ã (BTC_USDT, ETH_USDT)
   - –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

2. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è ping-pong:**
   - –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–ª—è ping
   - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª: 20 —Å–µ–∫ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, 10 —Å–µ–∫ –ø—Ä–∏ —Ç–∏—à–∏–Ω–µ

3. **–£–ª—É—á—à–µ–Ω–∏–µ UI:**
   - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∫–∞—á–µ—Å—Ç–≤–∞ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
   - –°—á–µ—Ç—á–∏–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π —Å—Ç–∞–∫–∞–Ω–∞
   - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≥–ª—É–±–∏–Ω—ã —Å—Ç–∞–∫–∞–Ω–∞ (depth chart)

4. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:**
   - –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
   - –£–º–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ (–æ—Ç–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –æ—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–∞—Ä)
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–∂–∞—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```powershell
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
python restart.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
python status.py

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
python stop.py

# –ó–∞–ø—É—Å–∫
python start.py

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ (–µ—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω –≤ —Ç–µ–∫—É—â–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
python mTrade.py
```

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏

- GitHub: –≤–∞—à_—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [WEBSOCKET_GUIDE_v1.5.md](WEBSOCKET_GUIDE_v1.5.md)
- –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: [QUICK_START_v1.5.md](QUICK_START_v1.5.md)

---

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 6 –Ω–æ—è–±—Ä—è 2025  
**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–í–µ—Ä—Å–∏—è:** 1.6 Real-Time Fix
