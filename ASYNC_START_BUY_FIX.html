<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚úÖ ASYNC START BUY - –û–ö–û–ù–ß–ê–¢–ï–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #00c853 0%, #00e676 100%);
            color: white;
            padding: 50px;
            text-align: center;
        }
        .header h1 {
            font-size: 3em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .header p {
            font-size: 1.3em;
            opacity: 0.95;
        }
        .content {
            padding: 40px;
        }
        .section {
            margin-bottom: 40px;
            padding: 35px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 6px solid #667eea;
        }
        .section h2 {
            color: #667eea;
            margin-bottom: 25px;
            font-size: 2em;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .section h3 {
            color: #764ba2;
            margin: 30px 0 20px 0;
            font-size: 1.5em;
        }
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 25px;
            border-radius: 12px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 0.95em;
            line-height: 1.8;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .code-block .comment { color: #6a9955; }
        .code-block .keyword { color: #569cd6; }
        .code-block .string { color: #ce9178; }
        .code-block .function { color: #dcdcaa; }
        .diagram {
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            margin: 25px 0;
            font-family: 'Courier New', monospace;
            white-space: pre;
            overflow-x: auto;
            border: 3px solid #667eea;
            font-size: 0.95em;
            line-height: 1.6;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .success-box {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-left: 6px solid #28a745;
            padding: 25px;
            margin: 25px 0;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.2);
        }
        .error-box {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border-left: 6px solid #dc3545;
            padding: 25px;
            margin: 25px 0;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.2);
        }
        .warning-box {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-left: 6px solid #ffc107;
            padding: 25px;
            margin: 25px 0;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.2);
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin: 25px 0;
        }
        .comparison-item {
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .comparison-item.before {
            background: #ffe5e5;
            border: 3px solid #dc3545;
        }
        .comparison-item.after {
            background: #e5ffe5;
            border: 3px solid #28a745;
        }
        .comparison-item h4 {
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        .badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            margin: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .badge-success { background: #28a745; color: white; }
        .badge-fire { background: #ff6b6b; color: white; }
        .lifecycle {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin: 25px 0;
            border: 3px dashed #667eea;
        }
        .lifecycle-step {
            padding: 20px;
            margin: 15px 0;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 5px solid #667eea;
            position: relative;
        }
        .lifecycle-step::before {
            content: "‚Üì";
            position: absolute;
            left: 50%;
            bottom: -25px;
            font-size: 2em;
            color: #667eea;
        }
        .lifecycle-step:last-child::before {
            content: "‚Ü∫";
        }
        .footer {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .footer p {
            margin: 10px 0;
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚úÖ ASYNC START BUY</h1>
            <p>–û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å—Ç–∞—Ä—Ç–æ–≤—ã—Ö –ø–æ–∫—É–ø–æ–∫</p>
            <div style="margin-top: 25px;">
                <span class="badge badge-success">RACE CONDITION –£–°–¢–†–ê–ù–Å–ù</span>
                <span class="badge badge-fire">–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ë–ê–ì –ò–°–ü–†–ê–í–õ–ï–ù</span>
                <span class="badge badge-success">ASYNC –ü–û–ö–£–ü–ö–ê –†–ï–ê–õ–ò–ó–û–í–ê–ù–ê</span>
            </div>
        </div>

        <div class="content">
            <!-- –§–ò–ù–ê–õ–¨–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê -->
            <div class="section">
                <h2>üéØ –ü–†–û–ë–õ–ï–ú–ê (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞)</h2>
                
                <div class="error-box">
                    <h3 style="margin: 0 0 15px 0; color: #dc3545;">Lock –æ—Å–≤–æ–±–æ–∂–¥–∞–ª—Å—è –î–û –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è MARKET –æ—Ä–¥–µ—Ä–∞!</h3>
                    <p><strong>–ü—Ä–æ–±–ª–µ–º–∞:</strong> –§–ª–∞–≥ <code>cycle_start_state=1</code> —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è –í–ù–£–¢–†–ò <code>_try_start_cycle()</code>, –Ω–æ Lock –æ—Å–≤–æ–±–æ–∂–¥–∞–ª—Å—è –°–†–ê–ó–£ –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–∞, –µ—â—ë –î–û —Ç–æ–≥–æ –∫–∞–∫ MARKET –æ—Ä–¥–µ—Ä –∏—Å–ø–æ–ª–Ω–∏—Ç—Å—è!</p>
                </div>

                <div class="diagram">
–ò—Ç–µ—Ä–∞—Ü–∏—è 1                      –ò—Ç–µ—Ä–∞—Ü–∏—è 2
-----------                     -----------
Lock.acquire() ‚úÖ
‚îú‚îÄ cycle_start_state = 0 ‚úÖ
‚îú‚îÄ _try_start_cycle()
‚îÇ  ‚îú‚îÄ cycle_start_state = 1 ‚úÖ
‚îÇ  ‚îî‚îÄ MARKET –æ—Ä–¥–µ—Ä ‚è≥ (1-3 —Å–µ–∫)
Lock.release() ‚úÖ               Lock.acquire() ‚úÖ
‚îÇ                               ‚îú‚îÄ cycle_start_state = 1? –ù–ï–¢!
‚îÇ                               ‚îÇ  (—Ñ–∞–π–ª –µ—â—ë –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è)
‚îÇ                               ‚îú‚îÄ cycle_start_state = 0 ‚ùå
MARKET –∑–∞–≤–µ—Ä—à—ë–Ω ‚úÖ              ‚îî‚îÄ –î–£–ë–õ–ò–†–£–Æ–©–ê–Ø –ü–û–ö–£–ü–ö–ê ‚ùå
cycle_start_state = 2 ‚úÖ
                </div>

                <div class="warning-box">
                    <p><strong>–ü—Ä–∏—á–∏–Ω–∞:</strong> –ú–µ–∂–¥—É —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π —Ñ–ª–∞–≥–∞ <code>=1</code> –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ —Ñ–∞–π–ª –ø—Ä–æ—Ö–æ–¥–∏—Ç <strong>1-3 —Å–µ–∫—É–Ω–¥—ã</strong> (–≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è MARKET –æ—Ä–¥–µ—Ä–∞), –∏ –¥—Ä—É–≥–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è —É—Å–ø–µ–≤–∞–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ä–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ <code>=0</code>!</p>
                </div>
            </div>

            <!-- –†–ï–®–ï–ù–ò–ï -->
            <div class="section">
                <h2>üîß –†–ï–®–ï–ù–ò–ï: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø–æ–∫—É–ø–∫–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ</h2>
                
                <div class="success-box">
                    <h3 style="margin: 0 0 15px 0; color: #28a745;">–¢—Ä–∏ –∫–ª—é—á–µ–≤—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è:</h3>
                    <ol style="margin-left: 25px; font-size: 1.1em;">
                        <li><strong>–§–ª–∞–≥ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –°–†–ê–ó–£</strong> (–ø–æ–¥ Lock, –¥–æ –∑–∞–ø—É—Å–∫–∞ –ø–æ—Ç–æ–∫–∞)</li>
                        <li><strong>MARKET –æ—Ä–¥–µ—Ä –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ñ–æ–Ω–µ</strong> (–æ—Ç–¥–µ–ª—å–Ω—ã–π worker-–ø–æ—Ç–æ–∫)</li>
                        <li><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–∞–∂–¥—É—é –∏—Ç–µ—Ä–∞—Ü–∏—é</strong> (–±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)</li>
                    </ol>
                </div>

                <h3>1Ô∏è‚É£ –§–ª–∞–≥ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –°–†–ê–ó–£ (–ø–æ–¥ Lock)</h3>
                <div class="code-block">
<span class="keyword">with</span> self._cycle_locks[base]:
    <span class="comment"># –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–∞ –ê–¢–û–ú–ê–†–ù–û</span>
    <span class="keyword">if</span> cycle_start_state == 0:
        cycle[<span class="string">'cycle_start_state'</span>] = 1  <span class="comment"># –ù–ï–ú–ï–î–õ–ï–ù–ù–û!</span>
        self._save_cycles_state()       <span class="comment"># –°–û–•–†–ê–ù–ï–ù–û!</span>
        
        <span class="comment"># –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–∫—É–ø–∫—É –≤ –û–¢–î–ï–õ–¨–ù–û–ú –ü–û–¢–û–ö–ï</span>
        thread = threading.Thread(<span class="function">target</span>=self._start_buy_worker, ...)
        thread.start()
        
        <span class="comment"># Lock –û–°–í–û–ë–û–ñ–î–ê–ï–¢–°–Ø (–ø–æ–∫—É–ø–∫–∞ –∏–¥—ë—Ç –≤ —Ñ–æ–Ω–µ)</span>
                </div>

                <h3>2Ô∏è‚É£ Lock –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ</h3>
                <ul style="margin-left: 25px; font-size: 1.05em; line-height: 2;">
                    <li>‚úÖ –§–ª–∞–≥ <code>cycle_start_state=1</code> –£–ñ–ï —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω</li>
                    <li>‚úÖ Lock –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ ~10ms (–Ω–µ 1-3 —Å–µ–∫—É–Ω–¥—ã!)</li>
                    <li>‚úÖ –î—Ä—É–≥–∏–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏ –≤–∏–¥—è—Ç <code>=1</code> ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç</li>
                </ul>

                <h3>3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∫–∞–∂–¥—É—é –∏—Ç–µ—Ä–∞—Ü–∏—é</h3>
                <div class="code-block">
<span class="keyword">elif</span> cycle_start_state == 1:
    <span class="comment"># –ü–æ–∫—É–ø–∫–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ - –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
    result = cycle[<span class="string">'start_buy_result'</span>]
    
    <span class="keyword">if</span> result <span class="keyword">is</span> <span class="keyword">None</span>:
        <span class="comment"># –ï—â—ë –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å - –ü–†–û–ü–£–°–ö–ê–ï–ú</span>
        <span class="keyword">return</span>
    
    <span class="keyword">if</span> result[<span class="string">'status'</span>] == <span class="string">'error'</span>:
        <span class="comment"># –û—à–∏–±–∫–∞ - –°–ë–†–ê–°–´–í–ê–ï–ú —Ñ–ª–∞–≥ –≤ 0</span>
        cycle[<span class="string">'cycle_start_state'</span>] = 0
    
    <span class="keyword">if</span> result[<span class="string">'status'</span>] == <span class="string">'success'</span>:
        <span class="comment"># –£—Å–ø–µ—Ö - –ê–ö–¢–ò–í–ò–†–£–ï–ú —Ü–∏–∫–ª (=2)</span>
        cycle[<span class="string">'cycle_start_state'</span>] = 2
        cycle[<span class="string">'active'</span>] = <span class="keyword">True</span>
                </div>
            </div>

            <!-- –ê–†–•–ò–¢–ï–ö–¢–£–†–ê -->
            <div class="section">
                <h2>üìä –ù–û–í–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê</h2>
                
                <div class="comparison">
                    <div class="comparison-item before">
                        <h4>‚ùå –î–û (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø–æ–∫—É–ø–∫–∞)</h4>
                        <ul style="margin-left: 20px;">
                            <li>Lock —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è 1-3 —Å–µ–∫</li>
                            <li>MARKET –æ—Ä–¥–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç</li>
                            <li>–î—Ä—É–≥–∏–µ –≤–∞–ª—é—Ç—ã –∂–¥—É—Ç</li>
                            <li>Race condition –≤–æ–∑–º–æ–∂–µ–Ω</li>
                        </ul>
                    </div>
                    <div class="comparison-item after">
                        <h4>‚úÖ –ü–û–°–õ–ï (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø–æ–∫—É–ø–∫–∞)</h4>
                        <ul style="margin-left: 20px;">
                            <li>Lock —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è ~10ms</li>
                            <li>MARKET –æ—Ä–¥–µ—Ä –≤ —Ñ–æ–Ω–µ</li>
                            <li>–ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</li>
                            <li>Race condition –ù–ï–í–û–ó–ú–û–ñ–ï–ù</li>
                        </ul>
                    </div>
                </div>

                <h3>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ—Ç–æ–¥–æ–≤:</h3>
                <div class="code-block">
<span class="comment"># –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 0.5 —Å–µ–∫</span>
<span class="keyword">def</span> <span class="function">_run</span>(self):
    <span class="keyword">with</span> self._cycle_locks[base]:
        <span class="keyword">if</span> cycle_start_state == 0:
            self._start_cycle_async(base, quote)  <span class="comment"># –ó–∞–ø—É—Å–∫</span>
        <span class="keyword">elif</span> cycle_start_state == 1:
            self._check_start_buy_result(base, quote)  <span class="comment"># –ü—Ä–æ–≤–µ—Ä–∫–∞</span>
        <span class="keyword">elif</span> cycle_start_state == 2:
            self._try_sell(), self._try_rebuy()  <span class="comment"># –¢–æ—Ä–≥–æ–≤–ª—è</span>

<span class="comment"># –ó–∞–ø—É—Å–∫ –ø–æ–∫—É–ø–∫–∏ –≤ —Ñ–æ–Ω–µ</span>
<span class="keyword">def</span> <span class="function">_start_cycle_async</span>(self, base, quote):
    cycle[<span class="string">'cycle_start_state'</span>] = 1
    self._save_cycles_state()  <span class="comment"># –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!</span>
    thread = threading.Thread(<span class="function">target</span>=self._start_buy_worker)
    thread.start()  <span class="comment"># –ü–æ–∫—É–ø–∫–∞ –≤ —Ñ–æ–Ω–µ</span>

<span class="comment"># Worker-–ø–æ—Ç–æ–∫ (–≤—ã–ø–æ–ª–Ω—è–µ—Ç MARKET –æ—Ä–¥–µ—Ä)</span>
<span class="keyword">def</span> <span class="function">_start_buy_worker</span>(self, base, quote):
    result = self._execute_start_buy(base, quote)  <span class="comment"># 1-3 —Å–µ–∫</span>
    cycle[<span class="string">'start_buy_result'</span>] = result  <span class="comment"># –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>

<span class="comment"># –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–∫–∞–∂–¥–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è)</span>
<span class="keyword">def</span> <span class="function">_check_start_buy_result</span>(self, base, quote):
    result = cycle[<span class="string">'start_buy_result'</span>]
    <span class="keyword">if</span> result[<span class="string">'status'</span>] == <span class="string">'success'</span>:
        cycle[<span class="string">'cycle_start_state'</span>] = 2  <span class="comment"># –ê–∫—Ç–∏–≤–∞—Ü–∏—è</span>
                </div>
            </div>

            <!-- –ì–ê–†–ê–ù–¢–ò–ò -->
            <div class="section">
                <h2>‚úÖ –ì–ê–†–ê–ù–¢–ò–ò</h2>
                
                <h3>1. –¢–æ–ª—å–∫–æ –û–î–ù–ê —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞</h3>
                <div class="diagram">
–ò—Ç–µ—Ä–∞—Ü–∏—è 1                      –ò—Ç–µ—Ä–∞—Ü–∏—è 2
-----------                     -----------
Lock.acquire() ‚úÖ
‚îú‚îÄ cycle_start_state = 0 ‚úÖ
‚îú‚îÄ cycle_start_state = 1 ‚úÖ
‚îú‚îÄ _save_cycles_state() ‚úÖ
‚îú‚îÄ thread.start() ‚úÖ
Lock.release() ‚úÖ               Lock.acquire() ‚úÖ
‚îÇ                               ‚îú‚îÄ cycle_start_state = 1 ‚úÖ
Worker: MARKET –æ—Ä–¥–µ—Ä ‚è≥         ‚îî‚îÄ –ü–†–û–ü–£–°–ö–ê–ï–ú ‚úÖ
‚îÇ                               Lock.release() ‚úÖ
Worker: result = success ‚úÖ
‚îÇ
–ò—Ç–µ—Ä–∞—Ü–∏—è 1 (—Å–ª–µ–¥—É—é—â–∞—è)
Lock.acquire() ‚úÖ
‚îú‚îÄ result = success ‚úÖ
‚îú‚îÄ cycle_start_state = 2 ‚úÖ
Lock.release() ‚úÖ
                </div>

                <div class="success-box">
                    <h3 style="margin: 0 0 15px 0;">–ì–∞—Ä–∞–Ω—Ç–∏–∏ —Å–∏—Å—Ç–µ–º—ã:</h3>
                    <ul style="margin-left: 25px; font-size: 1.05em; line-height: 2;">
                        <li>‚úÖ –¢–æ–ª—å–∫–æ –û–î–ù–ê —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞ –Ω–∞ —Ü–∏–∫–ª</li>
                        <li>‚úÖ Lock —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è <50ms (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç)</li>
                        <li>‚úÖ MARKET –æ—Ä–¥–µ—Ä –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ñ–æ–Ω–µ</li>
                        <li>‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–≤—Ç–æ—Ä –ø—Ä–∏ –æ—à–∏–±–∫–µ</li>
                        <li>‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å)</li>
                    </ul>
                </div>
            </div>

            <!-- –ñ–ò–ó–ù–ï–ù–ù–´–ô –¶–ò–ö–õ -->
            <div class="section">
                <h2>üîÑ –ñ–ò–ó–ù–ï–ù–ù–´–ô –¶–ò–ö–õ</h2>
                
                <div class="lifecycle">
                    <div class="lifecycle-step">
                        <strong>0. –ù–ï–¢ –¶–ò–ö–õ–ê</strong><br>
                        cycle_start_state=0, active=False<br>
                        <em>–ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª: _start_cycle_async()</em>
                    </div>
                    <div class="lifecycle-step">
                        <strong>1. –ü–û–ö–£–ü–ö–ê –í –ü–†–û–¶–ï–°–°–ï</strong><br>
                        cycle_start_state=1, start_buy_result=None<br>
                        <em>Worker: –≤—ã–ø–æ–ª–Ω—è–µ—Ç MARKET –æ—Ä–¥–µ—Ä (1-3 —Å–µ–∫)</em>
                    </div>
                    <div class="lifecycle-step">
                        <strong>1. –†–ï–ó–£–õ–¨–¢–ê–¢ –ó–ê–ü–ò–°–ê–ù</strong><br>
                        start_buy_result = {'status': 'success', ...}<br>
                        <em>–ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª: _check_start_buy_result()</em>
                    </div>
                    <div class="lifecycle-step">
                        <strong>2. –¶–ò–ö–õ –ê–ö–¢–ò–í–ï–ù</strong><br>
                        cycle_start_state=2, active=True<br>
                        <em>–ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª: _try_sell(), _try_rebuy()</em>
                    </div>
                    <div class="lifecycle-step">
                        <strong>–ü–†–û–î–ê–ñ–ê</strong><br>
                        cycle_start_state=0, active=False<br>
                        <em>–í–æ–∑–≤—Ä–∞—Ç –∫ —à–∞–≥—É 0</em>
                    </div>
                </div>
            </div>

            <!-- –†–ê–ó–í–Å–†–¢–´–í–ê–ù–ò–ï -->
            <div class="section">
                <h2>üöÄ –†–ê–ó–í–Å–†–¢–´–í–ê–ù–ò–ï</h2>
                
                <ol style="margin-left: 25px; font-size: 1.1em; line-height: 2.5;">
                    <li>‚úÖ –ö–æ–¥ –∏–∑–º–µ–Ω—ë–Ω (4 –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–∞)</li>
                    <li>‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–æ–≤–µ—Ä–µ–Ω</li>
                    <li>‚è≥ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞: <code>restart_server.bat</code></li>
                    <li>‚è≥ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤: —Ç–æ–ª—å–∫–æ –û–î–ù–ê –ø–æ–∫—É–ø–∫–∞ –ø–æ—Å–ª–µ –ø—Ä–æ–¥–∞–∂–∏</li>
                    <li>‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–π–º–∏–Ω–≥–æ–≤: Lock —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è <50ms</li>
                </ol>

                <div class="warning-box">
                    <h3 style="margin: 0 0 15px 0;">‚ö° –û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ (—É—Å–ø–µ—à–Ω–∞—è –ø–æ–∫—É–ø–∫–∞):</h3>
                    <pre style="margin: 0; white-space: pre-wrap; font-family: monospace; line-height: 1.8;">
[START_ASYNC][ETH] ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—É—é –ø–æ–∫—É–ø–∫—É –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ
[START_ASYNC][ETH] üîí cycle_start_state=1 –£–°–¢–ê–ù–û–í–õ–ï–ù –ò –°–û–•–†–ê–ù–Å–ù
[START_ASYNC][ETH] üöÄ –ü–æ—Ç–æ–∫ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –ø–æ–∫—É–ø–∫–∏ –∑–∞–ø—É—â–µ–Ω (Lock –æ—Å–≤–æ–±–æ–∂–¥—ë–Ω)
[WORKER][ETH] üîÑ –ù–∞—á–∏–Ω–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –ø–æ–∫—É–ø–∫–∏...
[WORKER][ETH] ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø–∏—Å–∞–Ω: success
[CHECK][ETH] ‚úÖ –ü–æ–∫—É–ø–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ü–∏–∫–ª
[CHECK][ETH] üéØ –¶–∏–∫–ª –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω: price=3028.4300, volume=9.9926
[ETH] Buy{9.9926; –ö—É—Ä—Å:3028.0700; ‚ÜìŒî%:0.00; ‚Üì%:0.00; –ò–Ω–≤–µ—Å—Ç:9.9926}
                    </pre>
                </div>
            </div>
        </div>

        <div class="footer">
            <p><strong>–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</strong> 2024-12-06</p>
            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ‚úÖ ASYNC START BUY –†–ï–ê–õ–ò–ó–û–í–ê–ù–û</p>
            <p><strong>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</strong> üî• –û–ö–û–ù–ß–ê–¢–ï–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï RACE CONDITION</p>
            <p style="margin-top: 20px; opacity: 0.9;">
                –§–∞–π–ª—ã: <code>autotrader.py</code> (4 –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–∞) | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: <code>ASYNC_START_BUY_FIX.md</code>
            </p>
        </div>
    </div>
</body>
</html>
