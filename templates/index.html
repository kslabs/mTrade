<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- VERSION: 2025-11-10-21:00 - REFACTORED (CSS/JS SEPARATED) {{ cache_buster }} -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Gate.io Multi-Trading Platform [{{ cache_buster }}]</title>
    
    <!-- External CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="container">
    <div class="header">
        <div class="header-left"><div><h1>üöÄ mTrade</h1><p>Gate.io Trading Platform</p></div></div>
        <div class="header-center">
            <div id="autoTradeSwitcher" class="autotrade-switch" title="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Ç–æ—Ä–≥–æ–≤–ª—é" onclick="toggleAutoTrade()">
                <span class="label-text">AutoTrade</span>
                <div class="mode-option" data-state="off">
                    OFF
                </div>
                <div class="mode-option active" data-state="on">
                    ON
                </div>
            </div>
            <div style="position:relative;display:inline-block;">
                <div id="networkSwitcher" class="network-switch" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º —Å–µ—Ç–∏">
                    <div class="mode-option active" data-mode="work" onclick="switchNetworkMode('work')">
                        WORK
                    </div>
                    <div class="mode-option" data-mode="test" onclick="switchNetworkMode('test')">
                        TEST
                    </div>
                </div>
                <span id="networkConnStatus"></span>
            </div>
            <div id="tradingModeSwitcher" class="trading-mode-switch" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º —Ç–æ—Ä–≥–æ–≤–ª–∏">
                <div class="mode-option active" data-mode="normal" onclick="switchTradingMode('normal')">
                    TRADE
                </div>
                <div class="mode-option" data-mode="copy" onclick="switchTradingMode('copy')">
                    COPY
                </div>
            </div>
        </div>
        <div class="header-right">
            <div class="server-status-inline"><div class="status-dot" id="statusDot"></div><span id="serverPID" style="color:#999;font-size:11px;">PID: ---</span></div>
            <div class="uptime-display" id="uptimeDisplay"><strong>00–¥ 00:00:00</strong></div>
            <div class="server-controls-inline"><button class="server-btn-small restart" id="restartServerBtn">üîÑ</button><button class="server-btn-small shutdown" id="shutdownServerBtn">‚èπÔ∏è</button></div>
        </div>
    </div>

    <div class="base-currency-tabs" id="currencyTabsWrapper">
        <div style="display:flex;gap:8px;flex:1;overflow-x:auto;" id="currencyTabsContainer"><div class="loading" style="padding:10px;color:#666;font-size:12px;">–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∞–ª—é—Ç...</div></div>
        <button id="manageCurrenciesBtn" class="currency-gear-btn" title="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞–ª—é—Ç–∞–º–∏" onclick="openCurrencyManager()">‚öôÔ∏è</button>
    </div>
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∞–ª—é—Ç–∞–º–∏ -->
    <div id="currencyManagerModal" onclick="if(event.target===this)closeCurrencyManager()">
        <div class="modal-inner">
            <h4>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã–º–∏ –≤–∞–ª—é—Ç–∞–º–∏</h4>
            <div id="currencyManagerRows"></div>
            <div class="cm-actions">
                <button class="cm-btn add" onclick="addCurrencyRow()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
                <button class="cm-btn save" onclick="saveCurrenciesList()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="cm-btn cancel" onclick="closeCurrencyManager()">‚úñ –û—Ç–º–µ–Ω–∞</button>
            </div>
            <div style="margin-top:10px;font-size:11px;color:#888;line-height:1.4">–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (currencies.json). –ú–∏–Ω–∏–º—É–º 1 –≤–∞–ª—é—Ç–∞, –∫–æ–¥—ã —É–Ω–∏–∫–∞–ª—å–Ω—ã.</div>
        </div>
    </div>



    <div class="grid">
        <div class="card">
            <h3 style="display:flex;justify-content:space-between;align-items:center;gap:10px;">
                <span>üìà –†—ã–Ω–æ–∫ –∏ —Å—Ç–∞–∫–∞–Ω</span>
                <div style="display:flex;align-items:center;gap:8px;">
                    <button id="buyMinOrderBtn" class="server-btn-small" style="background:#28a745;color:#fff;width:32px;height:32px;padding:0;font-size:16px;border:none;border-radius:4px;cursor:pointer;display:flex;align-items:center;justify-content:center;" title="–ö—É–ø–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Ä–¥–µ—Ä">
                        üí∞
                    </button>
                    <button id="sellAllBtn" class="server-btn-small" style="background:#dc3545;color:#fff;width:32px;height:32px;padding:0;font-size:16px;border:none;border-radius:4px;cursor:pointer;display:flex;align-items:center;justify-content:center;" title="–ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ">
                        üí∏
                    </button>
                    <span style="font-size:11px;color:#888;">–ë–∞–ª–∞–Ω—Å:</span>
                    <span id="headerQuoteBalance" style="font-size:16px;color:#4a9eff;font-weight:700;min-width:60px;text-align:right;" title="–ë–∞–ª–∞–Ω—Å –∫–æ—Ç–∏—Ä—É–µ–º–æ–π –≤–∞–ª—é—Ç—ã">0.00</span>
                    <select id="quoteCurrencySelect" style="background:#1a1a1a;color:#ccc;border:1px solid #3a3a3a;border-radius:4px;padding:6px 10px;font-size:13px;font-weight:600;cursor:pointer;outline:none;" onchange="switchQuoteCurrency(this.value)">
                        <option value="USDT">USDT</option>
                        <option value="USDC">USDC</option>
                        <option value="BTC">BTC</option>
                        <option value="ETH">ETH</option>
                    </select>
                </div>
            </h3>
            <div class="market-header"><div class="pair-name" id="currentPairName">BTC_USDT</div><div class="pair-price" id="currentPairPrice">$0.00</div></div>
            <div class="balances-grid">
                <div class="balance-item"><div class="balance-label">–ë–∞–ª–∞–Ω—Å <span id="baseSymbol">BTC</span></div><div class="balance-value" id="baseBalance">0.00000000</div><div class="balance-usd" id="baseBalanceUSD">‚âà $0.00</div></div>
                <div class="balance-item" id="pairParamsBlock"><div class="balance-label">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞—Ä—ã</div><div style="display:grid;grid-template-columns:auto 1fr;row-gap:2px;column-gap:6px;font-size:10px;color:#ccc;"><div>Min Quote:</div><div id="minQuoteAmount">-</div><div>Min Base:</div><div id="minBaseAmount">-</div><div>Amt Prec:</div><div id="amountPrecision">-</div><div>Price Prec:</div><div id="pricePrecision">-</div></div></div>
            </div>
            <div class="orderbook-container">
                <div class="orderbook-header"><div>–¶–µ–Ω–∞ (<span id="obQuoteSymbol">USDT</span>)</div><div>–ö–æ–ª-–≤–æ</div><div>–°—É–º–º–∞</div><div>Œ£ –ù–∞–∫–æ–ø.</div></div>
                <div class="orderbook-asks" id="orderbookAsks"><div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div></div>
                <div class="orderbook-spread"><span id="currentPrice">-</span><span><span style="margin-right:5px;">–°–ø—Ä–µ–¥:</span><span id="spreadValue">-</span></span></div>
                <div class="orderbook-bids" id="orderbookBids"><div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div></div>
            </div>
            <div style="margin-top:10px;text-align:center;font-size:.85em;color:#888;"><span id="wsStatus">üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket...</span></div>
        </div>
        <div class="card indicator-card" style="grid-column:2;display:flex;align-items:flex-end;justify-content:center;">
            <div id="indicatorScale" class="indicator-scale" aria-hidden="false">
                <div id="markerSell" class="indicator-marker marker-sell"><span class="label">Sell</span><div class="marker-tooltip">Sell: -</div></div>
                <div id="markerBE" class="indicator-marker marker-be"><span class="label">BE</span><div class="marker-tooltip">BE: -</div></div>
                <div id="markerLast" class="indicator-marker marker-last"><span class="label">Last</span><div class="marker-tooltip">Last: -</div></div>
                <div id="markerStart" class="indicator-marker marker-start"><span class="label">Start</span><div class="marker-tooltip">Start: -</div></div>
                <div id="markerBuy" class="indicator-marker marker-buy"><span class="label">Buy</span><div class="marker-tooltip">Buy: -</div></div>
                <div class="indicator-footer" id="indicatorFooter"><div class="row price"><div class="label">Price:</div><div class="value" id="indPrice">-</div></div><div class="row"><div class="label">Sell:</div><div class="value" id="indSell">-</div></div><div class="row"><div class="label">BE:</div><div class="value" id="indBE">-</div></div><div class="row"><div class="label">Last:</div><div class="value" id="indLast">-</div></div><div class="row"><div class="label">Start:</div><div class="value" id="indStart">-</div></div><div class="row"><div class="label">Buy:</div><div class="value" id="indBuy">-</div></div></div>
            </div>
        </div>
        <div class="card">
            <div class="params-header">
                <h3>üìä –¢–∞–±–ª–∏—Ü–∞ –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏</h3>
                <div class="params-header-actions">
                    <div id="paramsSaveStatus" class="params-save-status"></div>
                    <button id="saveParamsBtn" class="save-params-btn-compact">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </div>
            
            <!-- –ë–ª–æ–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ -->
            <div class="trade-params-editor">
                <!-- –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ -->
                <div class="params-row">
                    <div class="param-field">
                        <label for="paramSteps" title="–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ —Ç–∞–±–ª–∏—Ü—ã, –≤–º–µ—Å—Ç–µ —Å –Ω—É–ª–µ–≤–æ–π —Å—Ç—Ä–æ–∫–æ–π –ø–æ –∫–æ—Ç–æ—Ä–æ–π –¥–µ–ª–∞–µ—Ç—Å—è —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –ø—Ä–æ–¥–∞–∂–µ–π –≤—Å–µ–≥–æ, –∫—Ä–æ–º–µ —Å—É–º–º—ã Keep">–®–∞–≥–æ–≤:</label>
                        <input type="number" id="paramSteps" step="1" value="16" min="1" max="50" />
                    </div>
                    <div class="param-field">
                        <label for="paramStartVolume" title="–°—Ç–∞—Ä—Ç–æ–≤—ã–π –æ–±—ä—ë–º –∑–∞–∫—É–ø–∫–∏ –≤ –∫–æ—Ç–∏—Ä—É–µ–º–æ–π –≤–∞–ª—é—Ç–µ">–°—Ç–∞—Ä—Ç, $:</label>
                        <input type="number" id="paramStartVolume" step="0.1" value="3" min="0.1" />
                    </div>
                    <div class="param-field">
                        <label for="paramStartPrice" title="–°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ü–µ–Ω–∞ –∑–∞–∫—É–ø–∫–∏, –∫–æ—Ç–æ—Ä–∞—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –ø—Ä–æ–∏–∑–æ—à–ª–∞ —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞">–¶–µ–Ω–∞ (P0):</label>
                        <input type="number" id="paramStartPrice" step="0.00000001" value="0" placeholder="–¢–µ–∫—É—â–∏–π –∫—É—Ä—Å" />
                    </div>
                    <div class="param-field">
                        <label for="paramPprof" title="–£–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–∫–æ–π –ø—Ä–æ—Ñ–∏—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ –∫–∞–∫–æ–º —à–∞–≥–µ —Ü–∏–∫–ª–∞">Pprof, %:</label>
                        <input type="number" id="paramPprof" step="0.01" value="0.6" min="0.01" />
                    </div>
                    <div class="param-field">
                        <label for="paramKprof" title="–£–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∫–æ–ª—å–∫–æ –Ω–∞–¥–æ –≤—ã—á–µ—Å—Ç—å –∏–∑ Pprof –Ω–∞ —à–∞–≥–µ —Ü–∏–∫–ª–∞">Kprof:</label>
                        <input type="number" id="paramKprof" step="0.001" value="0.02" min="0" />
                    </div>
                </div>
                
                <!-- –í—Ç–æ—Ä–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ -->
                <div class="params-row">
                    <div class="param-field">
                        <label for="paramTargetR" title="–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —à–∞–≥ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –∫ –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ–π —Ü–µ–ª–∏ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ—á–∫–µ">–ë–µ–∑–£–±, % (—Ü–µ–ª—å R):</label>
                        <input type="number" id="paramTargetR" step="0.01" value="3.65" min="0.01" />
                    </div>
                    <div class="param-field">
                        <label for="paramGeomMultiplier" title="–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —à–∞–≥ –≥–µ–æ–º–µ—Ç—Ä–∏–∏ –æ–±—ä—ë–º–æ–≤ –∑–∞–∫—É–ø–æ–∫">–ú–Ω–æ–∂–∏—Ç–µ–ª—å –≥–µ–æ–º–µ—Ç—Ä–∏–∏:</label>
                        <input type="number" id="paramGeomMultiplier" step="0.1" value="2" min="1" />
                    </div>
                    <div class="param-field">
                        <label for="paramRebuyMode" title="–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∂–∏–º—ã –≥–µ–æ–º–µ—Ç—Ä–∏–∏: –ª–∏–Ω–µ–π–Ω—ã–π, –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–π, –ú–∞—Ä—Ç–∏–Ω–≥–µ–π–ª–∞">–†–µ–∂–∏–º —Å—É–º–º –¥–æ–∫—É–ø–æ–∫:</label>
                        <select id="paramRebuyMode">
                            <option value="fixed">–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π</option>
                            <option value="geometric">–ì–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–π</option>
                            <option value="martingale">–ú–∞—Ä—Ç–∏–Ω–≥–µ–π–ª</option>
                        </select>
                    </div>
                    <div class="param-field">
                        <label for="paramKeep" title="–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è —Å—É–º–º–∞ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ, –∫–æ—Ç–æ—Ä–∞—è –¥–æ–ª–∂–Ω–∞ –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ. –ï—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –æ–±—ä—ë–º–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ –ø—Ä–∏ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ —Ü–∏–∫–ª–∞, —Ç–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å —Ü–∏–∫–ª —Ñ–∏–∫—Ç–∏–≤–Ω–æ–π –ø—Ä–æ–¥–∞–∂–µ–π, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π —Ü–∏–∫–ª">Keep:</label>
                        <input type="number" id="paramKeep" step="0.01" value="0" min="0" placeholder="–û—Å—Ç–∞—Ç–æ–∫" />
                    </div>
                </div>
            </div>
            
            <div id="breakEvenNote" style="font-size:11px;color:#999;margin-bottom:8px;">–¢–∞–±–ª–∏—Ü–∞ –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏ –¥–ª—è —Ç–µ–∫—É—â–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</div>
            <div style="overflow-x:auto;">
                <table id="breakEvenTable" style="width:100%;border-collapse:collapse;font-size:11px;">
                    <thead>
                        <tr style="background:#1a1a1a;color:#ccc;text-align:right;border-bottom:1px solid #3a3a3a;">
                            <th style="padding:6px 8px;text-align:center;">#</th>
                            <th style="padding:6px 8px;">‚Üì, %</th>
                            <th style="padding:6px 8px;">–ö—É—Ä—Å</th>
                            <th style="padding:6px 8px;">–ü–æ–∫—É–ø–∫–∞, $</th>
                            <th style="padding:6px 8px;">–ò–Ω–≤.–°—É–º–º,$</th>
                            <th style="padding:6px 8px;">–¶.–ë–µ–∑–£–±,$</th>
                            <th style="padding:6px 8px;">‚Üë –ë–µ–∑–£–±,%</th>
                            <th style="padding:6px 8px;">tŒîPsell,%</th>
                        </tr>
                    </thead>
                    <tbody id="breakEvenBody">
                        <tr><td colspan="8" style="padding:12px;text-align:center;color:#999;">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- External JavaScript -->
<script src="{{ url_for('static', filename='app.js') }}"></script>
<script src="{{ url_for('static', filename='trade-logs-manager.js') }}"></script>
</body>
</html>
