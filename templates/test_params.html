<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        h1 {
            color: #4CAF50;
            text-align: center;
        }
        .test-section {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .test-section h2 {
            color: #64B5F6;
            margin-top: 0;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #45a049;
        }
        .log {
            background: #1a1a1a;
            border: 1px solid #555;
            border-radius: 5px;
            padding: 10px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            margin-top: 10px;
        }
        .success {
            color: #4CAF50;
        }
        .error {
            color: #f44336;
        }
        .info {
            color: #64B5F6;
        }
        .param-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .param-field {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 5px;
        }
        .param-field label {
            display: block;
            color: #999;
            font-size: 11px;
            margin-bottom: 5px;
        }
        .param-field input {
            width: 100%;
            padding: 5px;
            background: #333;
            border: 1px solid #555;
            color: #fff;
            border-radius: 3px;
            box-sizing: border-box;
        }
        .clear-btn {
            background: #f44336;
        }
        .clear-btn:hover {
            background: #da190b;
        }
    </style>
</head>
<body>
    <h1>üîç –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ç–æ—Ä–≥–æ–≤–ª–∏</h1>
    
    <div class="test-section">
        <h2>–í—ã–±–æ—Ä –≤–∞–ª—é—Ç—ã</h2>
        <label>
            –ë–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞:
            <select id="currencySelect" style="margin-left: 10px; padding: 5px;">
                <option value="">-- –ù–µ –≤—ã–±—Ä–∞–Ω–∞ --</option>
                <option value="ETH">ETH</option>
                <option value="BTC">BTC</option>
                <option value="SOL">SOL</option>
            </select>
        </label>
    </div>
    
    <div class="test-section">
        <h2>–¢–µ—Å—Ç—ã API</h2>
        <button onclick="testFetch()">–¢–µ—Å—Ç fetch()</button>
        <button onclick="testLoadParams()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</button>
        <button onclick="testFillForm()">–ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É</button>
        <button class="clear-btn" onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        <div id="apiLog" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>–§–æ—Ä–º–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</h2>
        <div class="param-grid">
            <div class="param-field">
                <label>–®–∞–≥–æ–≤:</label>
                <input type="number" id="paramSteps" readonly />
            </div>
            <div class="param-field">
                <label>–°—Ç–∞—Ä—Ç, $:</label>
                <input type="number" id="paramStartVolume" readonly />
            </div>
            <div class="param-field">
                <label>–¶–µ–Ω–∞ (P0):</label>
                <input type="number" id="paramStartPrice" readonly />
            </div>
            <div class="param-field">
                <label>Pprof, %:</label>
                <input type="number" id="paramPprof" readonly />
            </div>
            <div class="param-field">
                <label>Kprof:</label>
                <input type="number" id="paramKprof" readonly />
            </div>
            <div class="param-field">
                <label>R:</label>
                <input type="number" id="paramTargetR" readonly />
            </div>
            <div class="param-field">
                <label>Rk:</label>
                <input type="number" id="paramRk" readonly />
            </div>
            <div class="param-field">
                <label>–ú–Ω–æ–∂–∏—Ç–µ–ª—å –≥–µ–æ–º–µ—Ç—Ä–∏–∏:</label>
                <input type="number" id="paramGeomMultiplier" readonly />
            </div>
            <div class="param-field">
                <label>–†–µ–∂–∏–º –¥–æ–∫—É–ø–æ–∫:</label>
                <input type="text" id="paramRebuyMode" readonly />
            </div>
            <div class="param-field">
                <label>Keep:</label>
                <input type="number" id="paramKeep" readonly />
            </div>
            <div class="param-field">
                <label>–°—Ç–∞–∫–∞–Ω:</label>
                <input type="number" id="paramOrderbookLevel" readonly />
            </div>
        </div>
    </div>
    
    <script>
        const $ = id => document.getElementById(id);
        const log = (msg, type = 'info') => {
            const logEl = $('apiLog');
            const time = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            logEl.innerHTML += `<span class="${className}">[${time}] ${msg}</span>\n`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(`[${type.toUpperCase()}]`, msg);
        };
        
        const clearLog = () => {
            $('apiLog').innerHTML = '';
        };
        
        async function testFetch() {
            log('='.repeat(60), 'info');
            log('–¢–ï–°–¢: –ü—Ä–æ–≤–µ—Ä–∫–∞ fetch API', 'info');
            log('='.repeat(60), 'info');
            
            try {
                log('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ /api/trade/params...', 'info');
                const response = await fetch('/api/trade/params');
                log(`–û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω: status=${response.status} ${response.statusText}`, 'success');
                
                const data = await response.json();
                log(`Success: ${data.success}`, data.success ? 'success' : 'error');
                log(`–î–∞–Ω–Ω—ã–µ: ${JSON.stringify(data, null, 2)}`, 'info');
            } catch (e) {
                log(`–û–®–ò–ë–ö–ê: ${e.message}`, 'error');
                console.error(e);
            }
        }
        
        async function testLoadParams() {
            log('='.repeat(60), 'info');
            log('–¢–ï–°–¢: –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤', 'info');
            log('='.repeat(60), 'info');
            
            const currency = $('currencySelect').value;
            log(`–¢–µ–∫—É—â–∞—è –≤–∞–ª—é—Ç–∞: ${currency || '(–Ω–µ –≤—ã–±—Ä–∞–Ω–∞)'}`, 'info');
            
            try {
                const url = currency 
                    ? `/api/trade/params?base_currency=${currency}` 
                    : '/api/trade/params';
                
                log(`URL: ${url}`, 'info');
                log('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...', 'info');
                
                const response = await fetch(url);
                log(`–û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω: status=${response.status}`, response.ok ? 'success' : 'error');
                
                if (!response.ok) {
                    const text = await response.text();
                    log(`ERROR: ${text}`, 'error');
                    return null;
                }
                
                const data = await response.json();
                log(`Success: ${data.success}`, data.success ? 'success' : 'error');
                
                if (data.params) {
                    log('–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:', 'success');
                    for (const [key, value] of Object.entries(data.params)) {
                        log(`  - ${key}: ${value}`, 'info');
                    }
                    return data.params;
                } else {
                    log('‚ö† –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –æ—Ç–≤–µ—Ç–µ', 'error');
                    return null;
                }
            } catch (e) {
                log(`–û–®–ò–ë–ö–ê: ${e.message}`, 'error');
                console.error(e);
                return null;
            }
        }
        
        async function testFillForm() {
            log('='.repeat(60), 'info');
            log('–¢–ï–°–¢: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã', 'info');
            log('='.repeat(60), 'info');
            
            const params = await testLoadParams();
            
            if (!params) {
                log('‚ö† –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã', 'error');
                return;
            }
            
            try {
                log('–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã...', 'info');
                
                const fields = {
                    'paramSteps': params.steps,
                    'paramStartVolume': params.start_volume,
                    'paramStartPrice': params.start_price,
                    'paramPprof': params.pprof,
                    'paramKprof': params.kprof,
                    'paramTargetR': params.target_r,
                    'paramRk': params.rk,
                    'paramGeomMultiplier': params.geom_multiplier,
                    'paramRebuyMode': params.rebuy_mode,
                    'paramKeep': params.keep,
                    'paramOrderbookLevel': params.orderbook_level
                };
                
                for (const [id, value] of Object.entries(fields)) {
                    const el = $(id);
                    if (el) {
                        el.value = value ?? 0;
                        log(`‚úì ${id} = ${value}`, 'success');
                    } else {
                        log(`‚úó –≠–ª–µ–º–µ–Ω—Ç ${id} –Ω–µ –Ω–∞–π–¥–µ–Ω!`, 'error');
                    }
                }
                
                log('–§–æ—Ä–º–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞!', 'success');
            } catch (e) {
                log(`–û–®–ò–ë–ö–ê –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã: ${e.message}`, 'error');
                console.error(e);
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
            log('–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é', 'info');
        });
    </script>
</body>
</html>
