# Инструкция по диагностике проблемы с отображением столбцов

## Проблема
Столбцы "Инв.Сумм,$" и "↑ БезУб,%" не отображаются в таблице безубыточности.

## Что уже проверено

### ✅ Backend (серверная часть)
1. **API возвращает правильные данные**
   - Тест `test_breakeven_api.py` показал, что поля `total_invested` и `breakeven_pct` присутствуют в ответе API
   - Данные корректны для всех валют (WLD, XRP, ETH, BTC)

2. **Функция calculate_breakeven_table работает правильно**
   - Файл `breakeven_calculator.py` возвращает все необходимые поля
   - Строки 289-290: `'total_invested': total_invested, 'breakeven_pct': breakeven_pct`

3. **API-эндпоинт корректно передает данные**
   - Файл `trade_params_routes.py`, функция `get_breakeven_table`
   - Данные из `calculate_breakeven_table` передаются напрямую в JSON-ответ

### ⚠️ Frontend (клиентская часть)
1. **HTML-шаблон правильный**
   - Файл `templates/index.html`, строки 289-291
   - Заголовки таблицы включают все 10 столбцов

2. **JavaScript рендеринг обновлён**
   - Файл `static/app.js`, функция `renderBreakEvenTable`
   - Строки 1247-1256: правильно используются `total_invested` и `breakeven_pct`
   - Добавлено отладочное логирование

## Следующие шаги для проверки

### Шаг 1: Откройте тестовую страницу
```
http://localhost:5000/test-table
```

Эта страница загружает данные напрямую через API и отображает их.
- Если данные отображаются правильно → проблема в кеше браузера для основной страницы
- Если данные НЕ отображаются → проблема в самих данных или API

### Шаг 2: Проверьте консоль браузера на основной странице
```
http://localhost:5000/
```

Откройте консоль разработчика (F12) и найдите сообщения:
```
[BREAKEVEN RENDER] Данные получены, строк: 17
[BREAKEVEN RENDER] Первая строка: {step: 0, rate: ...}
[BREAKEVEN RENDER] total_invested: ✅ ЕСТЬ 10
[BREAKEVEN RENDER] breakeven_pct: ✅ ЕСТЬ 0
```

- Если видите эти сообщения и данные есть → проблема в отрисовке DOM
- Если данных нет → проблема в загрузке данных с сервера

### Шаг 3: Очистите кеш браузера
1. Откройте DevTools (F12)
2. Щелкните правой кнопкой мыши на кнопке обновления страницы
3. Выберите "Очистить кеш и жесткая перезагрузка" (Empty Cache and Hard Reload)

Или:
1. Используйте режим инкогнито (Ctrl+Shift+N)
2. Откройте `http://localhost:5000/`

### Шаг 4: Проверьте, какой файл загружается
В консоли браузера выполните:
```javascript
console.log(renderBreakEvenTable.toString().substring(0, 500))
```

Это покажет начало функции. Проверьте, что там есть отладочное логирование:
```javascript
console.log('[BREAKEVEN RENDER] Данные получены, строк:', tableData.length);
```

Если нет → браузер загрузил старую версию app.js из кеша.

## Возможные причины проблемы

### 1. Кеш браузера
**Решение:** Очистите кеш (см. Шаг 3) или добавьте версионирование в HTML:
```html
<script src="{{ url_for('static', filename='app.js') }}?v={{ cache_buster }}"></script>
```

### 2. Старая версия app.js
**Решение:** Проверьте, что файл `static/app.js` содержит обновлённый код

### 3. Проблема с colspan
**Исправлено:** В строке 1204 `static/app.js` изменено `colspan="9"` на `colspan="10"`

### 4. Данные не доходят до рендера
**Решение:** Проверьте логи в консоли браузера

## Текущее состояние

### Что сделано:
1. ✅ Добавлен тест API (`test_breakeven_api.py`)
2. ✅ Создана тестовая страница (`templates/test_table.html`)
3. ✅ Исправлен colspan в `renderBreakEvenTable`
4. ✅ Добавлено отладочное логирование в `static/app.js`
5. ✅ Исправлена синтаксическая ошибка в `mTrade.py` (строка 441)

### Ожидается:
1. Проверка тестовой страницы
2. Проверка консоли браузера на основной странице
3. Очистка кеша браузера при необходимости

## Команды для проверки

### Запуск теста API:
```powershell
cd "c:\Users\Администратор\Documents\bGate.mTrade"
python test_breakeven_api.py
```

### Проверка содержимого app.js:
```powershell
Select-String -Path "static\app.js" -Pattern "total_invested" -Context 2,2
```

### Перезапуск сервера (если нужно):
```powershell
# Остановите текущий процесс, затем:
python mTrade.py
```

## Финальная проверка

После выполнения всех шагов:
1. Откройте `http://localhost:5000/`
2. Выберите любую валюту (WLD, XRP, ETH, BTC)
3. Проверьте таблицу безубыточности
4. Убедитесь, что столбцы "Инв.Сумм,$" и "↑ БезУб,%" заполнены значениями

**Ожидаемый результат:**
- Шаг 0: Инв.Сумм,$ = 10.00, ↑ БезУб,% = 0.00%
- Шаг 1: Инв.Сумм,$ = 30.00, ↑ БезУб,% = 0.31%
- И так далее...
