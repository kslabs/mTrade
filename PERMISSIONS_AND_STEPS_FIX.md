# ะะกะะะะะะะะะ ะะะะะะ ะะะะฎะงะะะะฏ/ะะซะะะฎะงะะะะฏ ะะะะฎะขะซ ะ ะะขะะะะะะะะะฏ ะจะะะะ

## ะะฐัะฐ: 2024-12-XX
## ะกัะฐััั: โ ะะซะะะะะะะ

---

## ะัะพะฑะปะตะผั

1. **ะะฝะพะฟะบะฐ ะฒะบะปััะตะฝะธั/ะฒัะบะปััะตะฝะธั ะฒะฐะปััั ะฝะต ะพัะพะฑัะฐะถะฐะตััั**
   - ะ ััะฝะบัะธะธ `renderCurrencyTabs` ะพััััััะฒะพะฒะฐะปะพ ัะพะทะดะฐะฝะธะต ัะปะตะผะตะฝัะฐ `.perm-indicator`
   - ะคัะฝะบัะธั `updateTabsPermissionsUI` ะฝะต ะพะฑะฝะพะฒะปัะปะฐ ัะพััะพัะฝะธะต ััะพะน ะบะฝะพะฟะบะธ

2. **ะะพะผะตั ัะพัะณะพะฒะพะณะพ ัะฐะณะฐ ะฝะต ะพัะพะฑัะฐะถะฐะตััั ะฝะฐ ะฒะบะปะฐะดะบะฐั ะฒะฐะปัั**
   - CSS ะดะปั `.step-indicator` ะพััััััะฒะพะฒะฐะป ะฒ `style.css`
   - ะะฝะดะธะบะฐัะพั ัะพะทะดะฐะฒะฐะปัั ะฒ JS, ะฝะพ ะฝะต ะธะผะตะป ััะธะปะตะน ะดะปั ะพัะพะฑัะฐะถะตะฝะธั

---

## ะัะฟัะฐะฒะปะตะฝะธั

### 1. ะะพะฑะฐะฒะปะตะฝะฐ ััะฝะบัะธั `toggleTradingPermission` ะฒ `static/app.js`

```javascript
async function toggleTradingPermission(code, event){
  if(event) event.stopPropagation(); // ะัะตะดะพัะฒัะฐัะฐะตะผ ะฟะตัะตะบะปััะตะฝะธะต ะฒะบะปะฐะดะบะธ
  if(!code) return;
  
  const currentState = window.tradingPermissions && window.tradingPermissions[code];
  const newState = !currentState;
  
  console.log(`[DEBUG] toggleTradingPermission: ${code} ${currentState} -> ${newState}`);
  
  try{
    const r = await fetch('/api/trade/permission', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        base_currency: code,
        enabled: newState
      })
    });
    const d = await r.json();
    
    if(d.success){
      // ะะฑะฝะพะฒะปัะตะผ ะปะพะบะฐะปัะฝะพะต ัะพััะพัะฝะธะต
      if(!window.tradingPermissions) window.tradingPermissions = {};
      window.tradingPermissions[code] = newState;
      console.log(`[SUCCESS] ะขะพัะณะพะฒะปั ะดะปั ${code}: ${newState ? 'ัะฐะทัะตัะตะฝะฐ' : 'ะทะฐะฟัะตัะตะฝะฐ'}`);
      // ะะฑะฝะพะฒะปัะตะผ UI
      updateTabsPermissionsUI();
    } else {
      console.error('[ERROR] toggleTradingPermission failed:', d.error);
      alert('ะัะธะฑะบะฐ: ' + (d.error || 'ะะต ัะดะฐะปะพัั ะธะทะผะตะฝะธัั ัะฐะทัะตัะตะฝะธะต'));
    }
  }catch(e){
    console.error('[ERROR] toggleTradingPermission exception:', e);
    alert('ะัะธะฑะบะฐ ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ ัะฐะทัะตัะตะฝะธั: ' + e);
  }
}
```

**ะงัะพ ะดะตะปะฐะตั:**
- ะะตัะตะบะปััะฐะตั ัะฐะทัะตัะตะฝะธะต ัะพัะณะพะฒะปะธ ะดะปั ะฒะฐะปััั (ะฒะบะปััะฐะตั/ะฒัะบะปััะฐะตั)
- ะัะฟัะฐะฒะปัะตั POST ะทะฐะฟัะพั ะฝะฐ `/api/trade/permission`
- ะะฑะฝะพะฒะปัะตั ะปะพะบะฐะปัะฝะพะต ัะพััะพัะฝะธะต ะธ UI ะฟะพัะปะต ััะฟะตัะฝะพะณะพ ะธะทะผะตะฝะตะฝะธั
- ะัะตะดะพัะฒัะฐัะฐะตั ะฟะตัะตะบะปััะตะฝะธะต ะฒะบะปะฐะดะบะธ ะฟัะธ ะบะปะธะบะต ะฝะฐ ะบะฝะพะฟะบั

---

### 2. ะะฑะฝะพะฒะปะตะฝะฐ ััะฝะบัะธั `renderCurrencyTabs` ะฒ `static/app.js`

**ะะพ:**
```javascript
norm.forEach(cur=>{
  const el=document.createElement('div');
  el.className='tab-item'+(cur.code===currentBaseCurrency?' active':'');
  el.dataset.code=cur.code;
  el.innerHTML=`<span class='code-label'>${cur.code}</span>${cur.symbol?`<span class='symbol-label'>${cur.symbol}</span>`:''}`;
  el.onclick=()=>switchBaseCurrency(cur.code);
  cont.appendChild(el);
});
```

**ะะพัะปะต:**
```javascript
norm.forEach(cur=>{
  const el=document.createElement('div');
  el.className='tab-item'+(cur.code===currentBaseCurrency?' active':'');
  el.dataset.code=cur.code;
  
  // ะกะพะทะดะฐะตะผ ะบะฝะพะฟะบั ะฒะบะปััะตะฝะธั/ะฒัะบะปััะตะฝะธั ะฒะฐะปััั
  const permBtn = document.createElement('span');
  permBtn.className = 'perm-indicator';
  permBtn.title = 'ะะบะปััะธัั/ะฒัะบะปััะธัั ัะพัะณะพะฒะปั';
  permBtn.onclick = (e) => toggleTradingPermission(cur.code, e);
  
  el.innerHTML=`<span class='code-label'>${cur.code}</span>${cur.symbol?`<span class='symbol-label'>${cur.symbol}</span>`:''}`;
  el.insertBefore(permBtn, el.firstChild); // ะััะฐะฒะปัะตะผ ะบะฝะพะฟะบั ะฒ ะฝะฐัะฐะปะพ
  el.onclick=()=>switchBaseCurrency(cur.code);
  cont.appendChild(el);
});
```

**ะงัะพ ะธะทะผะตะฝะธะปะพัั:**
- ะกะพะทะดะฐัััั ัะปะตะผะตะฝั `.perm-indicator` (ะบะฝะพะฟะบะฐ ะฒะบะปััะตะฝะธั/ะฒัะบะปััะตะฝะธั)
- ะะฝะพะฟะบะฐ ะดะพะฑะฐะฒะปัะตััั ะฒ ะฝะฐัะฐะปะพ ะฒะบะปะฐะดะบะธ
- ะัะธ ะบะปะธะบะต ะฒัะทัะฒะฐะตััั `toggleTradingPermission`

---

### 3. ะะฑะฝะพะฒะปะตะฝะฐ ััะฝะบัะธั `updateTabsPermissionsUI` ะฒ `static/app.js`

**ะะพะฑะฐะฒะปะตะฝะพ:**
```javascript
// ะะพะปััะฐะตะผ ัะพััะพัะฝะธะต ัะฐะทัะตัะตะฝะธั ัะพัะณะพะฒะปะธ
const permissionEnabled = window.tradingPermissions && window.tradingPermissions[code];

// ะะฑะฝะพะฒะปัะตะผ ะบะฝะพะฟะบั ัะฐะทัะตัะตะฝะธั ัะพัะณะพะฒะปะธ
const permBtn = tab.querySelector('.perm-indicator');
if(permBtn){
  permBtn.classList.toggle('on', permissionEnabled === true);
  permBtn.classList.toggle('off', permissionEnabled === false);
  permBtn.title = permissionEnabled ? 'ะขะพัะณะพะฒะปั ัะฐะทัะตัะตะฝะฐ (ะบะปะธะบ ะดะปั ะทะฐะฟัะตัะฐ)' : 'ะขะพัะณะพะฒะปั ะทะฐะฟัะตัะตะฝะฐ (ะบะปะธะบ ะดะปั ัะฐะทัะตัะตะฝะธั)';
}
```

**ะงัะพ ะดะตะปะฐะตั:**
- ะะฑะฝะพะฒะปัะตั ะบะปะฐััั `.on` / `.off` ะฝะฐ ะบะฝะพะฟะบะต ะฒ ะทะฐะฒะธัะธะผะพััะธ ะพั ัะพััะพัะฝะธั ัะฐะทัะตัะตะฝะธั
- ะะฑะฝะพะฒะปัะตั ะฟะพะดัะบะฐะทะบั (`title`) ะบะฝะพะฟะบะธ
- ะะฝะพะฟะบะฐ ััะฐะฝะพะฒะธััั ะทะตะปัะฝะพะน (`.on`) ะธะปะธ ะบัะฐัะฝะพะน (`.off`)

---

### 4. ะะพะฑะฐะฒะปะตะฝั ััะธะปะธ ะดะปั `.step-indicator` ะฒ `static/style.css`

```css
/* ะะฝะดะธะบะฐัะพั ะฐะบัะธะฒะฝะพะณะพ ัะฐะณะฐ ะฝะฐ ะฒะบะปะฐะดะบะต */
.base-currency-tabs .tab-item .step-indicator{
    position:absolute;
    bottom:2px;
    right:2px;
    background:#2196F3;
    color:#fff;
    font-size:10px;
    font-weight:700;
    padding:2px 4px;
    border-radius:4px;
    line-height:1;
    z-index:1;
    box-shadow:0 0 4px rgba(0,0,0,.5);
}
```

**ะงัะพ ะดะตะปะฐะตั:**
- ะะพะทะธัะธะพะฝะธััะตั ะธะฝะดะธะบะฐัะพั ัะฐะณะฐ ะฒ ะฟัะฐะฒะพะผ ะฝะธะถะฝะตะผ ัะณะปั ะฒะบะปะฐะดะบะธ
- ะกะธะฝะธะน ัะพะฝ ั ะฑะตะปัะผ ัะตะบััะพะผ
- ะะฐะปะตะฝัะบะธะน ัะฐะทะผะตั ััะธััะฐ (10px)
- ะขะตะฝั ะดะปั ะฒัะดะตะปะตะฝะธั ะฝะฐ ัะพะฝะต

---

## ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      ะะะะะะะ ะะะะฎะขะซ                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ .tab-item                                              โ โ
โ  โ  โโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ โ โ
โ  โ  โ .perm-indicatorโ  โ .code-label  โ  โ .step-     โ โ โ
โ  โ  โ  (ะฒะบะป/ะฒัะบะป)    โ  โ    (BTC)     โ  โ indicator  โ โ โ
โ  โ  โ   ๐ด/๐ข        โ  โ              โ  โ    (3)     โ โ โ
โ  โ  โโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโ โ โ
โ  โ                                                        โ โ
โ  โ  [ะบะปะธะบ ะฝะฐ ะบะฝะพะฟะบั] โ toggleTradingPermission()         โ โ
โ  โ  [ะบะปะธะบ ะฝะฐ ะฒะบะปะฐะดะบั] โ switchBaseCurrency()             โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ะะะขะะ ะะะะะซะฅ:

1. ะะฝะธัะธะฐะปะธะทะฐัะธั:
   initApp() โ loadTradingPermissions() โ /api/trade/permissions
                     โ
              window.tradingPermissions = {...}
                     โ
              updateTabsPermissionsUI()

2. ะะตัะตะบะปััะตะฝะธะต ัะฐะทัะตัะตะฝะธั:
   [ะบะปะธะบ ะฝะฐ .perm-indicator] โ toggleTradingPermission(code)
                                      โ
                          POST /api/trade/permission
                                      โ
                          window.tradingPermissions[code] = newState
                                      โ
                          updateTabsPermissionsUI()

3. ะัะพะฑัะฐะถะตะฝะธะต ะฐะบัะธะฒะฝะพะณะพ ัะฐะณะฐ:
   loadPerBaseIndicators() โ /api/trade/indicators
                                   โ
                          activeSteps[code] = active_step
                                   โ
                          updateTabsPermissionsUI()
                                   โ
                          ัะพะทะดะฐัั .step-indicator ั ะฝะพะผะตัะพะผ ัะฐะณะฐ
```

---

## API ะญะฝะดะฟะพะธะฝัั

### GET `/api/trade/permissions`
**ะะฟะธัะฐะฝะธะต:** ะะพะปััะธัั ัะฐะทัะตัะตะฝะธั ัะพัะณะพะฒะปะธ ะดะปั ะฒัะตั ะฒะฐะปัั

**ะัะฒะตั:**
```json
{
  "success": true,
  "permissions": {
    "BTC": true,
    "ETH": false,
    "SOL": true
  }
}
```

### POST `/api/trade/permission`
**ะะฟะธัะฐะฝะธะต:** ะฃััะฐะฝะพะฒะธัั ัะฐะทัะตัะตะฝะธะต ัะพัะณะพะฒะปะธ ะดะปั ะบะพะฝะบัะตัะฝะพะน ะฒะฐะปััั

**ะะฐะฟัะพั:**
```json
{
  "base_currency": "BTC",
  "enabled": true
}
```

**ะัะฒะตั:**
```json
{
  "success": true,
  "base_currency": "BTC",
  "enabled": true,
  "message": "ะขะพัะณะพะฒะปั BTC: ัะฐะทัะตัะตะฝะฐ"
}
```

---

## ะขะตััะธัะพะฒะฐะฝะธะต

### ะะฐะฟััะบ ัะตััะฐ API ัะฐะทัะตัะตะฝะธะน:
```powershell
python test_permissions_api.py
```

ะขะตัั ะฟัะพะฒะตััะตั:
1. โ ะะพะปััะตะฝะธะต ัะตะบััะธั ัะฐะทัะตัะตะฝะธะน
2. โ ะะบะปััะตะฝะธะต ัะพัะณะพะฒะปะธ ะดะปั ะฒะฐะปััั
3. โ ะัะบะปััะตะฝะธะต ัะพัะณะพะฒะปะธ ะดะปั ะฒะฐะปััั
4. โ ะกะพััะฐะฝะตะฝะธะต ะธะทะผะตะฝะตะฝะธะน

### ะััะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต ะฒ ะฑัะฐัะทะตัะต:

1. **ะัะพะฒะตัะบะฐ ะพัะพะฑัะฐะถะตะฝะธั ะบะฝะพะฟะบะธ:**
   - ะัะบัะพะนัะต ะฟัะธะปะพะถะตะฝะธะต ะฒ ะฑัะฐัะทะตัะต
   - ะัะพะฒะตัััะต, ััะพ ะฝะฐ ะบะฐะถะดะพะน ะฒะบะปะฐะดะบะต ะฒะฐะปััั ะตััั ะบััะถะพะบ ะฒ ะฒะตััะฝะตะผ ะฟัะฐะฒะพะผ ัะณะปั
   - ะััะถะพะบ ะดะพะปะถะตะฝ ะฑััั ะทะตะปัะฝัะผ (๐ข) ะตัะปะธ ัะพัะณะพะฒะปั ัะฐะทัะตัะตะฝะฐ ะธะปะธ ะบัะฐัะฝัะผ (๐ด) ะตัะปะธ ะทะฐะฟัะตัะตะฝะฐ

2. **ะัะพะฒะตัะบะฐ ะฟะตัะตะบะปััะตะฝะธั:**
   - ะะปะธะบะฝะธัะต ะฝะฐ ะบััะถะพะบ (ะบะฝะพะฟะบั ัะฐะทัะตัะตะฝะธั)
   - ะฆะฒะตั ะดะพะปะถะตะฝ ะธะทะผะตะฝะธัััั ั ะทะตะปัะฝะพะณะพ ะฝะฐ ะบัะฐัะฝัะน ะธะปะธ ะฝะฐะพะฑะพัะพั
   - ะะบะปะฐะดะบะฐ ะะ ะดะพะปะถะฝะฐ ะฟะตัะตะบะปััะธัััั ะฟัะธ ะบะปะธะบะต ะฝะฐ ะบะฝะพะฟะบั

3. **ะัะพะฒะตัะบะฐ ะพัะพะฑัะฐะถะตะฝะธั ัะฐะณะฐ:**
   - ะัะปะธ ะตััั ะฐะบัะธะฒะฝัะน ัะธะบะป ัะพัะณะพะฒะปะธ, ะฒ ะฟัะฐะฒะพะผ ะฝะธะถะฝะตะผ ัะณะปั ะฒะบะปะฐะดะบะธ ะดะพะปะถะตะฝ ะพัะพะฑัะฐะถะฐัััั ะฝะพะผะตั ัะฐะณะฐ
   - ะกะธะฝะธะน ะธะฝะดะธะบะฐัะพั ั ัะธััะพะน (ะฝะฐะฟัะธะผะตั, "3")

---

## ะคะฐะนะปั ะธะทะผะตะฝัะฝะฝัะต

1. `static/app.js`:
   - ะะพะฑะฐะฒะปะตะฝะฐ ััะฝะบัะธั `toggleTradingPermission`
   - ะะฑะฝะพะฒะปะตะฝะฐ ััะฝะบัะธั `renderCurrencyTabs`
   - ะะฑะฝะพะฒะปะตะฝะฐ ััะฝะบัะธั `updateTabsPermissionsUI`

2. `static/style.css`:
   - ะะพะฑะฐะฒะปะตะฝั ััะธะปะธ ะดะปั `.step-indicator`

3. `test_permissions_api.py` (ะฝะพะฒัะน):
   - ะขะตัั API ัะฐะทัะตัะตะฝะธะน ัะพัะณะพะฒะปะธ

---

## ะัะพะฒะตัะบะฐ

- โ ะะฝะพะฟะบะฐ ะฒะบะปััะตะฝะธั/ะฒัะบะปััะตะฝะธั ะฒะฐะปััั ะพัะพะฑัะฐะถะฐะตััั
- โ ะะฝะพะฟะบะฐ ะผะตะฝัะตั ัะฒะตั ะฟัะธ ะฟะตัะตะบะปััะตะฝะธะธ
- โ ะะปะธะบ ะฝะฐ ะบะฝะพะฟะบั ะฝะต ะฟะตัะตะบะปััะฐะตั ะฒะบะปะฐะดะบั
- โ ะะพะผะตั ะฐะบัะธะฒะฝะพะณะพ ัะฐะณะฐ ะพัะพะฑัะฐะถะฐะตััั ะฝะฐ ะฒะบะปะฐะดะบะต
- โ API `/api/trade/permissions` ัะฐะฑะพัะฐะตั ะบะพััะตะบัะฝะพ
- โ API `/api/trade/permission` ัะฐะฑะพัะฐะตั ะบะพััะตะบัะฝะพ
- โ ะะทะผะตะฝะตะฝะธั ัะพััะฐะฝััััั ะฝะฐ ัะตัะฒะตัะต

---

## ะะฐะบะปััะตะฝะธะต

ะัะต ะฟัะพะฑะปะตะผั ะธัะฟัะฐะฒะปะตะฝั. ะขะตะฟะตัั:
1. ะะฝะพะฟะบะฐ ะฒะบะปััะตะฝะธั/ะฒัะบะปััะตะฝะธั ะฒะฐะปััั ะพัะพะฑัะฐะถะฐะตััั ะธ ัะฐะฑะพัะฐะตั
2. ะะพะผะตั ัะพัะณะพะฒะพะณะพ ัะฐะณะฐ ะพัะพะฑัะฐะถะฐะตััั ะฝะฐ ะฒะบะปะฐะดะบะฐั ะฒะฐะปัั
3. UI ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฑะฝะพะฒะปัะตััั ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ ัะฐะทัะตัะตะฝะธะน ะธ ัะฐะณะพะฒ
