<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–¢–µ—Å—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ BE</title>
    <style>
        body {
            background: #0a0a0a;
            color: #e0e0e0;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 5px;
        }
        h3 {
            color: #4CAF50;
            margin-top: 0;
        }
        pre {
            background: #0a0a0a;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 3px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1976D2;
        }
        #console {
            background: #0a0a0a;
            padding: 10px;
            border-radius: 3px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .log-line {
            margin: 2px 0;
        }
        .log-info { color: #2196F3; }
        .log-warn { color: #FF9800; }
        .log-error { color: #f44336; }
        .log-success { color: #4CAF50; }
    </style>
</head>
<body>
    <h1>üîç –¢–µ—Å—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ BE (—Ü–µ–Ω–∞ –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏)</h1>
    
    <div class="test-section">
        <h3>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ API</h3>
        <button onclick="testAPI()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å /api/trade/indicators</button>
        <pre id="apiResult">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏...</pre>
    </div>
    
    <div class="test-section">
        <h3>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ DOM —ç–ª–µ–º–µ–Ω—Ç–æ–≤</h3>
        <button onclick="testDOM()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤</button>
        <pre id="domResult">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏...</pre>
    </div>
    
    <div class="test-section">
        <h3>3. –ò–º–∏—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞</h3>
        <button onclick="testUpdate()">–ò–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å BE</button>
        <button onclick="testUpdateWithoutBE()">–ò–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–ï–ó BE</button>
        <pre id="updateResult">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏...</pre>
    </div>
    
    <div class="test-section">
        <h3>4. –ö–æ–Ω—Å–æ–ª—å –ª–æ–≥–æ–≤</h3>
        <button onclick="clearConsole()">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <div id="console"></div>
    </div>

    <script>
        const consoleEl = document.getElementById('console');
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.log
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        function addLog(type, ...args) {
            const line = document.createElement('div');
            line.className = `log-line log-${type}`;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${args.join(' ')}`;
            consoleEl.appendChild(line);
            consoleEl.scrollTop = consoleEl.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog('info', ...args);
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addLog('warn', ...args);
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog('error', ...args);
        };
        
        function clearConsole() {
            consoleEl.innerHTML = '';
        }
        
        async function testAPI() {
            const resultEl = document.getElementById('apiResult');
            resultEl.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            
            try {
                console.log('[API] –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ /api/trade/indicators...');
                const response = await fetch('/api/trade/indicators?base_currency=DOGE&quote_currency=USDT');
                console.log('[API] –°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:', response.status, response.statusText);
                
                const data = await response.json();
                console.log('[API] –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ:', data);
                
                resultEl.textContent = JSON.stringify(data, null, 2);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ BE
                if (data.autotrade_levels && data.autotrade_levels.breakeven_price) {
                    console.log('[API] ‚úÖ BE –Ω–∞–π–¥–µ–Ω–æ:', data.autotrade_levels.breakeven_price);
                } else {
                    console.warn('[API] ‚ö†Ô∏è BE –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –æ—Ç–≤–µ—Ç–µ!');
                }
            } catch (error) {
                console.error('[API] ‚ùå –û—à–∏–±–∫–∞:', error);
                resultEl.textContent = '–û—à–∏–±–∫–∞: ' + error.message;
            }
        }
        
        function testDOM() {
            const resultEl = document.getElementById('domResult');
            console.log('[DOM] –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤...');
            
            const markers = {
                'markerSell': document.getElementById('markerSell'),
                'markerBE': document.getElementById('markerBE'),
                'markerPrice': document.getElementById('markerPrice'),
                'markerLast': document.getElementById('markerLast'),
                'markerStart': document.getElementById('markerStart'),
                'markerBuy': document.getElementById('markerBuy')
            };
            
            let result = '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–∞—Ä–∫–µ—Ä–æ–≤:\n\n';
            let allFound = true;
            
            for (const [id, element] of Object.entries(markers)) {
                const found = element !== null;
                result += `${id}: ${found ? '‚úÖ –ù–ê–ô–î–ï–ù' : '‚ùå –ù–ï –ù–ê–ô–î–ï–ù'}\n`;
                console.log(`[DOM] ${id}:`, found ? '‚úÖ' : '‚ùå');
                if (!found) allFound = false;
            }
            
            result += '\n' + (allFound ? '‚úÖ –í—Å–µ –º–∞—Ä–∫–µ—Ä—ã –Ω–∞–π–¥–µ–Ω—ã!' : '‚ùå –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–∞—Ä–∫–µ—Ä—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç!');
            resultEl.textContent = result;
            
            if (allFound) {
                console.log('[DOM] ‚úÖ –í—Å–µ –º–∞—Ä–∫–µ—Ä—ã –Ω–∞–π–¥–µ–Ω—ã –≤ DOM');
            } else {
                console.error('[DOM] ‚ùå –ù–µ –≤—Å–µ –º–∞—Ä–∫–µ—Ä—ã –Ω–∞–π–¥–µ–Ω—ã!');
            }
        }
        
        function testUpdate() {
            const resultEl = document.getElementById('updateResult');
            console.log('[UPDATE] –ò–º–∏—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –° BE...');
            
            const testLevels = {
                active_cycle: true,
                active_step: 2,
                total_steps: 16,
                current_price: 0.1585,
                start_price: 0.1549,
                breakeven_price: 0.1567,  // ‚Üê BE –ï–°–¢–¨!
                last_buy_price: 0.1482,
                sell_price: 0.1583,
                next_buy_price: 0.1408,
                current_growth_pct: 1.15,
                invested_usd: 20.0,
                base_volume: 131.58
            };
            
            console.log('[UPDATE] –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:', testLevels);
            resultEl.textContent = '–î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:\n' + JSON.stringify(testLevels, null, 2);
            
            // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–µ—Å–ª–∏ –æ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞)
            if (typeof updateAutoTradeLevels === 'function') {
                console.log('[UPDATE] –í—ã–∑—ã–≤–∞–µ–º updateAutoTradeLevels...');
                updateAutoTradeLevels(testLevels);
                console.log('[UPDATE] ‚úÖ –§—É–Ω–∫—Ü–∏—è –≤—ã–∑–≤–∞–Ω–∞');
            } else {
                console.warn('[UPDATE] ‚ö†Ô∏è –§—É–Ω–∫—Ü–∏—è updateAutoTradeLevels –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            }
        }
        
        function testUpdateWithoutBE() {
            const resultEl = document.getElementById('updateResult');
            console.log('[UPDATE] –ò–º–∏—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ë–ï–ó BE...');
            
            const testLevels = {
                active_cycle: false,
                active_step: null,
                total_steps: 16,
                current_price: 0.1585,
                start_price: null,
                breakeven_price: null,  // ‚Üê BE –û–¢–°–£–¢–°–¢–í–£–ï–¢!
                last_buy_price: null,
                sell_price: null,
                next_buy_price: 0.1549,
                current_growth_pct: null,
                invested_usd: 0,
                base_volume: 0
            };
            
            console.log('[UPDATE] –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–±–µ–∑ BE):', testLevels);
            resultEl.textContent = '–î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–±–µ–∑ BE):\n' + JSON.stringify(testLevels, null, 2);
            
            // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–µ—Å–ª–∏ –æ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞)
            if (typeof updateAutoTradeLevels === 'function') {
                console.log('[UPDATE] –í—ã–∑—ã–≤–∞–µ–º updateAutoTradeLevels...');
                updateAutoTradeLevels(testLevels);
                console.log('[UPDATE] ‚úÖ –§—É–Ω–∫—Ü–∏—è –≤—ã–∑–≤–∞–Ω–∞');
            } else {
                console.warn('[UPDATE] ‚ö†Ô∏è –§—É–Ω–∫—Ü–∏—è updateAutoTradeLevels –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            console.log('[INIT] –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç—ã...');
            setTimeout(testDOM, 500);
        });
    </script>
</body>
</html>
