# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø—Ä–æ—Ñ–∏—Ç–æ–≤: –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Ü–∏–∫–ª—ã

## üìã –ü—Ä–æ–±–ª–µ–º–∞

–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏—Ç—ã —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ü–∏–∫–ª–æ–≤ **—Å—É–º–º–∏—Ä–æ–≤–∞–ª–∏—Å—å** –º–µ–∂–¥—É —Ü–∏–∫–ª–∞–º–∏:
- –í `get_formatted_logs()` –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `pnl_sum` –Ω–∞–∫–∞–ø–ª–∏–≤–∞–ª–∞ –ø—Ä–æ—Ñ–∏—Ç—ã –≤—Å–µ—Ö –ø—Ä–æ–¥–∞–∂
- –í `get_stats()` –º–µ—Ç–æ–¥ `total_pnl` —Å—É–º–º–∏—Ä–æ–≤–∞–ª –≤—Å–µ PnL –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è
- –≠—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ, —á—Ç–æ –ø—Ä–æ—Ñ–∏—Ç —Ä–∞—Å—Ç—ë—Ç –æ—Ç —Ü–∏–∫–ª–∞ –∫ —Ü–∏–∫–ª—É

**–ü—Ä–∏–º–µ—Ä —Å—Ç–∞—Ä–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è:**
```
–¶–∏–∫–ª 1: –ü—Ä–æ—Ñ–∏—Ç = +10 USDT
–¶–∏–∫–ª 2: –ü—Ä–æ—Ñ–∏—Ç = +15 USDT (–ø–æ–∫–∞–∑—ã–≤–∞–ª–æ—Å—å +25 USDT)
–¶–∏–∫–ª 3: –ü—Ä–æ—Ñ–∏—Ç = -5 USDT (–ø–æ–∫–∞–∑—ã–≤–∞–ª–æ—Å—å +20 USDT)
```

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–¢–µ–ø–µ—Ä—å **–∫–∞–∂–¥—ã–π —Ç–æ—Ä–≥–æ–≤—ã–π —Ü–∏–∫–ª –∏–º–µ–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –ø—Ä–æ—Ñ–∏—Ç**:
- –ü—Ä–æ—Ñ–∏—Ç —Ü–∏–∫–ª–∞ = (—Å—É–º–º–∞ –æ—Ç –ø—Ä–æ–¥–∞–∂–∏) - (—Å—É–º–º–∞ –≤—Å–µ—Ö –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π –≤ —Ü–∏–∫–ª–µ)
- –ü—Ä–æ—Ñ–∏—Ç –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –≤ –º–æ–º–µ–Ω—Ç –ø—Ä–æ–¥–∞–∂–∏ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–æ–ª–µ `total_pnl` –∑–∞–ø–∏—Å–∏
- –ü—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –ª–æ–≥–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ—Ñ–∏—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ü–∏–∫–ª–∞, –∞ –Ω–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–π

**–ü—Ä–∏–º–µ—Ä –Ω–æ–≤–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è:**
```
–¶–∏–∫–ª 1: –ü—Ä–æ—Ñ–∏—Ç = +10 USDT
–¶–∏–∫–ª 2: –ü—Ä–æ—Ñ–∏—Ç = +15 USDT
–¶–∏–∫–ª 3: –ü—Ä–æ—Ñ–∏—Ç = -5 USDT
```

## üîß –í–Ω–µ—Å—ë–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. `trade_logger.py` - –ú–µ—Ç–æ–¥ `get_formatted_logs()`

**–ë—ã–ª–æ:**
```python
pnl_sum = 0.0
for log in logs:
    if log.get('type') == 'sell':
        pnl_sum += log.get('pnl', 0)  # ‚ùå –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏—Ç–∞
        line = f"...–ü—Ä–æ—Ñ–∏—Ç:{pnl_sum:.4f}..."
```

**–°—Ç–∞–ª–æ:**
```python
for log in logs:
    if log.get('type') == 'sell':
        cycle_profit = log.get('total_pnl', 0)  # ‚úÖ –ü—Ä–æ—Ñ–∏—Ç –≠–¢–û–ì–û —Ü–∏–∫–ª–∞
        line = f"...–ü—Ä–æ—Ñ–∏—Ç:{cycle_profit:.4f}; –ò–Ω–≤–µ—Å—Ç:{log.get('total_invested', 0):.4f}..."
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –£–±—Ä–∞–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `pnl_sum` (–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏—Ç)
- –ò—Å–ø–æ–ª—å–∑—É–µ–º `total_pnl` –∏–∑ –∑–∞–ø–∏—Å–∏ (–ø—Ä–æ—Ñ–∏—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ü–∏–∫–ª–∞)
- –î–æ–±–∞–≤–∏–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—É–º–º—ã –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π —Ü–∏–∫–ª–∞

### 2. `trade_logger.py` - –ú–µ—Ç–æ–¥ `get_stats()`

**–ë—ã–ª–æ:**
```python
total_pnl = sum(log.get('pnl', 0) for log in logs if log.get('type') == 'sell')
return {
    'total_pnl': round(total_pnl, 4),  # ‚ùå –°—É–º–º–∞—Ä–Ω—ã–π –ø—Ä–æ—Ñ–∏—Ç
    ...
}
```

**–°—Ç–∞–ª–æ:**
```python
cycle_profits = [log.get('total_pnl', 0) for log in logs if log.get('type') == 'sell']
last_cycle_profit = cycle_profits[-1] if cycle_profits else 0.0
avg_cycle_profit = sum(cycle_profits) / len(cycle_profits) if cycle_profits else 0.0

return {
    'last_cycle_profit': round(last_cycle_profit, 4),    # ‚úÖ –ü–æ—Å–ª–µ–¥–Ω–∏–π —Ü–∏–∫–ª
    'avg_cycle_profit': round(avg_cycle_profit, 4),      # ‚úÖ –°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ—Ñ–∏—Ç
    'total_cycles': len(cycle_profits),                   # ‚úÖ –ö–æ–ª-–≤–æ —Ü–∏–∫–ª–æ–≤
    'cycle_profits': [round(p, 4) for p in cycle_profits],  # ‚úÖ –í—Å–µ –ø—Ä–æ—Ñ–∏—Ç—ã
    ...
}
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –£–±—Ä–∞–ª–∏ –ø–æ–ª–µ `total_pnl` (—Å—É–º–º–∞—Ä–Ω—ã–π –ø—Ä–æ—Ñ–∏—Ç –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è)
- –î–æ–±–∞–≤–∏–ª–∏ `last_cycle_profit` (–ø—Ä–æ—Ñ–∏—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ü–∏–∫–ª–∞)
- –î–æ–±–∞–≤–∏–ª–∏ `avg_cycle_profit` (—Å—Ä–µ–¥–Ω–∏–π –ø—Ä–æ—Ñ–∏—Ç —Ü–∏–∫–ª–∞)
- –î–æ–±–∞–≤–∏–ª–∏ `total_cycles` (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤)
- –î–æ–±–∞–≤–∏–ª–∏ `cycle_profits` (—Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–æ—Ñ–∏—Ç–æ–≤ –ø–æ —Ü–∏–∫–ª–∞–º)

### 3. `trade_logger.py` - –£–¥–∞–ª–µ–Ω–æ –ø–æ–ª–µ `self.total_pnl`

**–ë—ã–ª–æ:**
```python
self.total_pnl = {}  # {currency: float}
```

**–°—Ç–∞–ª–æ:**
```python
# DEPRECATED: –≠—Ç–æ –ø–æ–ª–µ –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
# –ü—Ä–æ—Ñ–∏—Ç—ã —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ª–æ–≥–∞—Ö (–ø–æ–ª–µ 'total_pnl' –≤ –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ sell)
# –∏ –Ω–µ —Å—É–º–º–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É —Ü–∏–∫–ª–∞–º–∏
```

## üìä –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å

### –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ:
```
[HH:MM:SS] [CURRENCY] Buy{100.0000; –ö—É—Ä—Å:1.2345; ‚ÜìŒî%:-2.50; ‚Üì%:-5.00; –ò–Ω–≤–µ—Å—Ç:250.0000}
```
- `100.0000` - —Å—É–º–º–∞ –ø–æ–∫—É–ø–∫–∏ –≤ USDT
- `–ö—É—Ä—Å` - —Ü–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏
- `‚ÜìŒî%` - –ø—Ä–æ—Ü–µ–Ω—Ç –ø–∞–¥–µ–Ω–∏—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø–æ–∫—É–ø–∫–∏
- `‚Üì%` - –æ–±—â–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –ø–∞–¥–µ–Ω–∏—è –æ—Ç –ø–µ—Ä–≤–æ–π –ø–æ–∫—É–ø–∫–∏
- `–ò–Ω–≤–µ—Å—Ç` - **–Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–∞—è** —Å—É–º–º–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π –≤ —Ç–µ–∫—É—â–µ–º —Ü–∏–∫–ª–µ

### –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤ –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ:
```
[HH:MM:SS] [CURRENCY] Sell{350.0000; –ö—É—Ä—Å:1.4000; ‚ÜëŒî%:5.00; PnL:10.5000; –ü—Ä–æ—Ñ–∏—Ç:100.0000; –ò–Ω–≤–µ—Å—Ç:250.0000}
```
- `350.0000` - —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂–∏ –≤ USDT
- `–ö—É—Ä—Å` - —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏
- `‚ÜëŒî%` - –ø—Ä–æ—Ü–µ–Ω—Ç —Ä–æ—Å—Ç–∞ –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–∫—É–ø–∫–∏
- `PnL` - PnL –æ—Ç –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Ç–æ—á–Ω—ã–º)
- `–ü—Ä–æ—Ñ–∏—Ç` - **–ü–†–û–§–ò–¢ –¶–ò–ö–õ–ê** = —Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂–∏ - –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ = 350.0000 - 250.0000 = 100.0000
- `–ò–Ω–≤–µ—Å—Ç` - —Å—É–º–º–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –≤–ª–æ–∂–µ–Ω–∞ –≤ —ç—Ç–æ—Ç —Ü–∏–∫–ª

### –§–æ—Ä–º–∞—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (API `/api/trade/logs/stats`):
```json
{
  "success": true,
  "stats": {
    "total_entries": 150,
    "total_buys": 75,
    "total_sells": 75,
    "total_investment": 18750.0,
    "last_cycle_profit": 45.2500,      // –ü—Ä–æ—Ñ–∏—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ü–∏–∫–ª–∞
    "avg_cycle_profit": 38.7500,       // –°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ—Ñ–∏—Ç —Ü–∏–∫–ª–∞
    "total_cycles": 75,                // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–∏–∫–ª–æ–≤
    "cycle_profits": [10.0, 15.5, -5.0, 45.25, ...],  // –í—Å–µ –ø—Ä–æ—Ñ–∏—Ç—ã
    "currency": "BTC",
    "currencies_count": 1
  }
}
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

1. **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å**: –ö–∞–∂–¥—ã–π —Ü–∏–∫–ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–≤–æ–π —Ä–µ–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
2. **–ß–µ—Å—Ç–Ω–æ—Å—Ç—å**: –í–∏–¥–Ω—ã –∫–∞–∫ –ø—Ä–∏–±—ã–ª—å–Ω—ã–µ, —Ç–∞–∫ –∏ —É–±—ã—Ç–æ—á–Ω—ã–µ —Ü–∏–∫–ª—ã
3. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞**: –ú–æ–∂–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ —Ü–∏–∫–ª–∞–º
4. **–ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å**: –ü—Ä–æ—Ñ–∏—Ç = –≤—ã—Ä—É—á–∫–∞ - –∑–∞—Ç—Ä–∞—Ç—ã (–±–∞–∑–æ–≤–∞—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è)

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞

–ß—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞** –∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ü–∏–∫–ª–æ–≤
2. **–û—Ç–∫—Ä–æ–π—Ç–µ –ª–æ–≥–∏** —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (`/api/trade/logs`)
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ**, —á—Ç–æ:
   - –ü—Ä–æ—Ñ–∏—Ç –∫–∞–∂–¥–æ–π –ø—Ä–æ–¥–∞–∂–∏ = (—Å—É–º–º–∞ –ø—Ä–æ–¥–∞–∂–∏) - (–ò–Ω–≤–µ—Å—Ç)
   - –ü—Ä–æ—Ñ–∏—Ç—ã –Ω–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –º–µ–∂–¥—É —Ü–∏–∫–ª–∞–º–∏
   - –ö–∞–∂–¥—ã–π —Ü–∏–∫–ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

## üìù –ü—Ä–∏–º–µ—Ä

```
–¶–∏–∫–ª 1:
  Buy{100; –ö—É—Ä—Å:1.0; –ò–Ω–≤–µ—Å—Ç:100}
  Buy{50; –ö—É—Ä—Å:0.95; –ò–Ω–≤–µ—Å—Ç:150}
  Sell{165; –ö—É—Ä—Å:1.1; –ü—Ä–æ—Ñ–∏—Ç:15; –ò–Ω–≤–µ—Å—Ç:150}  ‚Üê –ü—Ä–æ—Ñ–∏—Ç = 165 - 150 = 15

–¶–∏–∫–ª 2:
  Buy{100; –ö—É—Ä—Å:1.0; –ò–Ω–≤–µ—Å—Ç:100}
  Buy{100; –ö—É—Ä—Å:0.9; –ò–Ω–≤–µ—Å—Ç:200}
  Sell{220; –ö—É—Ä—Å:1.1; –ü—Ä–æ—Ñ–∏—Ç:20; –ò–Ω–≤–µ—Å—Ç:200}  ‚Üê –ü—Ä–æ—Ñ–∏—Ç = 220 - 200 = 20
                                                 (–ù–ï 35 = 15+20!)
```

## üìÖ –î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–î–∞—Ç–∞:** 2024-01-XX  
**–§–∞–π–ª—ã:** `trade_logger.py`  
**–ö–æ–º–º–∏—Ç:** [–±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ—Å–ª–µ git commit]

---

‚úÖ **–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞**: –ü—Ä–æ—Ñ–∏—Ç—ã —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ü–∏–∫–ª–æ–≤ —Ç–µ–ø–µ—Ä—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã –∏ –Ω–µ —Å—É–º–º–∏—Ä—É—é—Ç—Å—è –º–µ–∂–¥—É —Å–æ–±–æ–π.
