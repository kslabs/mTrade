================================================================================
–ù–ê–°–¢–û–Ø–©–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: DEADLOCK (–í–ó–ê–ò–ú–ù–ê–Ø –ë–õ–û–ö–ò–†–û–í–ö–ê)
================================================================================

–í–´ –ë–´–õ–ò –ü–†–ê–í–´! –Ø –∏—Å–∫–∞–ª –Ω–µ —Ç–∞–º.

–ù–ê–°–¢–û–Ø–©–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:
====================

API ENDPOINT `/api/autotrader/reset_cycle` –ó–ê–í–ò–°–ê–ï–¢!
-----------------------------------------------------

–ü–û–ß–ï–ú–£ –≠–¢–û –ü–†–û–ò–°–•–û–î–ò–õ–û:
------------------------

1. AutoTraderV2 –∏–º–µ–µ—Ç –≥–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –≤–∞–ª—é—Ç—ã
2. –î–ª—è –∫–∞–∂–¥–æ–π –≤–∞–ª—é—Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è threading.Lock (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
3. –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –±–µ—Ä—ë—Ç Lock –∏ –î–û–õ–ì–û –¥–µ—Ä–∂–∏—Ç –µ–≥–æ:
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω—ã (API –∑–∞–ø—Ä–æ—Å –∫ –±–∏—Ä–∂–µ)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ (–µ—â—ë API –∑–∞–ø—Ä–æ—Å—ã)
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–±–∞–µ–≤/–ø—Ä–æ–¥–∞–∂ (–µ—â—ë –±–æ–ª—å—à–µ API)
   - –í—Å—ë —ç—Ç–æ –ø–æ–¥ –û–î–ù–û–ô –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π!

4. –ö–æ–≥–¥–∞ –≤—ã –Ω–∞–∂–∏–º–∞–µ—Ç–µ "–°–±—Ä–æ—Å —Ü–∏–∫–ª–∞":
   - API endpoint –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å —Ç–æ—Ç –∂–µ Lock
   - –ù–û –≥–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª —É–∂–µ –¥–µ—Ä–∂–∏—Ç –µ–≥–æ!
   - API endpoint –ó–ê–í–ò–°–ê–ï–¢ –≤ –æ–∂–∏–¥–∞–Ω–∏–∏
   - Timeout (5 —Å–µ–∫—É–Ω–¥) ‚Üí Connection reset

–¢–ï–•–ù–ò–ß–ï–°–ö–ò:
-----------

–ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª (autotrader_v2.py, —Å—Ç—Ä–æ–∫–∞ 302):
```python
lock = self._get_lock(base)
with lock:  # ‚Üê –î–µ—Ä–∂–∏—Ç lock –î–û–õ–ì–û (API –∑–∞–ø—Ä–æ—Å—ã!)
    # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω—ã
    price = self._get_market_price(base, quote)  # API!
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
    if self._check_and_reset_if_empty(base, quote, cycle):  # API!
    # –†–µ–±–∞–∏, –ø—Ä–æ–¥–∞–∂–∏ –∏ —Ç.–¥.
```

API endpoint (mTrade.py, —Å—Ç—Ä–æ–∫–∞ 1381):
```python
lock = AUTO_TRADER._get_lock(base_currency)
with lock:  # ‚Üê –ó–ê–í–ò–°–ê–ï–¢! –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –Ω–µ –æ—Ç–ø—É—Å–∫–∞–µ—Ç lock!
    # –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
```

–†–µ–∑—É–ª—å—Ç–∞—Ç: DEADLOCK (–≤–∑–∞–∏–º–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)

================================================================================
–†–ï–®–ï–ù–ò–ï:
========

–ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ TIMEOUT –î–õ–Ø LOCK
-------------------------------

–í–º–µ—Å—Ç–æ:
```python
with lock:
    # –∫–æ–¥
```

–ò—Å–ø–æ–ª—å–∑—É–µ–º:
```python
acquired = lock.acquire(timeout=3.0)  # –ñ–¥—ë–º –º–∞–∫—Å–∏–º—É–º 3 —Å–µ–∫—É–Ω–¥—ã
if not acquired:
    return error_response("–¶–∏–∫–ª –∑–∞–Ω—è—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ")

try:
    # –∫–æ–¥
finally:
    lock.release()
```

–ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê:
-------------

1. ‚úì API –Ω–µ –∑–∞–≤–∏—Å–∞–µ—Ç –Ω–∞–≤—Å–µ–≥–¥–∞
2. ‚úì –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –≤–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
3. ‚úì –ú–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É —á–µ—Ä–µ–∑ –ø–∞—Ä—É —Å–µ–∫—É–Ω–¥
4. ‚úì –°–µ—Ä–≤–µ—Ä –Ω–µ –ø–∞–¥–∞–µ—Ç

================================================================================
–ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û:
===============

–§–ê–ô–õ: mTrade.py
---------------

1. Endpoint `/api/autotrader/reset_cycle`:
   - –î–æ–±–∞–≤–ª–µ–Ω `lock.acquire(timeout=3.0)`
   - –ü—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTTP 503 —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `try/finally` –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ release

2. Endpoint `/api/autotrader/resume_cycle`:
   - –¢–æ –∂–µ —Å–∞–º–æ–µ

–¢–ï–ü–ï–†–¨:
-------

–ï—Å–ª–∏ –≥–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–∞–ª—é—Ç—É:
  ‚Üí API –≤–µ—Ä–Ω—ë—Ç: "–¶–∏–∫–ª —Å–µ–π—á–∞—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥"
  ‚Üí HTTP 503 (Service Temporarily Unavailable)
  ‚Üí –ú–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É

–ï—Å–ª–∏ lock —Å–≤–æ–±–æ–¥–µ–Ω:
  ‚Üí API —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
  ‚Üí –¶–∏–∫–ª –±—É–¥–µ—Ç —Å–±—Ä–æ—à–µ–Ω/–≤–æ–∑–æ–±–Ω–æ–≤–ª—ë–Ω
  ‚Üí –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç!

================================================================================
–ß–¢–û –î–ï–õ–ê–¢–¨ –î–ê–õ–¨–®–ï:
==================

1. –ü–ï–†–ï–ó–ê–ü–£–°–¢–ò–¢–¨ –°–ï–†–í–ï–† (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
   ---------------------------------
   Ctrl+C –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ —Å mTrade.py
   python mTrade.py

2. –ü–†–û–í–ï–†–ò–¢–¨ –†–ê–ë–û–¢–£:
   -----------------
   python test_cycle_buttons.py

   –¢–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è –í–°–ï–• –≤–∞–ª—é—Ç!

3. –ï–°–õ–ò –ü–û–õ–£–ß–ê–ï–¢–ï 503:
   -------------------
   –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ! –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä —Å–µ–π—á–∞—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —ç—Ç—É –≤–∞–ª—é—Ç—É.
   –ü–æ–¥–æ–∂–¥–∏—Ç–µ 2-3 —Å–µ–∫—É–Ω–¥—ã –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.

================================================================================
–ü–û–ß–ï–ú–£ –Ø –ò–°–ö–ê–õ –ù–ï –¢–ê–ú:
=======================

1. –Ø –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏–ª, —á—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –≤–∞–ª—é—Ç –≤ —Ñ–∞–π–ª–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
   ‚Üí –≠—Ç–æ –±—ã–ª–∞ —Ä–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞, –Ω–æ –Ω–µ –æ—Å–Ω–æ–≤–Ω–∞—è!

2. –Ø –¥–æ–±–∞–≤–∏–ª –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
   ‚Üí –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ, –Ω–æ –Ω–µ —Ä–µ—à–∏–ª–æ –∑–∞–≤–∏—Å–∞–Ω–∏–µ

3. –Ø –Ω–µ –ø—Ä–æ–≤–µ—Ä–∏–ª –†–ï–ê–õ–¨–ù–û–ï –ø–æ–≤–µ–¥–µ–Ω–∏–µ API
   ‚Üí –¢–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –∑–∞–ø—É—Å—Ç–∏–ª diagnose_reset.py, —É–≤–∏–¥–µ–ª —Ç–∞–π–º–∞—É—Ç

–ò–ó–í–õ–ï–ß–Å–ù–ù–´–ô –£–†–û–ö:
-----------------

‚úì –í—Å–µ–≥–¥–∞ —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –†–ï–ê–õ–¨–ù–û–ï –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–ª–æ–≥–∏, —Ç–∞–π–º–∞—É—Ç—ã)
‚úì –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
‚úì –ù–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É, –∞ –ù–ê–•–û–î–ò–¢–¨ –µ—ë

================================================================================
–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï:
===========

–ü–†–û–ë–õ–ï–ú–ê –ù–ê–ô–î–ï–ù–ê:     DEADLOCK (–≤–∑–∞–∏–º–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ Lock)
–†–ï–®–ï–ù–ò–ï –ü–†–ò–ú–ï–ù–ï–ù–û:    Timeout –¥–ª—è Lock (3 —Å–µ–∫—É–Ω–¥—ã)
–†–ï–ó–£–õ–¨–¢–ê–¢:           API –±–æ–ª—å—à–µ –Ω–µ –∑–∞–≤–∏—Å–∞–µ—Ç!

–ü–ï–†–ï–ó–ê–ü–£–°–¢–ò–¢–ï –°–ï–†–í–ï–† –ò –ü–†–û–í–ï–†–¨–¢–ï! üöÄ

================================================================================
