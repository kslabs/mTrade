# üéØ –ò—Ç–æ–≥–æ–≤–æ–µ —Ä–µ–∑—é–º–µ: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. **–û—Ç–∫–∞—Ç –æ—à–∏–±–æ—á–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π**
‚úÖ –£–¥–∞–ª—ë–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π "–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï: –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ü–∏–∫–ª –ø—Ä–∏ –õ–Æ–ë–û–ô –ø–æ–∫—É–ø–∫–µ > 0"  
‚úÖ –£–¥–∞–ª–µ–Ω—ã –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ –Ω–æ—Ä–º–∞–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É

### 2. **–£–ø—Ä–æ—â–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Å—Ç–∞—Ä—Ç–∞ —Ü–∏–∫–ª–∞**
‚úÖ –í `_try_start_cycle` —É–¥–∞–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
- ‚ùå `if cycle.get('base_volume', 0) > 0: return`
- ‚ùå `if cycle.get('start_price', 0) > 0: return`
- ‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ BASE –≤–∞–ª—é—Ç—ã

‚úÖ –û—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ **–Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ** –ø—Ä–æ–≤–µ—Ä–∫–∏:
- ‚úì `if cycle.get('active'): return` ‚Äî —Ü–∏–∫–ª —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω
- ‚úì `if cycle.get('pending_start'): return` ‚Äî —Ü–∏–∫–ª –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- ‚úì –ê—Ç–æ–º–∞—Ä–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ `Lock`

### 3. **–ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è**
‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞:
1. **Lock –Ω–∞ —É—Ä–æ–≤–Ω–µ –≤–∞–ª—é—Ç—ã** ‚Äî –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã
2. **–§–ª–∞–≥–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è** (`active`, `pending_start`) ‚Äî –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–π —Å—Ç–∞—Ä—Ç
3. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏** –≤ –≥–ª–∞–≤–Ω–æ–º —Ü–∏–∫–ª–µ ‚Äî `_try_start_cycle` –∏ `_try_rebuy` –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –≤–º–µ—Å—Ç–µ

### 4. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥—Ä–æ–±–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**
‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `AUTOTRADER_ARCHITECTURE.md` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º:
- –ì–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∞–ª—é—Ç
- –ú–µ—Ö–∞–Ω–∏–∑–º–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∞–ª—é—Ç
- –û–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫–∞–∂–¥–æ–π –≤–∞–ª—é—Ç–µ
- –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π –∑–∞—â–∏—Ç—ã –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- –ö–ª—é—á–µ–≤—ã—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ —Ä–∞–±–æ—Ç—ã

‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `AUTOTRADER_VISUAL_SCHEME.md` —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π:
- –ë–ª–æ–∫-—Å—Ö–µ–º–∞ –≥–ª–∞–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π `_try_start_cycle` –∏ `_try_rebuy`
- –°—Ö–µ–º–∞ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π –∑–∞—â–∏—Ç—ã
- –í—Ä–µ–º–µ–Ω–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∞–ª—é—Ç
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Ü–∏–∫–ª–∞

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
# ‚ùå –ü–†–û–ë–õ–ï–ú–ê 1: –ò–∑–±—ã—Ç–æ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤
if cycle.get('base_volume', 0) > 0:
    return  # –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –æ—Å—Ç–∞—Ç–∫–æ–≤

# ‚ùå –ü–†–û–ë–õ–ï–ú–ê 2: –ò–∑–±—ã—Ç–æ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π —Ü–µ–Ω—ã
if cycle.get('start_price', 0) > 0:
    return  # –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π —Ü–µ–Ω—ã

# ‚ùå –ü–†–û–ë–õ–ï–ú–ê 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ BASE
balances = api_client.balances()
base_balance = balances.get(base, {}).get('available', 0)
if base_balance > min_trade_amount:
    return  # –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –æ—Å—Ç–∞—Ç–∫–æ–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¶–∏–∫–ª –Ω–µ –º–æ–≥ —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å –¥–∞–∂–µ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø–æ–∫—É–ø–∫–∏, –µ—Å–ª–∏ –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å –æ—Å—Ç–∞—Ç–∫–∏ –∏–ª–∏ –±—ã–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤–∞—è —Ü–µ–Ω–∞.

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```python
# ‚úÖ –¢–û–õ–¨–ö–û –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
if cycle.get('active') or cycle.get('pending_start'):
    return  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¢–û–õ–¨–ö–û —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ü–∏–∫–ª–∞
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¶–∏–∫–ª —Å—Ç–∞—Ä—Ç—É–µ—Ç –ø—Ä–∏ –ª—é–±–æ–π —É—Å–ø–µ—à–Ω–æ–π –ø–æ–∫—É–ø–∫–µ > 0, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤.

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–µ—Ä–∞

### **–ì–ª–∞–≤–Ω—ã–π –ø–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
```
AutoTrader.start() 
    ‚Üí –ó–∞–ø—É—Å–∫ –ø–æ—Ç–æ–∫–∞ —Å _run()
        ‚Üí while running:
            1. –ü—Ä–æ–≤–µ—Ä–∫–∞ auto_trade_enabled
            2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö –≤–∞–ª—é—Ç
            3. FOR –∫–∞–∂–¥–æ–π –≤–∞–ª—é—Ç—ã:
                - –ü—Ä–æ–≤–µ—Ä–∫–∞ WebSocket –ø–æ–¥–ø–∏—Å–∫–∏
                - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω–æ–π —Ü–µ–Ω—ã
                - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ü–∏–∫–ª–∞
                - IF active: _try_rebuy()
                - ELSE: _try_start_cycle()
            4. sleep(0.5 —Å–µ–∫)
            5. –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ
```

### **–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:**
- **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** ‚Äî –æ–¥–Ω–∞ –≤–∞–ª—é—Ç–∞ –∑–∞ —Ä–∞–∑
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏** ‚Äî —Å—Ç–∞—Ä—Ç –∏ —É—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –≤–º–µ—Å—Ç–µ
- **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å** ‚Äî Lock –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- **–ü—Ä–æ—Å—Ç–æ—Ç–∞** ‚Äî –º–∏–Ω–∏–º—É–º –ø—Ä–æ–≤–µ—Ä–æ–∫, –º–∞–∫—Å–∏–º—É–º –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏

## üéØ –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### **–§–∞–π–ª:** `autotrader.py`

#### **1. –§—É–Ω–∫—Ü–∏—è `_try_start_cycle` (—Å—Ç—Ä–æ–∫–∞ ~600)**
**–ë—ã–ª–æ:**
```python
if cycle.get('base_volume', 0) > 0:
    return
if cycle.get('start_price', 0) > 0:
    return
# ... –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ BASE ...
```

**–°—Ç–∞–ª–æ:**
```python
if cycle.get('active') or cycle.get('pending_start'):
    return
```

#### **2. –§—É–Ω–∫—Ü–∏—è `_try_start_cycle_impl` (—Å—Ç—Ä–æ–∫–∞ ~700)**
**–ë—ã–ª–æ:**
```python
if cycle.get('base_volume', 0) > 0:
    return
if cycle.get('start_price', 0) > 0:
    return
```

**–°—Ç–∞–ª–æ:**
```python
if cycle.get('active') or cycle.get('pending_start'):
    return
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫**
```powershell
python -m py_compile autotrader.py
```
‚úÖ –û—à–∏–±–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ 2: Git diff**
```powershell
git diff autotrader.py
```
‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã**
- ‚úÖ Lock —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ —á–µ—Ä–µ–∑ `_locks_creation_lock`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∏ –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –º–∏–Ω–∏–º—É–º–∞
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤ –≥–ª–∞–≤–Ω–æ–º —Ü–∏–∫–ª–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:**
1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä** –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
2. **–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞** (Ctrl+Shift+Delete)
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
   - –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
   - –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ü–∏–∫–ª–∞
   - –ü—Ä–æ–¥–∞–∂–∞ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏—Ç–∞

### **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:**
1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤** ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—â–∏—Ç—ã** ‚Äî —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ Lock —Ä–∞–±–æ—Ç–∞–µ—Ç
3. **–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** ‚Äî –∏–∑–º–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

## üìö –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **AUTOTRADER_ARCHITECTURE.md** ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
2. **AUTOTRADER_VISUAL_SCHEME.md** ‚Äî –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Å—Ö–µ–º—ã –∏ –¥–∏–∞–≥—Ä–∞–º–º—ã
3. **AUTOTRADER_FIX_SUMMARY.md** ‚Äî —ç—Ç–æ—Ç —Ñ–∞–π–ª (–∏—Ç–æ–≥–æ–≤–æ–µ —Ä–µ–∑—é–º–µ)

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ü–∏–∫–ª–æ–≤ –≤ `autotrader_cycles_state.json`
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É: `python diagnose_cycle_start.py`

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 2024-12-02  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
