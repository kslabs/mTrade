# üìã –ò–¢–û–ì–û–í–û–ï –†–ï–ó–Æ–ú–ï: –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä–∞ mTrade

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–µ—Ä–≤–µ—Ä–∞
- ‚úÖ –ò–∑—É—á–µ–Ω –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª `mTrade.py` (Flask —Å–µ—Ä–≤–µ—Ä)
- ‚úÖ –ù–∞–π–¥–µ–Ω–∞ —Ç–æ—á–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä–∞: `/api/autotrade/start` ‚Üí `DualThreadAutoTrader.start()`
- ‚úÖ –ò–∑—É—á–µ–Ω–∞ –¥–≤—É—Ö–ø–æ—Ç–æ—á–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (`dual_thread_autotrader.py`)
- ‚úÖ –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–æ—Ä–≥–æ–≤—ã–π –º–æ–¥—É–ª—å (`autotrader.py`)

### 2. –û–ø–∏—Å–∞–Ω–∏–µ —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∞–ª—é—Ç
- ‚úÖ –ù–∞–π–¥–µ–Ω –≥–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª: `DualThreadAutoTrader._run_cycler()`
- ‚úÖ –û–ø–∏—Å–∞–Ω –º–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è: `current_index = (current_index + 1) % len(currencies)`
- ‚úÖ –í—ã—è–≤–ª–µ–Ω—ã –¥–≤–∞ –ø–æ—Ç–æ–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:
  - **CYCLER** (–¶–∏–∫–ª–µ—Ä): –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –≤–∞–ª—é—Ç –ø–æ –∫—Ä—É–≥—É (10–º—Å/–≤–∞–ª—é—Ç—É)
  - **REACTOR** (–†–µ–∞–∫—Ç–æ—Ä): –†–µ–∞–∫—Ü–∏—è –Ω–∞ WebSocket –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω (50–º—Å –∑–∞–¥–µ—Ä–∂–∫–∞)
- ‚úÖ –û–ø–∏—Å–∞–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è: Lock, debounce, processing_flags

### 3. –ê–Ω–∞–ª–∏–∑ —ç—Ç–∞–ø–æ–≤ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
- ‚úÖ **–°—Ç–∞—Ä—Ç —Ü–∏–∫–ª–∞** (`_try_start_cycle`): –ü–æ–∫—É–ø–∫–∞ —à–∞–≥–∞ 0, –∞–∫—Ç–∏–≤–∞—Ü–∏—è —Ü–∏–∫–ª–∞
- ‚úÖ **–î–æ–∫—É–ø–∫–∞** (`_try_rebuy`): –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ü–µ–Ω—ã
- ‚ùå **–ü—Ä–æ–¥–∞–∂–∞** (`_try_sell`): **–§–£–ù–ö–¶–ò–Ø –û–¢–°–£–¢–°–¢–í–£–ï–¢ –í –ö–û–î–ï!**

### 4. –°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ [AUTOTRADER_COMPLETE_ARCHITECTURE.md](AUTOTRADER_COMPLETE_ARCHITECTURE.md) - –ü–æ–ª–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ [MISSING_TRY_SELL_PROBLEM.md](MISSING_TRY_SELL_PROBLEM.md) - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–¥–∞–∂–∏
- ‚úÖ [CURRENCY_CYCLE_QUICK_SCHEME.md](CURRENCY_CYCLE_QUICK_SCHEME.md) - –ë—ã—Å—Ç—Ä–∞—è —Å—Ö–µ–º–∞ —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω [DOCS_INDEX_AUTOTRADER_FIX.md](DOCS_INDEX_AUTOTRADER_FIX.md) —Å –Ω–æ–≤—ã–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –û–±—â–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                          mTrade.py (Flask)                          ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ  –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:                                                     ‚îÇ
‚îÇ  1. StateManager (—Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)                            ‚îÇ
‚îÇ  2. WebSocketManager (–ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Ü–µ–Ω—ã)                             ‚îÇ
‚îÇ  3. DualThreadAutoTrader (–¥–≤—É—Ö–ø–æ—Ç–æ—á–Ω—ã–π –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä)                 ‚îÇ
‚îÇ     ‚îî‚îÄ AutoTrader (—Ç–æ—Ä–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞)                                 ‚îÇ
‚îÇ                                                                     ‚îÇ
‚îÇ  API endpoints:                                                     ‚îÇ
‚îÇ  - POST /api/autotrade/start ‚Üí autotrader.start()                  ‚îÇ
‚îÇ  - POST /api/autotrade/stop ‚Üí autotrader.stop()                    ‚îÇ
‚îÇ  - GET /api/autotrade/stats ‚Üí —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞                           ‚îÇ
‚îÇ  - GET /api/autotrade/cycles ‚Üí —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ü–∏–∫–ª–æ–≤                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                  ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚ñº                           ‚ñº
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ  CYCLER Thread     ‚îÇ      ‚îÇ  REACTOR Thread    ‚îÇ
        ‚îÇ  (–¶–∏–∫–ª–µ—Ä)          ‚îÇ      ‚îÇ  (–†–µ–∞–∫—Ç–æ—Ä)         ‚îÇ
        ‚îÇ                    ‚îÇ      ‚îÇ                    ‚îÇ
        ‚îÇ  –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ   ‚îÇ      ‚îÇ  WebSocket         ‚îÇ
        ‚îÇ  –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ  ‚îÇ      ‚îÇ  –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω    ‚îÇ
        ‚îÇ  –≤–∞–ª—é—Ç—ã –ø–æ –∫—Ä—É–≥—É   ‚îÇ      ‚îÇ  ‚Üí urgent_queue    ‚îÇ
        ‚îÇ  10–º—Å/–≤–∞–ª—é—Ç–∞       ‚îÇ      ‚îÇ  50–º—Å –∑–∞–¥–µ—Ä–∂–∫–∞     ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ                           ‚îÇ
                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚ñº
                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                  ‚îÇ _try_process_currency() ‚îÇ
                  ‚îÇ (–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–π –≤–∞–ª—é—Ç—ã)‚îÇ
                  ‚îÇ                         ‚îÇ
                  ‚îÇ - Lock check            ‚îÇ
                  ‚îÇ - Debounce check        ‚îÇ
                  ‚îÇ - Permission check      ‚îÇ
                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚ñº
                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                  ‚îÇ _execute_trading_logic() ‚îÇ
                  ‚îÇ (–¢–æ—Ä–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞)        ‚îÇ
                  ‚îÇ                          ‚îÇ
                  ‚îÇ 1. _try_start_cycle()    ‚îÇ
                  ‚îÇ 2. _try_rebuy()          ‚îÇ
                  ‚îÇ 3. _try_sell() ‚ùå MISSING‚îÇ
                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîÑ –¶–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∞–ª—é—Ç

### –ö–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∞–ª—é—Ç–∞–º–∏

**–§–∞–π–ª:** `dual_thread_autotrader.py` ‚Üí `_run_cycler()`

```python
currencies = ["BTC", "ETH", "SOL", "XRP", "ADA", ...]  # –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö –≤–∞–ª—é—Ç
current_index = 0  # –¢–µ–∫—É—â–∏–π –∏–Ω–¥–µ–∫—Å –≤ —Å–ø–∏—Å–∫–µ

while running:
    # 1. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏ (–¥–æ 5 –∑–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é)
    for i in range(max_urgent_per_cycle):
        task = urgent_queue.get_nowait()
        _try_process_currency(task['currency'], reason="urgent:price_update")
    
    # 2. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–µ–∫—É—â—É—é –≤–∞–ª—é—Ç—É –∏–∑ —Å–ø–∏—Å–∫–∞
    currency = currencies[current_index]  # ‚Üê –í–∑—è—Ç—å –≤–∞–ª—é—Ç—É –ø–æ –∏–Ω–¥–µ–∫—Å—É
    _try_process_currency(currency, reason="cycle")
    
    # 3. –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–π –≤–∞–ª—é—Ç–µ (—Ü–∏–∫–ª–∏—á–µ—Å–∫–∏)
    current_index = (current_index + 1) % len(currencies)
    #                                   ‚Üë
    #                    –û–ø–µ—Ä–∞—Ç–æ—Ä % –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥:
    #                    0, 1, 2, ..., N-1, 0, 1, 2, ... (–ø–æ –∫—Ä—É–≥—É)
    
    # 4. –ü–∞—É–∑–∞ –º–µ–∂–¥—É –≤–∞–ª—é—Ç–∞–º–∏ (10–º—Å)
    time.sleep(0.01)
```

**–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
- üîÑ **–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–π:** –ü–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–∞–ª—é—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –ø–µ—Ä–≤–æ–π
- ‚è±Ô∏è **–°–∫–æ—Ä–æ—Å—Ç—å:** 10–º—Å –Ω–∞ –≤–∞–ª—é—Ç—É ‚Üí 100 –≤–∞–ª—é—Ç/—Å–µ–∫
- üìä **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:** –°–Ω–∞—á–∞–ª–∞ —Å—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏ (urgent), –ø–æ—Ç–æ–º –ø–ª–∞–Ω–æ–≤—ã–µ (cycle)
- üîí **–ó–∞—â–∏—Ç–∞:** Debounce 0.1—Å –∏ —Ñ–ª–∞–≥–∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üìà –≠—Ç–∞–ø—ã —Ç–æ—Ä–≥–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞

### 1. üöÄ –°—Ç–∞—Ä—Ç —Ü–∏–∫–ª–∞ (`_try_start_cycle`)

**–£—Å–ª–æ–≤–∏—è:**
- ‚úÖ `active = False` (—Ü–∏–∫–ª –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω)
- ‚úÖ `pending_start = False` (–Ω–µ—Ç –æ–∂–∏–¥–∞—é—â–µ–≥–æ —Å—Ç–∞—Ä—Ç–∞)
- ‚úÖ –¢–æ—Ä–≥–æ–≤–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∞ –¥–ª—è –≤–∞–ª—é—Ç—ã

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ê—Ç–æ–º–∞—Ä–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ `Lock.acquire()`
2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–∞ `pending_start = True`
3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω—ã –∏–∑ orderbook (asks)
4. –ü–æ–∫—É–ø–∫–∞ —à–∞–≥–∞ 0
5. –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ü–∏–∫–ª–∞: `active = True`, `active_step = 0`
6. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `start_price`, `last_buy_price`
7. –°–±—Ä–æ—Å —Ñ–ª–∞–≥–∞ `pending_start = False`
8. –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ `Lock.release()`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¶–∏–∫–ª –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω, –∫—É–ø–ª–µ–Ω –ø–µ—Ä–≤—ã–π —à–∞–≥

### 2. üìâ –î–æ–∫—É–ø–∫–∞ (`_try_rebuy`)

**–£—Å–ª–æ–≤–∏—è:**
- ‚úÖ `active = True` (—Ü–∏–∫–ª –∞–∫—Ç–∏–≤–µ–Ω)
- ‚úÖ –ï—Å—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ –≤ —Ç–∞–±–ª–∏—Ü–µ
- ‚úÖ –¶–µ–Ω–∞ —É–ø–∞–ª–∞ –Ω–∞ —Ç—Ä–µ–±—É–µ–º—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç (cumulative –ø–∞–¥–µ–Ω–∏–µ >= –ø–æ—Ä–æ–≥–∞)

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ü–∏–∫–ª–∞
2. –û–±—Ä–∞–±–æ—Ç–∫–∞ `pending.rebuy` (–µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞)
3. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
4. –†–∞—Å—á—ë—Ç –ø–∞–¥–µ–Ω–∏—è: `cumulative_drop = (start_price - current_price) / start_price * 100`
5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏—è: `cumulative_drop >= required_drop_pct`
6. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω—ã –∏–∑ orderbook (asks)
7. –ü–æ–∫—É–ø–∫–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞
8. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: `active_step++`, `base_volume += filled`, `last_buy_price = level_price`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –®–∞–≥ —É–≤–µ–ª–∏—á–µ–Ω, –æ–±—ä—ë–º –Ω–∞–∫–æ–ø–ª–µ–Ω, —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ —Å–Ω–∏–∂–µ–Ω–∞

### 3. üí∞ –ü—Ä–æ–¥–∞–∂–∞ (`_try_sell`)

**‚ùå –ü–†–û–ë–õ–ï–ú–ê:** –§—É–Ω–∫—Ü–∏—è **–ù–ï –°–£–©–ï–°–¢–í–£–ï–¢** –≤ `autotrader.py`!

**–î–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–∞–∫:**

**–£—Å–ª–æ–≤–∏—è:**
- ‚úÖ `active = True` (—Ü–∏–∫–ª –∞–∫—Ç–∏–≤–µ–Ω)
- ‚úÖ –¶–µ–Ω–∞ –≤—ã—Ä–æ—Å–ª–∞ –Ω–∞ —Ç—Ä–µ–±—É–µ–º—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç (—Ä–æ—Å—Ç >= breakeven_pct)

**–ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ü–∏–∫–ª–∞
2. –û–±—Ä–∞–±–æ—Ç–∫–∞ `pending.sell` (–µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞)
3. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ breakeven –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —à–∞–≥–∞
4. –†–∞—Å—á—ë—Ç —Ä–æ—Å—Ç–∞: `current_growth = (current_price - start_price) / start_price * 100`
5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏—è: `current_growth >= breakeven_pct`
6. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω—ã –∏–∑ orderbook (bids)
7. –ü—Ä–æ–¥–∞–∂–∞ –≤—Å–µ–≥–æ –æ–±—ä—ë–º–∞ `base_volume`
8. –ó–∞–∫—Ä—ã—Ç–∏–µ —Ü–∏–∫–ª–∞: `active = False`, –æ–±–Ω—É–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
9. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `last_sell_time` (–∑–∞—â–∏—Ç–∞ –æ—Ç –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–µ—Å—Ç–∞—Ä—Ç–∞)
10. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `logger.log_sell()`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¶–∏–∫–ª –∑–∞–∫—Ä—ã—Ç, –ø—Ä–∏–±—ã–ª—å –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

### ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è `_try_sell()` –≤ `autotrader.py`

**–ì–¥–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:**
```python
# dual_thread_autotrader.py, —Å—Ç—Ä–æ–∫–∞ 327
def _execute_trading_logic(self, currency: str):
    self.autotrader._try_start_cycle(currency, quote)  # ‚úÖ –ï—Å—Ç—å
    self.autotrader._try_rebuy(currency, quote)        # ‚úÖ –ï—Å—Ç—å
    self.autotrader._try_sell(currency, quote)         # ‚ùå –ù–ï–¢!
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ùå –û—à–∏–±–∫–∞: `AttributeError: 'AutoTrader' object has no attribute '_try_sell'`
- ‚ùå –ü—Ä–æ–¥–∞–∂–∏ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç
- ‚ùå –¶–∏–∫–ª—ã –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è
- ‚ùå –ü—Ä–∏–±—ã–ª—å –Ω–µ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è
- ‚ùå –ë–∞–ª–∞–Ω—Å—ã –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è, –Ω–æ –Ω–µ —Ä–µ–∞–ª–∏–∑—É—é—Ç—Å—è

**–ì–¥–µ –Ω–∞–π–¥–µ–Ω–∞ —á–∞—Å—Ç–∏—á–Ω–∞—è –≤–µ—Ä—Å–∏—è:**
- –í `_autotrader.py` (—Å—Ç—Ä–æ–∫–∏ 1486-1550) –µ—Å—Ç—å **–Ω–µ–ø–æ–ª–Ω–∞—è** —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –û–±—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: "–î–∞–ª–µ–µ –ø–æ–ª–Ω—ã–π –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–¥... –∫–æ–ø–∏—Ä—É–µ–º —Å—é–¥–∞..."

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**
1. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–ª–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `_try_sell()` –≤ `autotrader.py`
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å—é –ª–æ–≥–∏–∫—É –ø—Ä–æ–¥–∞–∂–∏ (—Å–º. –æ–ø–∏—Å–∞–Ω–∏–µ –≤—ã—à–µ)
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª: start ‚Üí rebuy ‚Üí sell

**–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏:** –°–º. [MISSING_TRY_SELL_PROBLEM.md](MISSING_TRY_SELL_PROBLEM.md)

---

## üìä –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

### 3 —É—Ä–æ–≤–Ω—è –∑–∞—â–∏—Ç—ã:

#### 1Ô∏è‚É£ –ê—Ç–æ–º–∞—Ä–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (Lock)
```python
# autotrader.py, _try_start_cycle()
if not self.cycle_locks[base].acquire(blocking=False):
    return  # –£–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –¥—Ä—É–≥–∏–º –ø–æ—Ç–æ–∫–æ–º
try:
    # –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–µ–∫—Ü–∏—è: —Å—Ç–∞—Ä—Ç —Ü–∏–∫–ª–∞
finally:
    self.cycle_locks[base].release()
```

#### 2Ô∏è‚É£ Debounce (–≤—Ä–µ–º–µ–Ω–Ω√°—è –∑–∞—â–∏—Ç–∞)
```python
# dual_thread_autotrader.py, _try_process_currency()
now = time.time()
if now - last_processed[currency] < debounce_seconds:
    return  # –°–ª–∏—à–∫–æ–º —Ä–∞–Ω–æ, –º–∏–Ω–∏–º—É–º 0.1—Å –º–µ–∂–¥—É –æ–±—Ä–∞–±–æ—Ç–∫–∞–º–∏
```

#### 3Ô∏è‚É£ –§–ª–∞–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
```python
# dual_thread_autotrader.py, _try_process_currency()
if processing_flags[currency]:
    return  # –í–∞–ª—é—Ç–∞ —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è

processing_flags[currency] = True
try:
    _execute_trading_logic(currency)
finally:
    processing_flags[currency] = False
```

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:

```
mTrade.py                        # Flask —Å–µ—Ä–≤–µ—Ä, API, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
‚îú‚îÄ DualThreadAutoTrader          # –î–≤—É—Ö–ø–æ—Ç–æ—á–Ω—ã–π –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä
‚îÇ  ‚îî‚îÄ dual_thread_autotrader.py
‚îÇ     ‚îú‚îÄ _run_cycler()           # –ü–æ—Ç–æ–∫-—Ü–∏–∫–ª–µ—Ä (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)
‚îÇ     ‚îú‚îÄ _run_reactor()          # –ü–æ—Ç–æ–∫-—Ä–µ–∞–∫—Ç–æ—Ä (WebSocket –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
‚îÇ     ‚îî‚îÄ _execute_trading_logic()# –¢–æ—Ä–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ (–≤—ã–∑—ã–≤–∞–µ—Ç AutoTrader)
‚îÇ
‚îú‚îÄ AutoTrader                    # –û—Å–Ω–æ–≤–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
‚îÇ  ‚îî‚îÄ autotrader.py
‚îÇ     ‚îú‚îÄ _try_start_cycle()      # ‚úÖ –°—Ç–∞—Ä—Ç —Ü–∏–∫–ª–∞
‚îÇ     ‚îú‚îÄ _try_rebuy()            # ‚úÖ –î–æ–∫—É–ø–∫–∞
‚îÇ     ‚îî‚îÄ _try_sell()             # ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢!
‚îÇ
‚îú‚îÄ WebSocketManager              # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WebSocket –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
‚îÇ  ‚îî‚îÄ websocket_manager.py
‚îÇ     ‚îú‚îÄ subscribe()             # –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø–∞—Ä—É
‚îÇ     ‚îî‚îÄ get_data()              # –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (ticker, orderbook)
‚îÇ
‚îî‚îÄ StateManager                  # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
   ‚îî‚îÄ state_manager.py
      ‚îú‚îÄ get_trading_permissions()   # –†–∞–∑—Ä–µ—à–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤–ª–∏
      ‚îú‚îÄ get_breakeven_params()      # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã breakeven
      ‚îî‚îÄ set_breakeven_params()      # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
```

### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã:

```
breakeven_calculator.py          # –†–∞—Å—á—ë—Ç —Ç–∞–±–ª–∏—Ü—ã breakeven
trade_logger.py                  # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–¥–µ–ª–æ–∫
balance_cache.py                 # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤
gate_api_client.py               # API Gate.io
config.py                        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:

1. **[AUTOTRADER_COMPLETE_ARCHITECTURE.md](AUTOTRADER_COMPLETE_ARCHITECTURE.md)**
   - –ü–æ–ª–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
   - –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
   - –ë–ª–æ–∫-—Å—Ö–µ–º—ã –∏ –¥–∏–∞–≥—Ä–∞–º–º—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –í—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏

2. **[MISSING_TRY_SELL_PROBLEM.md](MISSING_TRY_SELL_PROBLEM.md)**
   - üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–¥–∞–∂–∏
   - –û–ø–∏—Å–∞–Ω–∏–µ —Å–∏–º–ø—Ç–æ–º–æ–≤ –∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π
   - –ü–ª–∞–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏
   - Checklist –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã

3. **[CURRENCY_CYCLE_QUICK_SCHEME.md](CURRENCY_CYCLE_QUICK_SCHEME.md)**
   - –ë—ã—Å—Ç—Ä–∞—è —Å—Ö–µ–º–∞ —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
   - –í—Ä–µ–º–µ–Ω–Ω—ã–µ —à–∫–∞–ª—ã
   - –í–∏–∑—É–∞–ª—å–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã
   - –ü—Ä–∏–º–µ—Ä—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –†–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:

4. **[AUTOTRADER_ARCHITECTURE.md](AUTOTRADER_ARCHITECTURE.md)**
   - –ë–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä–∞
   - –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã
   - –û–ø–∏—Å–∞–Ω–∏–µ —Ü–∏–∫–ª–æ–≤

5. **[AUTOTRADER_VISUAL_SCHEME.md](AUTOTRADER_VISUAL_SCHEME.md)**
   - –í–∏–∑—É–∞–ª—å–Ω—ã–µ —Å—Ö–µ–º—ã
   - –ë–ª–æ–∫-–¥–∏–∞–≥—Ä–∞–º–º—ã
   - –î–∏–∞–≥—Ä–∞–º–º—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π

6. **[AUTOTRADER_FIX_SUMMARY.md](AUTOTRADER_FIX_SUMMARY.md)**
   - –†–µ–∑—é–º–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
   - –ß—Ç–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ –≤ –∫–æ–¥–µ
   - –ü—Ä–∏—á–∏–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π

7. **[QUICK_START_AFTER_FIX.md](QUICK_START_AFTER_FIX.md)**
   - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

8. **[DOCS_INDEX_AUTOTRADER_FIX.md](DOCS_INDEX_AUTOTRADER_FIX.md)**
   - –ò–Ω–¥–µ–∫—Å –≤—Å–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
   - –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º
   - –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

## ‚úÖ –í—ã–≤–æ–¥—ã

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

‚úÖ **–î–≤—É—Ö–ø–æ—Ç–æ—á–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- –ü–æ—Ç–æ–∫-—Ü–∏–∫–ª–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–∞–ª—é—Ç—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
- –ü–æ—Ç–æ–∫-—Ä–µ–∞–∫—Ç–æ—Ä —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω
- –°—Ä–æ—á–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

‚úÖ **–¶–∏–∫–ª–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:**
- –í–∞–ª—é—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ –∫—Ä—É–≥—É
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `(current_index + 1) % len(currencies)`
- –°–∫–æ—Ä–æ—Å—Ç—å: 10–º—Å –Ω–∞ –≤–∞–ª—é—Ç—É

‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:**
- Lock (–∞—Ç–æ–º–∞—Ä–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
- Debounce (–≤—Ä–µ–º–µ–Ω–Ω√°—è –∑–∞—â–∏—Ç–∞)
- processing_flags (—Ñ–ª–∞–≥–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è)

‚úÖ **–°—Ç–∞—Ä—Ç —Ü–∏–∫–ª–∞ (`_try_start_cycle`):**
- –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ (—É–¥–∞–ª–µ–Ω—ã –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏)
- –ê—Ç–æ–º–∞—Ä–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ Lock
- –§–ª–∞–≥ `pending_start` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏

‚úÖ **–î–æ–∫—É–ø–∫–∞ (`_try_rebuy`):**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ cumulative –ø–∞–¥–µ–Ω–∏—è
- –ü–æ–∫—É–ø–∫–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ `pending.rebuy`

### –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

‚ùå **–ü—Ä–æ–¥–∞–∂–∞ (`_try_sell`):**
- –§—É–Ω–∫—Ü–∏—è **–û–¢–°–£–¢–°–¢–í–£–ï–¢** –≤ `autotrader.py`
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤ `dual_thread_autotrader.py`, –Ω–æ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ü—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—à–∏–±–∫–µ `AttributeError`
- **–ü—Ä–æ–¥–∞–∂–∏ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç!**

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:

1. ‚ö†Ô∏è **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `_try_sell()` –≤ `autotrader.py`**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑ [MISSING_TRY_SELL_PROBLEM.md](MISSING_TRY_SELL_PROBLEM.md)
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å—é –ª–æ–≥–∏–∫—É –ø—Ä–æ–¥–∞–∂–∏
   - –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É `pending.sell`
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

2. ‚ö†Ô∏è **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:**
   ```powershell
   python -m py_compile autotrader.py
   ```

3. ‚ö†Ô∏è **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏**

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª: start ‚Üí rebuy ‚Üí sell
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–∏–±—ã–ª—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ü–∏–∫–ª—ã –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
7. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤

- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: —Å–º. [DOCS_INDEX_AUTOTRADER_FIX.md](DOCS_INDEX_AUTOTRADER_FIX.md)
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞: —Å–º. [MISSING_TRY_SELL_PROBLEM.md](MISSING_TRY_SELL_PROBLEM.md)
- –ü–æ–ª–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: —Å–º. [AUTOTRADER_COMPLETE_ARCHITECTURE.md](AUTOTRADER_COMPLETE_ARCHITECTURE.md)

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-XX  
**–ê–≤—Ç–æ—Ä:** GitHub Copilot  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω, —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ `_try_sell()`
