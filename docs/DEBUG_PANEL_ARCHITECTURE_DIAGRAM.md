# 🎨 DEBUG PANEL & LOGS PANEL - Визуальная архитектура

## 📐 Общая структура интерфейса

```
┌─────────────────────────────────────────────────────────────────┐
│                    ГЛАВНАЯ СТРАНИЦА                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────────────────────────────────────────────────┐     │
│  │  Выбор валюты: [ETH ▼]  [USDT ▼]  [Сеть: Testnet ▼]  │     │
│  └────────────────────────────────────────────────────────┘     │
│                                                                  │
│  ┌────────────────────────────────────────────────────────┐     │
│  │  ТОРГОВАЯ ПАНЕЛЬ (Автоматическая торговля)            │     │
│  │  [Start] [Stop] [Reset Cycle]                         │     │
│  └────────────────────────────────────────────────────────┘     │
│                                                                  │
│  ┌────────────────────────────────────────────────────────┐     │
│  │  ТАБЛИЦА БЕЗУБЫТОЧНОСТИ / ЛОГИ                        │     │
│  │  ┌──────────────────────────────────────────────┐     │     │
│  │  │ [Таблица безубыточности] / [Логи]           │     │     │
│  │  └──────────────────────────────────────────────┘     │     │
│  │  ┌──────────────────────────────────────────────┐     │     │
│  │  │  ПО УМОЛЧАНИЮ:                               │     │     │
│  │  │  ┌────────────────────────────────────────┐ │     │     │
│  │  │  │ Параметры (Шагов, Старт, Цена...)     │ │     │     │
│  │  │  │ [💾 Сохранить]                         │ │     │     │
│  │  │  ├────────────────────────────────────────┤ │     │     │
│  │  │  │ Таблица безубыточности                 │ │     │     │
│  │  │  │ (# | Ст. | ↓,% | Курс | Покупка...)  │ │     │     │
│  │  │  └────────────────────────────────────────┘ │     │     │
│  │  │                                              │     │     │
│  │  │  ПРИ КЛИКЕ НА "ЛОГИ":                        │     │     │
│  │  │  ┌────────────────────────────────────────┐ │     │     │
│  │  │  │ Логи торгов                            │ │     │     │
│  │  │  │ [🔄 Обновить] [⏸️ Пауза] [🗑️ Очистить]│ │     │     │
│  │  │  ├────────────────────────────────────────┤ │     │     │
│  │  │  │ [14:30:45] BUY ETH at 2500.00         │ │     │     │
│  │  │  │ [14:31:12] SELL ETH at 2505.00        │ │     │     │
│  │  │  │ [14:32:03] Profit: +5.00 USDT         │ │     │     │
│  │  │  └────────────────────────────────────────┘ │     │     │
│  │  └──────────────────────────────────────────────┘     │     │
│  └────────────────────────────────────────────────────────┘     │
│                                                                  │
│                                              ┌─────────────────┐ │
│                                              │ DEBUG PANEL     │ │
│                                              │ (всегда видна)  │ │
│                                              │ [правый нижний] │ │
│                                              └─────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🎛️ DEBUG PANEL - Детальная структура

```
┌──────────────────────────────────────────────────────────────┐
│ 📊 DEBUG PANEL (Торговые события)                           │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │  [🗑️ Clear] [📋 Copy] [📌 Fix] [🔽 Auto] [💾 Export]  │ │
│ └──────────────────────────────────────────────────────────┘ │
├──────────────────────────────────────────────────────────────┤
│ [14:30:45] 🔔 Стартовая покупка: ETH at 2500.00            │
│ [14:31:12] 💰 SELL выполнена: +5.00 USDT                    │
│ [14:32:03] 📊 Обновление безубыточности                      │
│ [14:32:45] ℹ️  Переключение на режим Логов                   │
│ [14:33:12] ⚠️  Низкий баланс: 10.00 USDT                     │
│ [14:34:00] ❌ Ошибка API: Timeout                            │
│ [14:35:15] 🗑️ Панель очищена                                │
│                                                              │
│ [можно прокручивать, авто-скролл к последнему сообщению]     │
└──────────────────────────────────────────────────────────────┘
```

### Кнопки управления DEBUG PANEL:

```
┌─────────────┐  ┌────────────┐  ┌───────────┐  ┌──────────┐  ┌────────────┐
│ 🗑️ Clear   │  │ 📋 Copy   │  │ 📌 Fix   │  │ 🔽 Auto │  │ 💾 Export │
├─────────────┤  ├────────────┤  ├───────────┤  ├──────────┤  ├────────────┤
│ Очистить    │  │ Копировать │  │ Закрепить │  │ Авто-    │  │ Экспорт в  │
│ все сообще- │  │ в буфер    │  │ позицию / │  │ скролл   │  │ текстовый  │
│ ния панели  │  │ обмена     │  │ Открепить │  │ вкл/выкл │  │ файл       │
└─────────────┘  └────────────┘  └───────────┘  └──────────┘  └────────────┘
     ↓                ↓               ↓              ↓              ↓
  Очистка       Все сообщения    Fix: панель    Зеленый:      Скачать
  буфера +      → clipboard      закреплена     автоскролл    файл .txt
  сообщение     (можно вставить  (можно         включен       с timestamp
  "Панель       в текстовый      перетаскивать)               в имени
  очищена"      редактор)        
                                 Unfix: панель  Серый:
                                 прокручивается автоскролл
                                 со страницей   выключен
```

---

## 🔄 LOGS PANEL - Переключение представлений (ОБНОВЛЕНО 2024-12-02)

### Состояние по умолчанию (Таблица безубыточности):

```
┌──────────────────────────────────────────────────────────────┐
│ [ Таблица безубыточности ] / [ Логи ]    [💾 Сохранить]    │
│      (активна - синяя)       (неактивна)                     │
├──────────────────────────────────────────────────────────────┤
│ Параметры торговли:                                          │
│ Шагов: [16]  Старт,$: [3]  Цена(P0): [авто]  Pprof,%: [0.6]│
│ R: [3.650]  Rk: [0.000]  Множитель геометрии: [1.1]         │
├──────────────────────────────────────────────────────────────┤
│ Таблица безубыточности:                                      │
│ ┌───┬────┬─────┬─────┬───────┬──────────┬────────┬─────────┐│
│ │ # │ Ст.│ ↓,% │ ↓Δ,%│ Курс  │ Покупка,$│ Инв.∑,$│ Ц.БезУб│ │
│ ├───┼────┼─────┼─────┼───────┼──────────┼────────┼─────────┤│
│ │ 0 │  1 │ 0.0 │ 0.0 │2500.00│     3.00 │   3.00 │ 2500.00││
│ │ 1 │  2 │-3.65│-3.65│2408.75│     3.30 │   6.30 │ 2454.37││
│ │ 2 │  3 │-7.30│-3.65│2321.25│     3.63 │   9.93 │ 2421.17││
│ └───┴────┴─────┴─────┴───────┴──────────┴────────┴─────────┘│
└──────────────────────────────────────────────────────────────┘
```

### После клика на "Логи" (С НОВОЙ КНОПКОЙ "ПАУЗА"):

```
┌──────────────────────────────────────────────────────────────┐
│ [ Таблица безубыточности ] / [ Логи ]                        │
│      (неактивна)                (активна - синяя)            │
├──────────────────────────────────────────────────────────────┤
│ Логи торгов                          [100 записей]           │
│ [🔄 Обновить] [⏸️ Пауза] [🗑️ Очистить]                     │
├──────────────────────────────────────────────────────────────┤
│ 2024-01-15 14:30:45 | BUY  | ETH  | 2500.00 | 0.001200 ETH  │
│ 2024-01-15 14:31:12 | SELL | ETH  | 2505.00 | 0.001200 ETH  │
│ 2024-01-15 14:31:13 | INFO | Profit: +5.00 USDT             │
│ 2024-01-15 14:32:03 | BUY  | ETH  | 2490.00 | 0.001320 ETH  │
│ 2024-01-15 14:33:45 | SELL | ETH  | 2495.00 | 0.001320 ETH  │
│ 2024-01-15 14:33:46 | INFO | Profit: +6.60 USDT             │
│                                                              │
│ [прокрутка... автообновление каждые 5 секунд]               │
└──────────────────────────────────────────────────────────────┘

             ↓ КЛИК НА "⏸️ ПАУЗА"

┌──────────────────────────────────────────────────────────────┐
│ [ Таблица безубыточности ] / [ Логи ]                        │
│      (неактивна)                (активна - синяя)            │
├──────────────────────────────────────────────────────────────┤
│ Логи торгов                          [100 записей]           │
│ [🔄 Обновить] [▶️ Продолжить] [🗑️ Очистить]                │
├──────────────────────────────────────────────────────────────┤
│ 2024-01-15 14:30:45 | BUY  | ETH  | 2500.00 | 0.001200 ETH  │
│ 2024-01-15 14:31:12 | SELL | ETH  | 2505.00 | 0.001200 ETH  │
│ 2024-01-15 14:31:13 | INFO | Profit: +5.00 USDT             │
│ 2024-01-15 14:32:03 | BUY  | ETH  | 2490.00 | 0.001320 ETH  │
│ 2024-01-15 14:33:45 | SELL | ETH  | 2495.00 | 0.001320 ETH  │
│ 2024-01-15 14:33:46 | INFO | Profit: +6.60 USDT             │
│                                                              │
│ [можно спокойно копировать текст - обновление остановлено]  │
└──────────────────────────────────────────────────────────────┘
```

---

## 🆕 НОВАЯ ФУНКЦИЯ: Кнопка Паузы

### Состояния кнопки:

```
┌──────────────────────────────────────────────────────────────┐
│                     СОСТОЯНИЕ 1                              │
│              [⏸️ Пауза]  ← ОРАНЖЕВЫЙ (btn-warning)           │
│                                                              │
│  Автообновление: ✅ АКТИВНО (каждые 5 секунд)               │
│  Возможность копирования: ⚠️ ЗАТРУДНЕНА (прыгающий экран)   │
└──────────────────────────────────────────────────────────────┘
                            ↓ КЛИК
┌──────────────────────────────────────────────────────────────┐
│                     СОСТОЯНИЕ 2                              │
│           [▶️ Продолжить]  ← ЗЕЛЁНЫЙ (btn-success)           │
│                                                              │
│  Автообновление: ❌ ОСТАНОВЛЕНО                              │
│  Возможность копирования: ✅ ПОЛНАЯ (статичный экран)        │
└──────────────────────────────────────────────────────────────┘
                            ↓ КЛИК
┌──────────────────────────────────────────────────────────────┐
│                     СОСТОЯНИЕ 1                              │
│              [⏸️ Пауза]  ← ОРАНЖЕВЫЙ (btn-warning)           │
│                                                              │
│  Автообновление: ✅ АКТИВНО (каждые 5 секунд)               │
│  Возможность копирования: ⚠️ ЗАТРУДНЕНА (прыгающий экран)   │
└──────────────────────────────────────────────────────────────┘
```

---

## 🔀 Диаграмма потока данных (ОБНОВЛЕНО)

```
                    ┌─────────────┐
                    │  ПОЛЬЗОВАТЕЛЬ │
                    └──────┬──────┘
                           │
                           ▼
        ┌──────────────────────────────────────┐
        │    Нажимает кнопку "Логи"            │
        └──────────────┬───────────────────────┘
                       │
                       ▼
        ┌──────────────────────────────────────┐
        │ TradeLogsManager.switchView('logs')  │
        └──────────────┬───────────────────────┘
                       │
         ┌─────────────┴─────────────┐
         │                           │
         ▼                           ▼
┌────────────────┐         ┌────────────────────┐
│ Скрыть:        │         │ Показать:          │
│ - Таблица BE   │         │ - Панель логов     │
│ - Параметры    │         │ - Кнопки управления│
│ - Кнопка Save  │         │ - Счетчик записей  │
└────────────────┘         └─────────┬──────────┘
                                     │
                                     ▼
                          ┌──────────────────────┐
                          │ loadLogs(currency)   │
                          └──────────┬───────────┘
                                     │
                                     ▼
                          ┌──────────────────────┐
                          │ Запрос к API:        │
                          │ /api/trade/logs?...  │
                          └──────────┬───────────┘
                                     │
                                     ▼
                          ┌──────────────────────┐
                          │ Получить данные      │
                          │ { success, logs }    │
                          └──────────┬───────────┘
                                     │
                ┌────────────────────┴────────────────────┐
                │                                         │
                ▼                                         ▼
    ┌───────────────────┐                   ┌────────────────────┐
    │ renderLogs()      │                   │ Последние 5 логов  │
    │ - Отобразить в    │                   │ → DEBUG PANEL      │
    │   панели логов    │                   │   (window.uiDebugLog)│
    └───────────────────┘                   └────────────────────┘
                │
                ▼
    ┌───────────────────┐
    │ startAutoRefresh()│ ← ✅ АВТООБНОВЛЕНИЕ АКТИВНО
    │ каждые 5 секунд   │
    └─────────┬─────────┘
              │
              ▼
    ┌──────────────────────────────┐
    │  ПОЛЬЗОВАТЕЛЬ НАЖИМАЕТ       │
    │  КНОПКУ "⏸️ ПАУЗА"           │
    └─────────┬────────────────────┘
              │
              ▼
    ┌───────────────────────────────┐
    │ togglePause()                 │
    │ - isPaused = true             │
    │ - stopAutoRefresh()           │
    │ - Кнопка → "▶️ Продолжить"   │
    └───────────────────────────────┘
              │
              ▼
    ┌───────────────────────────────┐
    │ ❌ АВТООБНОВЛЕНИЕ ОСТАНОВЛЕНО │
    │ ✅ МОЖНО КОПИРОВАТЬ ТЕКСТ     │
    └───────────────────────────────┘
              │
              ▼
    ┌──────────────────────────────┐
    │  ПОЛЬЗОВАТЕЛЬ НАЖИМАЕТ       │
    │  КНОПКУ "▶️ Продолжить"      │
    └─────────┬────────────────────┘
              │
              ▼
    ┌───────────────────────────────┐
    │ togglePause()                 │
    │ - isPaused = false            │
    │ - startAutoRefresh()          │
    │ - Кнопка → "⏸️ Пауза"         │
    └───────────────────────────────┘
              │
              ▼
    ┌───────────────────────────────┐
    │ ✅ АВТООБНОВЛЕНИЕ ВОЗОБНОВЛЕНО│
    └───────────────────────────────┘
```

---

## 🎭 Drag & Drop - Как это работает

```
ПОЛЬЗОВАТЕЛЬ НАЧИНАЕТ ПЕРЕТАСКИВАНИЕ:
┌────────────────────────────────────────┐
│ 1. Клик мышью на заголовке панели      │
│    (НЕ на кнопках!)                    │
└──────────────┬─────────────────────────┘
               │
               ▼
┌────────────────────────────────────────┐
│ 2. dragStart(event)                    │
│    - Проверка: position === 'fixed'?   │
│    - Проверка: клик не на кнопке?      │
│    - isDragging = true                 │
│    - Сохранить начальные координаты    │
└──────────────┬─────────────────────────┘
               │
               ▼
┌────────────────────────────────────────┐
│ 3. ПЕРЕМЕЩЕНИЕ МЫШИ (непрерывно)       │
│    drag(event)                         │
│    - Вычислить новые координаты        │
│    - xOffset = currentX                │
│    - yOffset = currentY                │
│    - setTranslate(x, y, panel)         │
│      → panel.style.transform =         │
│        'translate3d(x, y, 0)'          │
└──────────────┬─────────────────────────┘
               │
               ▼
┌────────────────────────────────────────┐
│ 4. ОТПУСКАНИЕ МЫШИ                     │
│    dragEnd(event)                      │
│    - Сохранить финальные координаты    │
│    - isDragging = false                │
└────────────────────────────────────────┘

КНОПКА "FIX" → "UNFIX":
┌────────────────────────────────────────┐
│ fixBtn.onclick()                       │
│ - panel.position = 'absolute'          │
│ - window.__resetPanelTransform()       │
│   → transform = 'translate3d(0,0,0)'   │
│   → xOffset = 0, yOffset = 0           │
└────────────────────────────────────────┘
```

---

## 🌈 Цветовая схема панелей

### DEBUG PANEL - Типы сообщений:

```
┌──────────┬──────────────┬─────────────┬──────────────────────┐
│   ТИП    │   ЦВЕТ       │   ИКОНКА    │   УСЛОВИЕ            │
├──────────┼──────────────┼─────────────┼──────────────────────┤
│ TRADE    │ 🟢 Зеленый   │ 🔔 💰 📊   │ Торговые операции    │
│ ERROR    │ 🔴 Красный   │ ❌ ⚠️      │ Ошибки, проблемы     │
│ INFO     │ 🔵 Синий     │ ℹ️ 💡      │ Информация           │
│ WARN     │ 🟡 Желтый    │ ⚡          │ Предупреждения       │
│ DEBUG    │ ⚪ Серый     │ -           │ Отладочные сообщения │
└──────────┴──────────────┴─────────────┴──────────────────────┘
```

### LOGS PANEL - Стили кнопок (ОБНОВЛЕНО):

```
┌─────────────────────┬────────────┬──────────────────────┐
│   КНОПКА            │   ЦВЕТ     │   СОСТОЯНИЕ          │
├─────────────────────┼────────────┼──────────────────────┤
│ Таблица безубыточ.  │ 🔵 Синий   │ Активная (выбрана)   │
│ Таблица безубыточ.  │ ⚪ Серый   │ Неактивная           │
│ Логи                │ 🔵 Синий   │ Активная (выбрана)   │
│ Логи                │ ⚪ Серый   │ Неактивная           │
├─────────────────────┼────────────┼──────────────────────┤
│ 🔄 Обновить         │ ⚫ Серый   │ Вторичная кнопка     │
│ ⏸️ Пауза            │ 🟠 Оранж.  │ 🆕 НОВАЯ! Остановка  │
│ ▶️ Продолжить       │ 🟢 Зелёный │ 🆕 НОВАЯ! Возобновл. │
│ 🗑️ Очистить        │ 🔴 Красный │ Опасная операция     │
│ 💾 Сохранить        │ 🟢 Зеленый │ Основная кнопка      │
└─────────────────────┴────────────┴──────────────────────┘
```

---

## 📏 Размеры и позиционирование

### DEBUG PANEL:

```
Ширина: 420px
Макс. высота: 40vh (40% от высоты viewport)
Позиция: fixed (по умолчанию)
  - right: 12px
  - bottom: 12px
Z-index: 99999 (всегда поверх других элементов)

Transform: translate3d(x, y, 0)
  - Используется для перетаскивания
  - Не влияет на layout других элементов
```

### LOGS PANEL:

```
Ширина: 100% от родительского контейнера
Макс. высота логов: 400px
Позиция: в потоке документа (не fixed)
  - Располагается в .breakeven-table

Переключение:
  - display: block / none
  - Не использует position или transform
```

---

## 🔗 Взаимосвязи компонентов (ОБНОВЛЕНО)

```
index.html
  ├─→ app.js
  │    ├─→ DEBUG PANEL (window.__uiDebugPanel)
  │    │    ├─→ 5 кнопок управления (Clear, Copy, Fix, Auto, Export)
  │    │    ├─→ Drag & Drop события
  │    │    └─→ window.uiDebugLog(msg, level)
  │    │
  │    └─→ Инициализация TradeLogsManager
  │
  └─→ trade-logs-manager.js
       ├─→ TradeLogsManager (window.tradeLogsManager)
       │    ├─→ switchView('breakeven' | 'logs')
       │    ├─→ loadLogs(currency)
       │    ├─→ renderLogs()
       │    ├─→ startAutoRefresh() / stopAutoRefresh()
       │    └─→ 🆕 togglePause() ← НОВАЯ ФУНКЦИЯ!
       │
       └─→ Использует window.uiDebugLog()
            для вывода в DEBUG PANEL
```

---

## 🎯 Итоговая схема взаимодействия (ОБНОВЛЕНО)

```
                    ┌─────────────────────┐
                    │   ПОЛЬЗОВАТЕЛЬ      │
                    └──────────┬──────────┘
                               │
            ┌──────────────────┼──────────────────┬─────────────┐
            │                  │                  │             │
            ▼                  ▼                  ▼             ▼
    ┌───────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐
    │ Управляет     │  │ Переключает  │  │ Читает       │  │ 🆕 Управляет │
    │ DEBUG PANEL   │  │ представления│  │ логи/таблицу │  │ ПАУЗОЙ логов │
    └───────┬───────┘  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘
            │                  │                  │                 │
            ▼                  ▼                  ▼                 ▼
    ┌───────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐
    │ 5 кнопок      │  │ Кнопки       │  │ Содержимое   │  │ Кнопка       │
    │ Clear, Copy,  │  │ "Таблица" /  │  │ видимое в    │  │ "⏸️ Пауза" / │
    │ Fix, Auto,    │  │ "Логи"       │  │ текущем виде │  │ "▶️ Продолж."│
    │ Export        │  │              │  │              │  │              │
    └───────┬───────┘  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘
            │                  │                  │                 │
            └──────────────────┴──────────────────┴─────────────────┘
                               │
                               ▼
                    ┌──────────────────────┐
                    │   РЕЗУЛЬТАТ:         │
                    │ - Удобный мониторинг │
                    │ - Быстрое переключение│
                    │ - Независимые панели │
                    │ - 🆕 Копирование без │
                    │   "прыгающего" экрана│
                    └──────────────────────┘
```

---

**Обновлено: 2024-12-02** 🎉  
**Добавлена кнопка паузы для удобного копирования логов!**
