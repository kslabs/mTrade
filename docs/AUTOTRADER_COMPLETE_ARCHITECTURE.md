# ğŸ—ï¸ ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ°Ğ²Ñ‚Ğ¾Ñ‚Ñ€ĞµĞ¹Ğ´ĞµÑ€Ğ° mTrade

## ğŸ“‹ ĞĞ³Ğ»Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ
1. [ĞĞ±Ñ‰Ğ°Ñ ÑÑ…ĞµĞ¼Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹](#Ğ¾Ğ±Ñ‰Ğ°Ñ-ÑÑ…ĞµĞ¼Ğ°-ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹)
2. [Ğ”Ğ²ÑƒÑ…Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°](#Ğ´Ğ²ÑƒÑ…Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ°Ñ-Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°)
3. [Ğ¦Ğ¸ĞºĞ» Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ²Ğ°Ğ»ÑÑ‚](#Ñ†Ğ¸ĞºĞ»-Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸-Ğ²Ğ°Ğ»ÑÑ‚)
4. [Ğ­Ñ‚Ğ°Ğ¿Ñ‹ Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ñ†Ğ¸ĞºĞ»Ğ°](#ÑÑ‚Ğ°Ğ¿Ñ‹-Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ¾Ğ³Ğ¾-Ñ†Ğ¸ĞºĞ»Ğ°)
5. [Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ buy/sell Ğ² Ñ†Ğ¸ĞºĞ»](#Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ-buysell-Ğ²-Ñ†Ğ¸ĞºĞ»)
6. [Ğ‘Ğ»Ğ¾Ğº-ÑÑ…ĞµĞ¼Ñ‹ Ğ¸ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹](#Ğ±Ğ»Ğ¾Ğº-ÑÑ…ĞµĞ¼Ñ‹-Ğ¸-Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ-Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹)

---

## 1. ğŸŒ ĞĞ±Ñ‰Ğ°Ñ ÑÑ…ĞµĞ¼Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

### ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        mTrade.py                            â”‚
â”‚                    (Flask ÑĞµÑ€Ğ²ĞµÑ€)                           â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚         DualThreadAutoTrader                     â”‚     â”‚
â”‚  â”‚       (Ğ”Ğ²ÑƒÑ…Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ğ°Ğ²Ñ‚Ğ¾Ñ‚Ñ€ĞµĞ¹Ğ´ĞµÑ€)                 â”‚     â”‚
â”‚  â”‚                                                  â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚  â”‚  â”‚  CYCLER Thread â”‚      â”‚  REACTOR Thread  â”‚  â”‚     â”‚
â”‚  â”‚  â”‚  (Ğ¦Ğ¸ĞºĞ»ĞµÑ€)      â”‚      â”‚  (Ğ ĞµĞ°ĞºÑ‚Ğ¾Ñ€)       â”‚  â”‚     â”‚
â”‚  â”‚  â”‚                â”‚      â”‚                  â”‚  â”‚     â”‚
â”‚  â”‚  â”‚  ĞŸĞ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ     â”‚  WebSocket       â”‚  â”‚     â”‚
â”‚  â”‚  â”‚  Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ²Ğ°Ğ»ÑÑ‚      â”‚  Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ      â”‚  â”‚     â”‚
â”‚  â”‚  â”‚  Ğ¿Ğ¾ ĞºÑ€ÑƒĞ³Ñƒ             â”‚  Ñ†ĞµĞ½             â”‚  â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚  â”‚           â”‚                       â”‚            â”‚     â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚     â”‚
â”‚  â”‚                       â–¼                        â”‚     â”‚
â”‚  â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚     â”‚
â”‚  â”‚           â”‚    AutoTrader       â”‚              â”‚     â”‚
â”‚  â”‚           â”‚   (Ğ¢Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°) â”‚              â”‚     â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚              WebSocket Manager                   â”‚     â”‚
â”‚  â”‚        (Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ WebSocket Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ°Ğ¼Ğ¸)         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚              State Manager                       â”‚     â”‚
â”‚  â”‚        (Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸ĞµĞ¼ Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ğ¼Ğ¸)     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚              Gate API Client                     â”‚     â”‚
â”‚  â”‚        (Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Ğ±Ğ¸Ñ€Ğ¶ĞµĞ¹ Gate.io)             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ğŸ”€ Ğ”Ğ²ÑƒÑ…Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### ĞŸĞ¾Ñ‚Ğ¾Ğº-Ğ¦Ğ¸ĞºĞ»ĞµÑ€ (CYCLER Thread)

**Ğ¤Ğ°Ğ¹Ğ»:** `dual_thread_autotrader.py` â†’ `_run_cycler()`

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** ĞŸĞ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ²ÑĞµÑ… Ñ€Ğ°Ğ·Ñ€ĞµÑˆÑ‘Ğ½Ğ½Ñ‹Ñ… Ğ²Ğ°Ğ»ÑÑ‚ Ğ¿Ğ¾ ĞºÑ€ÑƒĞ³Ñƒ

**ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼:**
```python
current_index = 0
cycle_sleep = 0.01  # 10Ğ¼Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ²Ğ°Ğ»ÑÑ‚Ğ°Ğ¼Ğ¸

while running:
    # 1. ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ ÑÑ€Ğ¾Ñ‡Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ¸Ğ· Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸ (Ğ´Ğ¾ 5 Ğ·Ğ°Ğ´Ğ°Ñ‡ Ğ·Ğ° Ğ¸Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ)
    for i in range(max_urgent_per_cycle):
        task = urgent_queue.get_nowait()
        _try_process_currency(currency, reason="urgent")
    
    # 2. ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰ÑƒÑ Ğ²Ğ°Ğ»ÑÑ‚Ñƒ Ğ¸Ğ· ÑĞ¿Ğ¸ÑĞºĞ°
    currency = currencies[current_index]
    _try_process_currency(currency, reason="cycle")
    
    # 3. ĞŸĞµÑ€ĞµĞ¹Ñ‚Ğ¸ Ğº ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ¹ Ğ²Ğ°Ğ»ÑÑ‚Ğµ
    current_index = (current_index + 1) % len(currencies)
    
    # 4. ĞŸĞ°ÑƒĞ·Ğ°
    time.sleep(cycle_sleep)
```

**Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸:**
- â±ï¸ **Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ:** 10Ğ¼Ñ Ğ½Ğ° Ğ²Ğ°Ğ»ÑÑ‚Ñƒ â†’ 100 Ğ²Ğ°Ğ»ÑÑ‚/ÑĞµĞº
- ğŸ”„ **Ğ¦Ğ¸ĞºĞ»Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹:** ĞŸĞ¾ÑĞ»Ğµ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¹ Ğ²Ğ°Ğ»ÑÑ‚Ñ‹ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ÑÑ Ğº Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¹
- ğŸ“Š **ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ñ‹:** Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° ÑÑ€Ğ¾Ñ‡Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸, Ğ¿Ğ¾Ñ‚Ğ¾Ğ¼ Ğ¿Ğ»Ğ°Ğ½Ğ¾Ğ²Ñ‹Ğµ
- ğŸ”’ **Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ°:** Debounce (0.1Ñ) Ğ¸ Ñ„Ğ»Ğ°Ğ³ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ¿Ñ€ĞµĞ´Ğ¾Ñ‚Ğ²Ñ€Ğ°Ñ‰Ğ°ÑÑ‚ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### ĞŸĞ¾Ñ‚Ğ¾Ğº-Ğ ĞµĞ°ĞºÑ‚Ğ¾Ñ€ (REACTOR Thread)

**Ğ¤Ğ°Ğ¹Ğ»:** `dual_thread_autotrader.py` â†’ `_run_reactor()`

**ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ:** Ğ ĞµĞ°Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ° WebSocket Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñ†ĞµĞ½

**ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼:**
```python
last_update_time = {}

while running:
    for currency in currencies:
        # 1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· WebSocket
        pair_data = ws_manager.get_data(f"{currency}_USDT")
        
        if not pair_data:
            continue
        
        # 2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ debounce (0.1Ñ)
        now = time.time()
        if now - last_update_time[currency] < debounce_seconds:
            continue
        
        # 3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ, Ğ½Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ»Ğ¸ Ğ²Ğ°Ğ»ÑÑ‚Ğ°
        if processing_flags[currency]:
            continue
        
        # 4. ĞŸĞ¾ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ Ğ² ÑÑ€Ğ¾Ñ‡Ğ½ÑƒÑ Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ
        urgent_queue.put({
            'currency': currency,
            'reason': 'price_update'
        })
        
        last_update_time[currency] = now
    
    time.sleep(0.05)  # 50Ğ¼Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¸Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸ÑĞ¼Ğ¸
```

**Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸:**
- âš¡ **Ğ ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ:** 50Ğ¼Ñ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ° Ñ€ĞµĞ°ĞºÑ†Ğ¸Ğ¸ Ğ½Ğ° Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ñ†ĞµĞ½Ñ‹
- ğŸ“¨ **ĞÑ‡ĞµÑ€ĞµĞ´ÑŒ:** Ğ”Ğ¾ 100 ÑÑ€Ğ¾Ñ‡Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ´Ğ°Ñ‡ Ğ² Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ¸
- ğŸ”’ **Debounce:** 0.1Ñ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°Ğ¼Ğ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ²Ğ°Ğ»ÑÑ‚Ñ‹
- ğŸš« **Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ°:** ĞĞµ ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ, ĞµÑĞ»Ğ¸ Ğ²Ğ°Ğ»ÑÑ‚Ğ° ÑƒĞ¶Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ

---

## 3. ğŸ”„ Ğ¦Ğ¸ĞºĞ» Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ²Ğ°Ğ»ÑÑ‚

### Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ²Ğ°Ğ»ÑÑ‚Ñ‹

**Ğ¤Ğ°Ğ¹Ğ»:** `dual_thread_autotrader.py` â†’ `_try_process_currency()`

```python
def _try_process_currency(currency: str, reason: str) -> bool:
    # 1. ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ˜ (Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¾Ğ¹ Lock)
    with lock:
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ„Ğ»Ğ°Ğ³ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸
        if processing_flags[currency]:
            return False  # Ğ£Ğ¶Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ debounce
        if time.time() - last_processed[currency] < debounce_seconds:
            return False  # Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ñ€Ğ°Ğ½Ğ¾
        
        # ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ»Ğ¸
        if not permissions[currency]:
            return False  # Ğ¢Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ»Ñ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰ĞµĞ½Ğ°
        
        # Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ„Ğ»Ğ°Ğ³ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸
        processing_flags[currency] = True
    
    try:
        # 2. Ğ’Ğ«ĞŸĞĞ›ĞĞ˜Ğ¢Ğ¬ Ğ¢ĞĞ Ğ“ĞĞ’Ğ£Ğ® Ğ›ĞĞ“Ğ˜ĞšĞ£ (Ğ±ĞµĞ· Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸)
        _execute_trading_logic(currency)
        
        # 3. ĞĞ‘ĞĞĞ’Ğ˜Ğ¢Ğ¬ Ğ’Ğ Ğ•ĞœĞ¯ ĞĞ‘Ğ ĞĞ‘ĞĞ¢ĞšĞ˜
        with lock:
            last_processed[currency] = time.time()
        
        return True
    
    finally:
        # 4. Ğ¡Ğ‘Ğ ĞĞ¡Ğ˜Ğ¢Ğ¬ Ğ¤Ğ›ĞĞ“ ĞĞ‘Ğ ĞĞ‘ĞĞ¢ĞšĞ˜ (Ğ² Ğ»ÑĞ±Ğ¾Ğ¼ ÑĞ»ÑƒÑ‡Ğ°Ğµ)
        with lock:
            processing_flags[currency] = False
```

### Ğ¢Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°

**Ğ¤Ğ°Ğ¹Ğ»:** `dual_thread_autotrader.py` â†’ `_execute_trading_logic()`

```python
def _execute_trading_logic(currency: str):
    quote = "USDT"
    
    # 1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ†ĞµĞ½Ñ‹ Ğ¸Ğ· WebSocket
    pair_data = ws_manager.get_data(f"{currency}_{quote}")
    
    if not pair_data or not pair_data['ticker']:
        return  # ĞĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
    
    # 2. Ğ’Ñ‹Ğ·Ğ²Ğ°Ñ‚ÑŒ 3 Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ñ… Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ° Ğ°Ğ²Ñ‚Ğ¾Ñ‚Ñ€ĞµĞ¹Ğ´ĞµÑ€Ğ°
    autotrader._try_start_cycle(currency, quote)  # ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° ÑÑ‚Ğ°Ñ€Ñ‚Ğ° Ñ†Ğ¸ĞºĞ»Ğ°
    autotrader._try_rebuy(currency, quote)        # ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ´Ğ¾ĞºÑƒĞ¿ĞºĞ¸
    autotrader._try_sell(currency, quote)         # ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸
```

**âš ï¸ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞĞ¯ ĞŸĞ ĞĞ‘Ğ›Ğ•ĞœĞ:**
- Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ `autotrader._try_sell()`, Ğ½Ğ¾ **ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ° Ğ½ĞµÑ‚** Ğ² `autotrader.py`!
- ĞœĞµÑ‚Ğ¾Ğ´ ĞµÑÑ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² `_autotrader.py` (ÑÑ‚Ğ°Ñ€Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ)
- ĞÑƒĞ¶Ğ½Ğ¾ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ `_try_sell()` Ğ² `autotrader.py`

---

## 4. ğŸ“ˆ Ğ­Ñ‚Ğ°Ğ¿Ñ‹ Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ñ†Ğ¸ĞºĞ»Ğ°

### 4.1. ğŸš€ Ğ¡Ñ‚Ğ°Ñ€Ñ‚ Ñ†Ğ¸ĞºĞ»Ğ° (`_try_start_cycle`)

**Ğ¤Ğ°Ğ¹Ğ»:** `autotrader.py` â†’ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ 920-1685

**Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°:**
1. âœ… ĞĞ²Ñ‚Ğ¾Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ»Ñ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ° Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾
2. âœ… Ğ¢Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ»Ñ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ° Ğ´Ğ»Ñ Ğ´Ğ°Ğ½Ğ½Ğ¾Ğ¹ Ğ²Ğ°Ğ»ÑÑ‚Ñ‹
3. âœ… Ğ¦Ğ¸ĞºĞ» ĞĞ• Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ (`active == False`)
4. âœ… ĞĞµÑ‚ Ñ„Ğ»Ğ°Ğ³Ğ° Ğ¾Ğ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ñ ÑÑ‚Ğ°Ñ€Ñ‚Ğ° (`pending_start == False`)

**ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ (ÑƒĞ¿Ñ€Ğ¾Ñ‰Ñ‘Ğ½Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹):**
```python
def _try_start_cycle(base: str, quote: str):
    # 1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Lock (Ğ°Ñ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ğ°Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ°)
    if not cycle_locks[base].acquire(blocking=False):
        return  # Ğ£Ğ¶Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ
    
    try:
        # 2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ñ†Ğ¸ĞºĞ»Ğ°
        cycle = cycles.get(base, {})
        
        if cycle.get('active'):
            return  # Ğ¦Ğ¸ĞºĞ» ÑƒĞ¶Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½
        
        if cycle.get('pending_start'):
            return  # Ğ¡Ñ‚Ğ°Ñ€Ñ‚ ÑƒĞ¶Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
        
        # 3. Ğ’Ñ‹Ğ·Ğ²Ğ°Ñ‚ÑŒ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
        _try_start_cycle_impl(base, quote)
    
    finally:
        cycle_locks[base].release()
```

**Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ (`_try_start_cycle_impl`):**
```python
def _try_start_cycle_impl(base: str, quote: str):
    # 1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ†ĞµĞ½Ñƒ
    price = _get_market_price(base, quote)
    
    # 2. ĞŸĞµÑ€ĞµÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ breakeven
    _recalc_table_if_needed(base, quote, price)
    
    # 3. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ³Ğ¾ ÑˆĞ°Ğ³Ğ°
    table = cycle['table']
    params_row = table[0]
    purchase_usd = float(params_row['purchase_usd'])
    
    # 4. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ orderbook Ğ¸ Ñ†ĞµĞ½Ñƒ Ğ¿Ğ¾ĞºÑƒĞ¿ĞºĞ¸
    orderbook = _get_orderbook(base, quote)
    level_price = orderbook['asks'][level - 1][0]
    
    # 5. Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ¾Ğ±ÑŠÑ‘Ğ¼ Ğ¿Ğ¾ĞºÑƒĞ¿ĞºĞ¸
    amount_to_buy = purchase_usd / level_price
    
    # 6. Ğ£Ğ¡Ğ¢ĞĞĞĞ’Ğ˜Ğ¢Ğ¬ Ğ¤Ğ›ĞĞ“ PENDING_START
    cycle['pending_start'] = True
    _save_cycles_state()
    
    # 7. Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ğ¾Ñ€Ğ´ĞµÑ€ Ğ½Ğ° Ğ¿Ğ¾ĞºÑƒĞ¿ĞºÑƒ
    order_res = _place_limit_order_all_or_nothing('buy', base, quote, amount_to_buy, level_price)
    
    # 8. ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
    if order_res['success']:
        filled = order_res['filled']
        
        # ĞĞšĞ¢Ğ˜Ğ’Ğ˜Ğ ĞĞ’ĞĞ¢Ğ¬ Ğ¦Ğ˜ĞšĞ›
        cycle['active'] = True
        cycle['active_step'] = 0
        cycle['start_price'] = level_price
        cycle['last_buy_price'] = level_price
        cycle['base_volume'] = filled
        cycle['total_invested_usd'] = filled * level_price
        cycle['pending_start'] = False
        
        _save_cycles_state()
        logger.log_buy(base, filled, level_price, ...)
    else:
        # Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ñ„Ğ»Ğ°Ğ³ Ğ¿Ñ€Ğ¸ Ğ½ĞµÑƒĞ´Ğ°Ñ‡Ğµ
        cycle['pending_start'] = False
        _save_cycles_state()
```

**ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚Ñ‹:**
- ğŸ”’ **Lock:** ĞÑ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ğ°Ñ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° Ñ‡ĞµÑ€ĞµĞ· `threading.Lock()`
- ğŸš© **pending_start:** Ğ¤Ğ»Ğ°Ğ³ ÑƒÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ”Ğ Ğ¿Ğ¾ĞºÑƒĞ¿ĞºĞ¸, ÑĞ±Ñ€Ğ°ÑÑ‹Ğ²Ğ°ĞµÑ‚ÑÑ ĞŸĞĞ¡Ğ›Ğ•
- âœ… **Ğ£Ğ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ¾:** Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ñ‹ Ğ¸Ğ·Ğ±Ñ‹Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ `base_volume`, `start_price`, Ğ±Ğ°Ğ»Ğ°Ğ½Ñ BASE
- ğŸ“Š **Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°:** ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿ĞµÑ€ĞµÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¸ Ñ†ĞµĞ½Ñ‹ > 1%

### 4.2. ğŸ“‰ Ğ”Ğ¾ĞºÑƒĞ¿ĞºĞ° (Ğ£ÑÑ€ĞµĞ´Ğ½ĞµĞ½Ğ¸Ğµ) (`_try_rebuy`)

**Ğ¤Ğ°Ğ¹Ğ»:** `autotrader.py` â†’ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ 1686-1954

**Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ´Ğ¾ĞºÑƒĞ¿ĞºĞ¸:**
1. âœ… Ğ¦Ğ¸ĞºĞ» Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ (`active == True`)
2. âœ… Ğ•ÑÑ‚ÑŒ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ ÑˆĞ°Ğ³ Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ (`next_step < len(table)`)
3. âœ… Ğ¦ĞµĞ½Ğ° ÑƒĞ¿Ğ°Ğ»Ğ° Ğ½Ğ° Ñ‚Ñ€ĞµĞ±ÑƒĞµĞ¼Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ñ†ĞµĞ½Ñ‚ (cumulative Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğµ >= Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ°)

**ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼:**
```python
def _try_rebuy(base: str, quote: str):
    # 1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ†Ğ¸ĞºĞ»
    cycle = cycles.get(base)
    
    if not cycle or not cycle['active']:
        return  # Ğ¦Ğ¸ĞºĞ» Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½
    
    # 2. ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ pending.rebuy (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ)
    pending = cycle.get('pending', {})
    if pending.get('rebuy'):
        # ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ Ğ¾Ñ€Ğ´ĞµÑ€ Ğ´Ğ»Ñ Ğ¾ÑÑ‚Ğ°Ñ‚ĞºĞ°
        ...
        return
    
    # 3. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ³Ğ¾ ÑˆĞ°Ğ³Ğ°
    table = cycle['table']
    saved_step = cycle['active_step']
    next_step = saved_step + 1
    
    if next_step >= len(table):
        return  # ĞĞµÑ‚ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ³Ğ¾ ÑˆĞ°Ğ³Ğ°
    
    params_row = table[next_step]
    required_drop_pct = abs(float(params_row['cumulative_decrease_pct']))
    
    # 4. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ†ĞµĞ½Ñƒ Ğ¿Ğ¾ĞºÑƒĞ¿ĞºĞ¸ Ğ¸Ğ· orderbook
    orderbook = _get_orderbook(base, quote)
    level_price = orderbook['asks'][level - 1][0]
    
    # 5. Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğµ Ñ†ĞµĞ½Ñ‹
    start_price = cycle['start_price']
    cumulative_drop_pct = ((start_price - level_price) / start_price) * 100.0
    
    # 6. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğµ Ğ´Ğ¾ĞºÑƒĞ¿ĞºĞ¸
    if cumulative_drop_pct < required_drop_pct:
        return  # ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾Ğµ Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğµ
    
    # 7. Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ¾Ğ±ÑŠÑ‘Ğ¼ Ğ´Ğ¾ĞºÑƒĞ¿ĞºĞ¸
    purchase_usd = float(params_row['purchase_usd'])
    amount_to_buy = purchase_usd / level_price
    
    # 8. Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ğ¾Ñ€Ğ´ĞµÑ€ Ğ½Ğ° Ğ´Ğ¾ĞºÑƒĞ¿ĞºÑƒ
    order_res = _place_limit_order_all_or_nothing('buy', base, quote, amount_to_buy, level_price)
    
    # 9. ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ†Ğ¸ĞºĞ»
    if order_res['success']:
        filled = order_res['filled']
        
        cycle['active_step'] = next_step
        cycle['last_buy_price'] = level_price
        cycle['base_volume'] += filled
        cycle['total_invested_usd'] += filled * level_price
        
        _save_cycles_state()
        logger.log_buy(base, filled, level_price, ...)
```

**ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚Ñ‹:**
- ğŸ“Š **Cumulative Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğµ:** Ğ’ÑĞµĞ³Ğ´Ğ° ÑÑ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ÑÑ Ğ¾Ñ‚ `start_price`
- ğŸ“‰ **ĞŸĞ¾Ñ€Ğ¾Ğ³ Ğ´Ğ¾ĞºÑƒĞ¿ĞºĞ¸:** Ğ‘ĞµÑ€Ñ‘Ñ‚ÑÑ Ğ¸Ğ· Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ (`cumulative_decrease_pct`)
- ğŸ“– **Orderbook:** Ğ¦ĞµĞ½Ğ° Ğ¿Ğ¾ĞºÑƒĞ¿ĞºĞ¸ Ğ±ĞµÑ€Ñ‘Ñ‚ÑÑ Ğ¸Ğ· ÑÑ‚Ğ°ĞºĞ°Ğ½Ğ° (Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾ÑĞºĞ°Ğ»ÑŒĞ·Ñ‹Ğ²Ğ°Ğ½Ğ¸Ñ)
- ğŸ”„ **pending.rebuy:** Ğ•ÑĞ»Ğ¸ Ğ¾Ñ€Ğ´ĞµÑ€ Ğ½Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»Ğ½Ğ¸Ğ»ÑÑ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ, ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ğº

### 4.3. ğŸ’° ĞŸÑ€Ğ¾Ğ´Ğ°Ğ¶Ğ° (`_try_sell`)

**âš ï¸ ĞŸĞ ĞĞ‘Ğ›Ğ•ĞœĞ:** Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ `_try_sell` Ğ½ĞµÑ‚ Ğ² Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¼ `autotrader.py`!

**Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ±Ñ‹Ñ‚ÑŒ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ¾:**

**Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸:**
1. âœ… Ğ¦Ğ¸ĞºĞ» Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ (`active == True`)
2. âœ… Ğ¦ĞµĞ½Ğ° Ğ²Ñ‹Ñ€Ğ¾ÑĞ»Ğ° Ğ½Ğ° Ñ‚Ñ€ĞµĞ±ÑƒĞµĞ¼Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ñ†ĞµĞ½Ñ‚ (Ñ€Ğ¾ÑÑ‚ >= Ğ¿Ğ¾Ñ€Ğ¾Ğ³Ğ° breakeven)

**ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ (Ğ¸Ğ· ÑÑ‚Ğ°Ñ€Ğ¾Ğ¹ Ğ²ĞµÑ€ÑĞ¸Ğ¸ `_autotrader.py`):**
```python
def _try_sell(base: str, quote: str):
    # 1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ñ†Ğ¸ĞºĞ»
    cycle = cycles.get(base)
    
    if not cycle or not cycle['active']:
        return  # Ğ¦Ğ¸ĞºĞ» Ğ½ĞµĞ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½
    
    # 2. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ†ĞµĞ½Ñƒ
    price = _get_market_price(base, quote)
    
    # 3. ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ pending.sell (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ)
    pending = cycle.get('pending', {})
    if pending.get('sell'):
        # ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ Ğ¾Ñ€Ğ´ĞµÑ€ Ğ´Ğ»Ñ Ğ¾ÑÑ‚Ğ°Ñ‚ĞºĞ°
        ...
        return
    
    # 4. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ ÑˆĞ°Ğ³Ğ°
    table = cycle['table']
    active_step = cycle['active_step']
    params_row = table[active_step]
    required_growth_pct = float(params_row['breakeven_pct'])
    
    # 5. Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ñ€Ğ¾ÑÑ‚ Ñ†ĞµĞ½Ñ‹
    start_price = cycle['start_price']
    current_growth_pct = ((price - start_price) / start_price) * 100.0
    
    # 6. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸
    if current_growth_pct < required_growth_pct:
        return  # ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ñ€Ğ¾ÑÑ‚
    
    # 7. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ñ†ĞµĞ½Ñƒ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸ Ğ¸Ğ· orderbook
    orderbook = _get_orderbook(base, quote)
    level_price = orderbook['bids'][level - 1][0]
    
    # 8. Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ¾Ğ±ÑŠÑ‘Ğ¼ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸
    sell_volume = cycle['base_volume']
    
    # 9. Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ğ¾Ñ€Ğ´ĞµÑ€ Ğ½Ğ° Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ñƒ
    order_res = _place_limit_order_all_or_nothing('sell', base, quote, sell_volume, level_price)
    
    # 10. Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ Ñ†Ğ¸ĞºĞ»
    if order_res['success']:
        filled = order_res['filled']
        avg_invest_price = cycle['total_invested_usd'] / cycle['base_volume']
        pnl = (level_price - avg_invest_price) * filled
        
        # Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ñ†Ğ¸ĞºĞ»
        cycles[base] = {
            'active': False,
            'active_step': -1,
            'table': table,
            'last_buy_price': 0.0,
            'start_price': 0.0,
            'total_invested_usd': 0.0,
            'base_volume': 0.0,
            'pending': {},
            'last_sell_time': time.time()
        }
        
        _save_cycles_state()
        logger.log_sell(base, filled, level_price, current_growth_pct, pnl)
```

---

## 5. ğŸ”— Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ buy/sell Ğ² Ñ†Ğ¸ĞºĞ»

### ĞŸĞ¾Ğ»Ğ½Ğ°Ñ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ²Ğ°Ğ»ÑÑ‚Ñ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ²Ğ°Ğ»ÑÑ‚Ñ‹ BTC                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   1. DualThreadAutoTrader._try_process_currency("BTC")      â”‚
â”‚      - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ„Ğ»Ğ°Ğ³Ğ° Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸                             â”‚
â”‚      - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° debounce (0.1Ñ)                             â”‚
â”‚      - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ»Ğ¸                         â”‚
â”‚      - Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ñ„Ğ»Ğ°Ğ³Ğ° processing_flags["BTC"] = True       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   2. DualThreadAutoTrader._execute_trading_logic("BTC")     â”‚
â”‚      - ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ· WebSocket                        â”‚
â”‚      - Ğ’Ñ‹Ğ·Ğ¾Ğ² Ñ‚Ñ€Ñ‘Ñ… Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ¾Ğ² Ğ°Ğ²Ñ‚Ğ¾Ñ‚Ñ€ĞµĞ¹Ğ´ĞµÑ€Ğ°                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                     â”‚
         â–¼                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3a. _try_start_cycle â”‚           â”‚ 3b. _try_rebuy       â”‚
â”‚ (Ğ¡Ñ‚Ğ°Ñ€Ñ‚ Ñ†Ğ¸ĞºĞ»Ğ°)        â”‚           â”‚ (Ğ”Ğ¾ĞºÑƒĞ¿ĞºĞ°)            â”‚
â”‚                      â”‚           â”‚                      â”‚
â”‚ - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Lock      â”‚           â”‚ - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° active    â”‚
â”‚ - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° active    â”‚           â”‚ - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑˆĞ°Ğ³Ğ°      â”‚
â”‚ - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° pending   â”‚           â”‚ - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ñ   â”‚
â”‚ - ĞŸĞ¾ĞºÑƒĞ¿ĞºĞ° ÑˆĞ°Ğ³Ğ° 0     â”‚           â”‚ - ĞŸĞ¾ĞºÑƒĞ¿ĞºĞ° ÑĞ»ĞµĞ´. ÑˆĞ°Ğ³Ğ° â”‚
â”‚ - ĞĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ Ñ†Ğ¸ĞºĞ»Ğ°    â”‚           â”‚ - ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑˆĞ°Ğ³Ğ°    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ 3c. _try_sell        â”‚
                   â”‚ (ĞŸÑ€Ğ¾Ğ´Ğ°Ğ¶Ğ°)            â”‚
                   â”‚                      â”‚
                   â”‚ - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° active    â”‚
                   â”‚ - ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€Ğ¾ÑÑ‚Ğ°     â”‚
                   â”‚ - ĞŸÑ€Ğ¾Ğ´Ğ°Ğ¶Ğ° Ğ²ÑĞµĞ³Ğ¾      â”‚
                   â”‚ - Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ñ†Ğ¸ĞºĞ»Ğ°     â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   4. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ                                   â”‚
â”‚      - last_processed["BTC"] = time.time()                  â”‚
â”‚      - processing_flags["BTC"] = False                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°

```
Time â†’

0.00s  CYCLER: ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° BTC (cycle)
       â”‚
       â”œâ”€ _try_process_currency("BTC", "cycle")
       â”‚  â”‚
       â”‚  â”œâ”€ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ OK
       â”‚  â”‚
       â”‚  â”œâ”€ _execute_trading_logic("BTC")
       â”‚  â”‚  â”‚
       â”‚  â”‚  â”œâ”€ _try_start_cycle("BTC", "USDT") [5ms]
       â”‚  â”‚  â”‚  â””â”€ Ğ¦Ğ¸ĞºĞ» ÑƒĞ¶Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ â†’ return
       â”‚  â”‚  â”‚
       â”‚  â”‚  â”œâ”€ _try_rebuy("BTC", "USDT") [10ms]
       â”‚  â”‚  â”‚  â””â”€ ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾Ğµ Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğµ â†’ return
       â”‚  â”‚  â”‚
       â”‚  â”‚  â””â”€ _try_sell("BTC", "USDT") [8ms]
       â”‚  â”‚     â””â”€ ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ñ€Ğ¾ÑÑ‚ â†’ return
       â”‚  â”‚
       â”‚  â””â”€ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸: last_processed["BTC"] = 0.023s
       â”‚
0.02s  â””â”€ Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾, total=23ms

0.03s  CYCLER: ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ETH (cycle)
       ...

0.15s  REACTOR: WebSocket Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ BTC
       â”‚
       â”œâ”€ Debounce OK (0.15s - 0.02s = 0.13s > 0.1s)
       â”‚
       â”œâ”€ urgent_queue.put({"currency": "BTC", "reason": "price_update"})
       â”‚
0.16s  CYCLER: ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ÑÑ€Ğ¾Ñ‡Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ BTC (urgent)
       â”‚
       â”œâ”€ _try_process_currency("BTC", "urgent:price_update")
       â”‚  â”‚
       â”‚  â”œâ”€ _execute_trading_logic("BTC")
       â”‚  â”‚  â”‚
       â”‚  â”‚  â”œâ”€ _try_start_cycle â†’ return
       â”‚  â”‚  â”‚
       â”‚  â”‚  â”œâ”€ _try_rebuy â†’ return
       â”‚  â”‚  â”‚
       â”‚  â”‚  â””â”€ _try_sell [8ms]
       â”‚  â”‚     â””â”€ Ğ£Ğ¡Ğ›ĞĞ’Ğ˜Ğ• Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞ! ĞŸÑ€Ğ¾Ğ´Ğ°Ğ¶Ğ°...
       â”‚  â”‚        â””â”€ ĞÑ€Ğ´ĞµÑ€ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½, Ñ†Ğ¸ĞºĞ» Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚
       â”‚  â”‚
       â”‚  â””â”€ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: last_processed["BTC"] = 0.168s
       â”‚
0.17s  â””â”€ Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾
```

---

## 6. ğŸ“Š Ğ‘Ğ»Ğ¾Ğº-ÑÑ…ĞµĞ¼Ñ‹ Ğ¸ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹

### Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¹ Ñ‚Ğ¾Ñ€Ğ³Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ñ†Ğ¸ĞºĞ»Ğ°

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Ğ¦Ğ˜ĞšĞ› ĞĞ•ĞĞšĞ¢Ğ˜Ğ’Ğ•Ğ â”‚
                    â”‚  active=False   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ _try_start_cycle()
                             â”‚ Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ñ: active=False, pending_start=False
                             â”‚ Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ: ĞŸĞ¾ĞºÑƒĞ¿ĞºĞ° ÑˆĞ°Ğ³Ğ° 0
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Ğ¦Ğ˜ĞšĞ› ĞĞšĞ¢Ğ˜Ğ’Ğ•Ğ   â”‚
                    â”‚  active=True    â”‚
                    â”‚  active_step=0  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                         â”‚
                â”‚ _try_rebuy()            â”‚ _try_sell()
                â”‚ Ğ¦ĞµĞ½Ğ° Ğ¿Ğ°Ğ´Ğ°ĞµÑ‚             â”‚ Ğ¦ĞµĞ½Ğ° Ñ€Ğ°ÑÑ‚Ñ‘Ñ‚
                â”‚                         â”‚
                â–¼                         â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  Ğ”ĞĞšĞ£ĞŸĞšĞ        â”‚      â”‚  ĞŸĞ ĞĞ”ĞĞ–Ğ        â”‚
       â”‚  active_step++  â”‚      â”‚  active=False   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                         â”‚
                â”‚                         â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Ğ¦Ğ˜ĞšĞ› ĞĞ•ĞĞšĞ¢Ğ˜Ğ’Ğ•Ğ â”‚
                    â”‚  active=False   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹

```
ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ    Flask API    DualThreadAutoTrader    AutoTrader    Gate.io
     â”‚               â”‚                â”‚                  â”‚            â”‚
     â”‚ POST /api/    â”‚                â”‚                  â”‚            â”‚
     â”‚ autotrade/    â”‚                â”‚                  â”‚            â”‚
     â”‚ start         â”‚                â”‚                  â”‚            â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                  â”‚            â”‚
     â”‚               â”‚ start()        â”‚                  â”‚            â”‚
     â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚            â”‚
     â”‚               â”‚                â”‚ _run_cycler()    â”‚            â”‚
     â”‚               â”‚                â”‚ _run_reactor()   â”‚            â”‚
     â”‚               â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚            â”‚
     â”‚               â”‚                â”‚ Thread 1    â”‚    â”‚            â”‚
     â”‚               â”‚                â”‚ Thread 2    â”‚    â”‚            â”‚
     â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚    â”‚            â”‚
     â”‚               â”‚ OK             â”‚             â”‚    â”‚            â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚             â”‚    â”‚            â”‚
     â”‚               â”‚                â”‚             â”‚    â”‚            â”‚
     â”‚               â”‚         CYCLER â”‚ BTC         â”‚    â”‚            â”‚
     â”‚               â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚
     â”‚               â”‚                â”‚ _try_start_cycle()â”‚            â”‚
     â”‚               â”‚                â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚               â”‚                â”‚                  â”‚ place_orderâ”‚
     â”‚               â”‚                â”‚                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚               â”‚                â”‚                  â”‚ filled     â”‚
     â”‚               â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
     â”‚               â”‚                â”‚ cycle activated  â”‚            â”‚
     â”‚               â”‚                â”‚                  â”‚            â”‚
     â”‚               â”‚        REACTOR â”‚ Price update     â”‚            â”‚
     â”‚               â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚
     â”‚               â”‚                â”‚ _try_sell()      â”‚            â”‚
     â”‚               â”‚                â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚               â”‚                â”‚                  â”‚ place_orderâ”‚
     â”‚               â”‚                â”‚                  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚               â”‚                â”‚                  â”‚ filled     â”‚
     â”‚               â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
     â”‚               â”‚                â”‚ cycle closed     â”‚            â”‚
```

---

## ğŸš¨ ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹

### âŒ ĞŸĞ ĞĞ‘Ğ›Ğ•ĞœĞ 1: ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ `_try_sell()`

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:**
- Ğ’ `dual_thread_autotrader.py` Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ `self.autotrader._try_sell(currency, quote)`
- ĞĞ¾ Ğ² `autotrader.py` ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ° **ĞĞ•Ğ¢**!
- ĞœĞµÑ‚Ğ¾Ğ´ ĞµÑÑ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² `_autotrader.py` (ÑÑ‚Ğ°Ñ€Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ, Ğ½ĞµĞ¿Ğ¾Ğ»Ğ½Ğ°Ñ)

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
1. Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ½ÑƒÑ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ `_try_sell()` Ğ² `autotrader.py`
2. Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸ Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ¾ `_try_rebuy()`
3. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºÑƒ `pending.sell` Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº
4. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· `logger.log_sell()`

### âŒ ĞŸĞ ĞĞ‘Ğ›Ğ•ĞœĞ 2: ĞĞµĞ¿Ğ¾Ğ»Ğ½Ğ°Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ² `_autotrader.py`

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:**
- Ğ’ `_autotrader.py` Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ `_try_sell()` Ğ¾Ğ±Ñ€Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° ÑÑ‚Ñ€Ğ¾ĞºĞµ 1547
- Ğ•ÑÑ‚ÑŒ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹: "Ğ”Ğ°Ğ»ĞµĞµ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ´... ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµĞ¼ ÑÑĞ´Ğ°..."
- ĞĞ¾ ĞºĞ¾Ğ´ Ğ½Ğµ ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½!

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**
1. ĞĞ°Ğ¹Ñ‚Ğ¸ Ğ¿Ğ¾Ğ»Ğ½ÑƒÑ Ğ²ĞµÑ€ÑĞ¸Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸
2. ĞŸĞµÑ€ĞµĞ½ĞµÑÑ‚Ğ¸ Ğ² Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ `autotrader.py`
3. Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ `_autotrader.py` (Ğ¸Ğ·Ğ±Ñ‹Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ»)

---

## âœ… Ğ ĞµĞ·ÑĞ¼Ğµ

### Ğ§Ñ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚:
- âœ… Ğ”Ğ²ÑƒÑ…Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° (Cycler + Reactor)
- âœ… Ğ¦Ğ¸ĞºĞ»Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ²Ğ°Ğ»ÑÑ‚
- âœ… Ğ¡Ñ‚Ğ°Ñ€Ñ‚ Ñ†Ğ¸ĞºĞ»Ğ° (`_try_start_cycle`)
- âœ… Ğ”Ğ¾ĞºÑƒĞ¿ĞºĞ° (`_try_rebuy`)
- âœ… WebSocket Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ
- âœ… Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ (Lock, debounce)

### Ğ§Ñ‚Ğ¾ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ:
- âŒ Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ `_try_sell()` Ğ² `autotrader.py`
- âŒ Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ğ¸ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ
- âŒ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºÑƒ `pending.sell`
- âŒ ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ†Ğ¸ĞºĞ»: start â†’ rebuy â†’ sell

---

## ğŸ“š Ğ¡Ğ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹

1. [AUTOTRADER_ARCHITECTURE.md](AUTOTRADER_ARCHITECTURE.md) - Ğ‘Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°
2. [AUTOTRADER_VISUAL_SCHEME.md](AUTOTRADER_VISUAL_SCHEME.md) - Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑÑ…ĞµĞ¼Ñ‹
3. [AUTOTRADER_FIX_SUMMARY.md](AUTOTRADER_FIX_SUMMARY.md) - Ğ ĞµĞ·ÑĞ¼Ğµ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹
4. [QUICK_START_AFTER_FIX.md](QUICK_START_AFTER_FIX.md) - Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚
5. [DOCS_INDEX_AUTOTRADER_FIX.md](DOCS_INDEX_AUTOTRADER_FIX.md) - Ğ˜Ğ½Ğ´ĞµĞºÑ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸

---

**Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾:** 2025-01-XX  
**ĞĞ²Ñ‚Ğ¾Ñ€:** GitHub Copilot  
**Ğ’ĞµÑ€ÑĞ¸Ñ:** 1.0
