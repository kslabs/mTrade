# üßπ –ê–ù–ê–õ–ò–ó autotrader.py - –ü–†–û–ë–õ–ï–ú–´ –ò –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø

**–§–∞–π–ª:** `autotrader.py`  
**–¢–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä:** 2356 —Å—Ç—Ä–æ–∫  
**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 5 –¥–µ–∫–∞–±—Ä—è 2025 –≥.

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

### –û–≥—Ä–æ–º–Ω—ã–π –±–ª–æ–∫ –º—É—Å–æ—Ä–Ω–æ–≥–æ –∫–æ–¥–∞ –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞

**–°—Ç—Ä–æ–∫–∏ 1-150:** –°–æ–¥–µ—Ä–∂–∞—Ç –æ–≥—Ä–æ–º–Ω—ã–π docstring —Å **–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º/–Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–º –∫–æ–¥–æ–º**:

```python
"""
–ê–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä –¥–ª—è mTrade...

5. –û—Ä–¥–µ—Ä—ã:
   - –ò—Å–ø–æ–ª—å–∑—É–µ–º limit FOK...
            # record failed fill    ‚Üê –ù–ï–ó–ê–í–ï–†–®–Å–ù–ù–´–ô –ö–û–î!
            try:
                try:
                    self._set_last_diagnostic(...)
                except Exception:
                    pass
            except Exception:
                pass
            # –ï—â—ë 100+ —Å—Ç—Ä–æ–∫ –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–≥–æ –∫–æ–¥–∞...
"""
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –≠—Ç–æ –ù–ï –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è - —ç—Ç–æ –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π –∫–æ–¥
- ‚ùå –ó–∞–Ω–∏–º–∞–µ—Ç ~150 —Å—Ç—Ä–æ–∫ –≤–ø—É—Å—Ç—É—é
- ‚ùå –ó–∞—Ç—Ä—É–¥–Ω—è–µ—Ç —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
- ‚ùå –ú–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—à–∏–±–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞

---

## üìä –°–¢–†–£–ö–¢–£–†–ê –§–ê–ô–õ–ê (—Ç–µ–∫—É—â–∞—è)

```
–°—Ç—Ä–æ–∫–∏ 1-150:    –ú—É—Å–æ—Ä–Ω—ã–π docstring (–Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π –∫–æ–¥)
–°—Ç—Ä–æ–∫–∏ 151-160:  –ò–º–ø–æ—Ä—Ç—ã
–°—Ç—Ä–æ–∫–∏ 161-252:  __init__ –º–µ—Ç–æ–¥
–°—Ç—Ä–æ–∫–∏ 253-920:  –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
–°—Ç—Ä–æ–∫–∏ 920-1685: _try_start_cycle_impl (709 —Å—Ç—Ä–æ–∫! –û–ì–†–û–ú–ù–´–ô!)
–°—Ç—Ä–æ–∫–∏ 1686-1953: _try_rebuy (268 —Å—Ç—Ä–æ–∫)
–°—Ç—Ä–æ–∫–∏ 1954-2210: _try_sell (257 —Å—Ç—Ä–æ–∫)
–°—Ç—Ä–æ–∫–∏ 2211-2356: _run –∏ —É—Ç–∏–ª–∏—Ç—ã
```

---

## üéØ –ü–õ–ê–ù –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò

### 1. **–£–¥–∞–ª–∏—Ç—å –º—É—Å–æ—Ä–Ω—ã–π docstring** (—Å—Ç—Ä–æ–∫–∏ 1-150)
**–≠–∫–æ–Ω–æ–º–∏—è:** ~150 —Å—Ç—Ä–æ–∫

–ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∫—Ä–∞—Ç–∫–∏–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π docstring:

```python
"""
–ê–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä –¥–ª—è mTrade —Å –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º breakeven.

–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- _try_start_cycle: –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ —Ç–æ—Ä–≥–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
- _try_rebuy: –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ (–¥–æ–∫—É–ø–∫–∞ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏)
- _try_sell: –ü—Ä–æ–¥–∞–∂–∞ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ breakeven
"""
```

### 2. **–£–¥–∞–ª–∏—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ print() –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏**
**–≠–∫–æ–Ω–æ–º–∏—è:** ~100-150 —Å—Ç—Ä–æ–∫

–ú–Ω–æ–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ print():

```python
# –ë–´–õ–û (–≤ _try_start_cycle_impl):
print(f"[PROTECTION][{base}] ‚ùå –ë–õ–û–ö–ò–†–û–í–ö–ê –°–¢–ê–†–¢–ê –¶–ò–ö–õ–ê:")
print(f"[PROTECTION][{base}] –ë–∞–ª–∞–Ω—Å BASE: {base_balance:.8f}...")
print(f"[PROTECTION][{base}] –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Ä–¥–µ—Ä: {purchase_usd:.2f}...")
print(f"[PROTECTION][{base}] –ü–†–ò–ß–ò–ù–ê: ...")
print(f"[PROTECTION][{base}] –†–ï–®–ï–ù–ò–ï: ...")

# –°–¢–ê–ù–ï–¢:
print(f"[{base}] –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞: –±–∞–ª–∞–Ω—Å BASE ({base_balance_in_quote:.2f}) >= –º–∏–Ω.–æ—Ä–¥–µ—Ä–∞ ({purchase_usd:.2f})")
```

### 3. **–£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∏**
**–≠–∫–æ–Ω–æ–º–∏—è:** ~50-100 —Å—Ç—Ä–æ–∫

–ú–Ω–æ–≥–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è:

```python
# –í _try_start_cycle: –ø—Ä–æ–≤–µ—Ä–∫–∞ active
if cycle.get('active'):
    return

# –í _try_start_cycle_impl: —Ç–∞ –∂–µ –ø—Ä–æ–≤–µ—Ä–∫–∞
if cycle.get('active'):
    return

# –ò –µ—â–µ —Ä–∞–∑...
if cycle.get('active'):
    return
```

### 4. **–í—ã–Ω–µ—Å—Ç–∏ –æ–±—â—É—é –ª–æ–≥–∏–∫—É –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã**
**–≠–∫–æ–Ω–æ–º–∏—è:** ~100-200 —Å—Ç—Ä–æ–∫

–ú–Ω–æ–≥–æ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞ –º–µ–∂–¥—É _try_start_cycle_impl, _try_rebuy, _try_sell:
- –ü–æ–ª—É—á–µ–Ω–∏–µ orderbook
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
- –†–∞—Å—á—ë—Ç precision
- –†–∞–∑–º–µ—â–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å:
```python
def _get_orderbook_price(self, base, quote, side='buy')
def _check_liquidity(self, orderbook, amount, side='buy')
def _execute_order_with_retry(self, side, base, quote, amount, price)
```

### 5. **–£–¥–∞–ª–∏—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ try/except –±–ª–æ–∫–∏**
**–≠–∫–æ–Ω–æ–º–∏—è:** ~50 —Å—Ç—Ä–æ–∫

–ú–Ω–æ–≥–æ –ø—É—Å—Ç—ã—Ö try/except:

```python
# –ë–´–õ–û:
try:
    some_code()
except Exception:
    pass  # –ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º

# –°–¢–ê–ù–ï–¢: –ø—Ä–æ—Å—Ç–æ —É–±—Ä–∞—Ç—å –±–ª–æ–∫ –∏–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å
```

### 6. **–£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏**
**–≠–∫–æ–Ω–æ–º–∏—è:** ~30-50 —Å—Ç—Ä–æ–∫

```python
# ====== –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ó–ê–©–ò–¢–ê: ...
# ====== –ö–†–ò–¢–ò–ß–ù–û: ...
# ====== –í–ê–ñ–ù–û: ...
# ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: ...
```

–ú–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è "–ö–†–ò–¢–ò–ß–ï–°–ö–ò–•" –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.

---

## üìè –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- **2356 —Å—Ç—Ä–æ–∫**
- –¢—Ä—É–¥–Ω–æ —á–∏—Ç–∞—Ç—å
- –ú–Ω–æ–≥–æ –º—É—Å–æ—Ä–∞
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–ø—Ä–∏–º–µ—Ä–Ω–æ):
- **~1500-1700 —Å—Ç—Ä–æ–∫** (—Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –Ω–∞ 30-40%)
- –ß–∏—Å—Ç—ã–π –∫–æ–¥
- –õ–µ–≥–∫–æ —á–∏—Ç–∞—Ç—å
- –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

---

## ‚ö†Ô∏è –ß–¢–û –î–ï–õ–ê–¢–¨

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)
–Ø –º–æ–≥—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –£–¥–∞–ª–∏—Ç—å –º—É—Å–æ—Ä–Ω—ã–π docstring (—Å—Ç—Ä–æ–∫–∏ 1-150)
2. –°–æ–∫—Ä–∞—Ç–∏—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ print()
3. –£–¥–∞–ª–∏—Ç—å –ø—É—Å—Ç—ã–µ try/except
4. –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

**–†–∏—Å–∫:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (–∫–æ–¥ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è —Ä–∞–±–æ—á–∏–º)

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ì–ª—É–±–æ–∫–∏–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:
5. –í—ã–Ω–µ—Å—Ç–∏ –æ–±—â—É—é –ª–æ–≥–∏–∫—É –≤ –º–µ—Ç–æ–¥—ã
6. –£–ø—Ä–æ—Å—Ç–∏—Ç—å _try_start_cycle_impl (—Ä–∞–∑–±–∏—Ç—å –Ω–∞ —á–∞—Å—Ç–∏)

**–†–∏—Å–∫:** –°—Ä–µ–¥–Ω–∏–π (–Ω—É–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

### –í–∞—Ä–∏–∞–Ω—Ç 3: –¢–æ–ª—å–∫–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
–¢–æ–ª—å–∫–æ —É–¥–∞–ª–∏—Ç—å –º—É—Å–æ—Ä–Ω—ã–π docstring –∏ —Å–æ–∑–¥–∞—Ç—å —á–∏—Å—Ç—ã–π —Ñ–∞–π–ª.

**–†–∏—Å–∫:** –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

---

## üöÄ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

**–ù–∞—á–∞—Ç—å —Å –í–∞—Ä–∏–∞–Ω—Ç–∞ 1** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞:
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ
- ‚úÖ –ë—ã—Å—Ç—Ä–æ (~5 –º–∏–Ω—É—Ç)
- ‚úÖ –°—Ä–∞–∑—É –≤–∏–¥–∏–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- ‚úÖ –°–æ–∫—Ä–∞—Ç–∏—Ç —Ñ–∞–π–ª –Ω–∞ 500-700 —Å—Ç—Ä–æ–∫

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –í–∞—Ä–∏–∞–Ω—Ç 2, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ.

---

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û (5 –¥–µ–∫–∞–±—Ä—è 2025)

### –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–µ—Ä–≤–æ–≥–æ —ç—Ç–∞–ø–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- **–£–¥–∞–ª–µ–Ω–æ:** 171 —Å—Ç—Ä–æ–∫–∞ (7.3%)
- **–ë—ã–ª–æ:** 2356 —Å—Ç—Ä–æ–∫
- **–°—Ç–∞–ª–æ:** 2185 —Å—Ç—Ä–æ–∫
- **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

**–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏:** —Å–º. `AUTOTRADER_OPTIMIZATION_RESULT.md`

---

**–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å?**
1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ (–í–∞—Ä–∏–∞–Ω—Ç 1)
2. –ì–ª—É–±–æ–∫–∏–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ (–í–∞—Ä–∏–∞–Ω—Ç 2)
3. –¢–æ–ª—å–∫–æ —É–¥–∞–ª–∏—Ç—å –º—É—Å–æ—Ä–Ω—ã–π docstring (–í–∞—Ä–∏–∞–Ω—Ç 3)
