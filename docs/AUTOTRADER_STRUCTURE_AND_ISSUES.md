# üîç –°–¢–†–£–ö–¢–£–†–ê –ê–í–¢–û–¢–†–ï–ô–î–ï–†–ê –ò –í–´–Ø–í–õ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

**–î–∞—Ç–∞:** 5 –¥–µ–∫–∞–±—Ä—è 2025 –≥.  
**–°—Ç–∞—Ç—É—Å:** üö® –¢–†–ï–ë–£–ï–¢ –í–ù–ò–ú–ê–ù–ò–Ø  

---

## üìÅ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã –∞–≤—Ç–æ—Ç–æ—Ä–≥–æ–≤–ª–∏

### 1. **autotrader.py** (2356 —Å—Ç—Ä–æ–∫) - –û–°–ù–û–í–ù–û–ô –§–ê–ô–õ
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `c:\Users\–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä\Documents\bGate.mTrade\autotrader.py`

–ö–ª–∞—Å—Å `AutoTrader` - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ—Ç–æ—Ä–≥–æ–≤–ª–∏ –¥–ª—è –≤—Å–µ—Ö –≤–∞–ª—é—Ç.

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Å–∞:

```python
class AutoTrader:
    def __init__(self, api_client_provider, ws_manager, state_manager)
    
    # === –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ===
    def start()                     # –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä–∞
    def stop()                      # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä–∞
    
    # === –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è ===
    def _save_cycles_state()        # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–∏–∫–ª—ã –≤ JSON
    def _load_cycles_state()        # –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ü–∏–∫–ª—ã –∏–∑ JSON
    def _save_diagnostics_state()   # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
    def _load_diagnostics_state()   # –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
    
    # === –†–∞–±–æ—Ç–∞ —Å —Ü–µ–Ω–∞–º–∏ –∏ –¥–∞–Ω–Ω—ã–º–∏ ===
    def _ensure_ws_subscription()   # –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ WebSocket
    def _get_market_price()         # –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É
    def _get_orderbook()            # –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞–∫–∞–Ω –æ—Ä–¥–µ—Ä–æ–≤
    def _update_last_price()        # –û–±–Ω–æ–≤–∏—Ç—å –∫—ç—à —Ü–µ–Ω—ã
    
    # === –†–∞—Å—á—ë—Ç—ã ===
    def _recalc_table_if_needed()   # –ü–µ—Ä–µ—Å—á—ë—Ç —Ç–∞–±–ª–∏—Ü—ã breakeven
    def _ensure_cycle_struct()      # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ü–∏–∫–ª–∞
    
    # === –†–∞–±–æ—Ç–∞ —Å –æ—Ä–¥–µ—Ä–∞–º–∏ ===
    def _place_limit_order_all_or_nothing()  # –†–∞–∑–º–µ—â–µ–Ω–∏–µ FOK/IOC –æ—Ä–¥–µ—Ä–æ–≤
    def _parse_filled_amount()               # –ü–∞—Ä—Å–∏–Ω–≥ –∏—Å–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –æ–±—ä—ë–º–∞
    
    # === –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö ===
    def _get_account_balance()      # –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å (—Å –∫—ç—à–µ–º)
    def _get_pair_info()            # –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∞—Ä–µ
    
    # === –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ ===
    def _set_last_diagnostic()      # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É —Ä–µ—à–µ–Ω–∏—è
    
    # === –û–°–ù–û–í–ù–´–ï –¢–û–†–ì–û–í–´–ï –§–£–ù–ö–¶–ò–ò ===
    def _try_start_cycle()          # üîµ –°–¢–ê–†–¢ —Ü–∏–∫–ª–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∏)
    def _try_start_cycle_impl()     # üîµ –°–¢–ê–†–¢ —Ü–∏–∫–ª–∞ (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
    def _try_rebuy()                # üü° –£–°–†–ï–î–ù–ï–ù–ò–ï (–¥–æ–∫—É–ø–∫–∞)
    def _try_sell()                 # üü¢ –ü–†–û–î–ê–ñ–ê (–≤—ã—Ö–æ–¥)
    
    # === –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª ===
    def _run()                      # –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏
    def _autosave_logs_loop()       # –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤
```

---

### 2. **dual_thread_autotrader.py** - –û–ë–Å–†–¢–ö–ê –î–õ–Ø WINDOWS
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `c:\Users\–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä\Documents\bGate.mTrade\dual_thread_autotrader.py`

–û–±—ë—Ä—Ç–∫–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ (—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Windows).

---

### 3. **mTrade.py** - –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `c:\Users\–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä\Documents\bGate.mTrade\mTrade.py`

–û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π:
- –°–æ–∑–¥–∞—ë—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä `DualThreadAutoTrader`
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
  - `/api/autotrader/stats?base_currency=SOL`
  - `/api/autotrader/reset_cycle`

---

## üîÑ –û–°–ù–û–í–ù–û–ô –¶–ò–ö–õ –†–ê–ë–û–¢–´

### –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª (_run) —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫:

```python
while self.running:
    for base in permitted_currencies:
        # 1. –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ WebSocket
        _ensure_ws_subscription(base, quote)
        
        # 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã
        price = _get_market_price(base, quote)
        
        # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ü–∏–∫–ª–∞
        _ensure_cycle_struct(base)
        cycle = cycles.get(base)
        
        # 4. –õ–û–ì–ò–ö–ê –¢–û–†–ì–û–í–õ–ò
        if cycle.get('active'):
            # –¶–ò–ö–õ –ê–ö–¢–ò–í–ï–ù
            _try_sell(base, quote)    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–¥–∞–∂–∏
            _try_rebuy(base, quote)   # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–∫—É–ø–∫–∏
        else:
            # –¶–ò–ö–õ –ù–ï –ê–ö–¢–ò–í–ï–ù
            _try_start_cycle(base, quote)  # –ü–æ–ø—ã—Ç–∫–∞ —Å—Ç–∞—Ä—Ç–∞
    
    time.sleep(0.5)  # –ò–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –∏—Ç–µ—Ä–∞—Ü–∏—è–º–∏
```

---

## üö® –í–´–Ø–í–õ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê 1: –û–≥—Ä–æ–º–Ω—ã–π –±–ª–æ–∫ —Ö–∞–æ—Ç–∏—á–Ω–æ–≥–æ –∫–æ–¥–∞ –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞

**–°—Ç—Ä–æ–∫–∏:** 1-150

–í –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞ `autotrader.py` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è **–æ–≥—Ä–æ–º–Ω—ã–π –±–ª–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏ –Ω–µ—Ä–∞–±–æ—á–µ–≥–æ –∫–æ–¥–∞**, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç:
- –§—Ä–∞–≥–º–µ–Ω—Ç—ã —Å—Ç–∞—Ä–æ–π –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–¥–∞–∂–∏
- –ù–µ–∑–∞–∫—Ä—ã—Ç—ã–µ try/except –±–ª–æ–∫–∏
- –î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- –û—Å—Ç–∞—Ç–∫–∏ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–≥–æ –∫–æ–¥–∞

**–ü—Ä–∏–º–µ—Ä:**
```python
# record failed fill
try:
    try:
        self._set_last_diagnostic(base, {'decision': 'sell_attempt_failed', ...})
    except Exception:
        pass
except Exception:
    pass
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –§–∞–π–ª —Ç—Ä—É–¥–Ω–æ —á–∏—Ç–∞—Ç—å
- –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –æ—à–∏–±–æ–∫ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
- –ù–µ–ø–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫–æ–π –∫–æ–¥ –∞–∫—Ç–∏–≤–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ –∞—Ä—Ö–∏–≤

---

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê 2: –§—É–Ω–∫—Ü–∏—è _try_sell() –Ω–µ –≤—ã–∑—ã–≤–∞–ª–∞—Å—å

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

–§—É–Ω–∫—Ü–∏—è –±—ã–ª–∞ —Å–æ–∑–¥–∞–Ω–∞, –Ω–æ –Ω–µ –≤—ã–∑—ã–≤–∞–ª–∞—Å—å –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ.

**–ë—ã–ª–æ:**
```python
if cycle.get('active'):
    self._try_rebuy(base, quote)  # –¢–æ–ª—å–∫–æ –¥–æ–∫—É–ø–∫–∞!
```

**–°—Ç–∞–ª–æ:**
```python
if cycle.get('active'):
    self._try_sell(base, quote)   # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–¥–∞–∂–∏
    self._try_rebuy(base, quote)  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–∫—É–ø–∫–∏
```

---

### ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê 3: –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª —Ü–∏–∫–ª–∞

**–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:** `self._sleep_interval = 0.5` (500 –º—Å)

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –°–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–∑–¥–∞—é—Ç –Ω–∞–≥—Ä—É–∑–∫—É
- –ü–æ–≤—ã—à–µ–Ω–Ω—ã–π —Ä–∏—Å–∫ rate limit –æ—Ç –±–∏—Ä–∂–∏
- –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 2-5 —Å–µ–∫—É–Ω–¥:
```python
self._sleep_interval = 2.0  # 2 —Å–µ–∫—É–Ω–¥—ã
```

---

### ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê 4: –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –≤—ã–∑–æ–≤—ã API

**–í –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –ö–ê–ñ–î–û–ô –≤–∞–ª—é—Ç—ã –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:**
1. `_get_market_price()` - –∑–∞–ø—Ä–æ—Å —Ü–µ–Ω—ã
2. `_get_orderbook()` - –∑–∞–ø—Ä–æ—Å —Å—Ç–∞–∫–∞–Ω–∞ (–≤ _try_rebuy –∏ _try_sell)
3. `_get_account_balance()` - –∑–∞–ø—Ä–æ—Å –±–∞–ª–∞–Ω—Å–∞ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑)

**–î–ª—è 10 –≤–∞–ª—é—Ç —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 0.5 —Å–µ–∫:**
- 10 –∑–∞–ø—Ä–æ—Å–æ–≤ —Ü–µ–Ω—ã / 0.5 —Å–µ–∫ = **20 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫**
- 20+ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å—Ç–∞–∫–∞–Ω–∞ / 0.5 —Å–µ–∫ = **40+ –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫**
- –ò—Ç–æ–≥–æ: **60+ –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫ –∫ API**

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à –±–∞–ª–∞–Ω—Å–æ–≤ (—É–∂–µ –µ—Å—Ç—å: `balance_cache`)
- –£–≤–µ–ª–∏—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª —Ü–∏–∫–ª–∞
- –ü–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ WebSocket, –∞ –Ω–µ REST API

---

### ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê 5: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ü–∏–∫–ª–µ

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```python
try:
    # ... –ª–æ–≥–∏–∫–∞ ...
except Exception:
    pass  # –ü—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è!
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –û—à–∏–±–∫–∏ –º–æ–ª—á–∞ –ø—Ä–æ–≥–ª–∞—Ç—ã–≤–∞—é—Ç—Å—è
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
- –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π

**–†–µ—à–µ–Ω–∏–µ:**
```python
try:
    # ... –ª–æ–≥–∏–∫–∞ ...
except Exception as e:
    print(f"[AutoTrader][{base}] ‚ùå –û—à–∏–±–∫–∞: {str(e)}")
    traceback.print_exc()
```

---

### ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê 6: –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —É—Å–ª–æ–≤–∏–π –ø–æ–∫—É–ø–∫–∏/–ø—Ä–æ–¥–∞–∂–∏

**–§—É–Ω–∫—Ü–∏–∏ _try_start_cycle(), _try_rebuy(), _try_sell() —Å–æ–¥–µ—Ä–∂–∞—Ç:**
- –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
- –î—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è –∫–æ–¥
- –°–ª–æ–∂–Ω—ã–µ —Ä–∞—Å—á—ë—Ç—ã –±–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- –¢—Ä—É–¥–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å, –ø–æ—á–µ–º—É —Ä–µ—à–µ–Ω–∏–µ –ù–ï –ø—Ä–∏–Ω—è—Ç–æ

**–ü—Ä–∏–º–µ—Ä –∏–∑ _try_start_cycle() (—Å—Ç—Ä–æ–∫–∏ 920-1686):**
- 766 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞!
- –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö if/else
- –¢—Ä—É–¥–Ω–æ –ø–æ–Ω—è—Ç—å –ª–æ–≥–∏–∫—É

**–†–µ—à–µ–Ω–∏–µ:**
- –†–∞–∑–±–∏—Ç—å –Ω–∞ –ø–æ–¥—Ñ—É–Ω–∫—Ü–∏–∏
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏

---

### ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê 7: –ù–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ—à–µ–Ω–∏–π

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- `print()` —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ –≤—Å–µ–º—É –∫–æ–¥—É
- –ù–µ—Ç –µ–¥–∏–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
- –¢—Ä—É–¥–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏
- –ù–µ—Ç —É—Ä–æ–≤–Ω–µ–π –≤–∞–∂–Ω–æ—Å—Ç–∏ (INFO/DEBUG/ERROR)

**–†–µ—à–µ–Ω–∏–µ:**
```python
import logging

self.logger = logging.getLogger('AutoTrader')
self.logger.info(f"[{base}] –°—Ç–∞—Ä—Ç —Ü–∏–∫–ª–∞")
self.logger.error(f"[{base}] –û—à–∏–±–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–∞")
```

---

### ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê 8: –ì–æ–Ω–∫–∞ —É—Å–ª–æ–≤–∏–π –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –±–∞–ª–∞–Ω—Å–∞

**–í _try_start_cycle():**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –±–∞–ª–∞–Ω—Å USDT
2. –†–∞–∑–º–µ—â–∞–µ—Ç—Å—è –æ—Ä–¥–µ—Ä –Ω–∞ –ø–æ–∫—É–ø–∫—É
3. –ú–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ –ø–æ–∫—É–ø–∫–æ–π –±–∞–ª–∞–Ω—Å –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è (–¥—Ä—É–≥–æ–π –ø—Ä–æ—Ü–µ—Å—Å/–æ—Ä–¥–µ—Ä)

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Lock –¥–ª—è –±–∞–ª–∞–Ω—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –±–∞–ª–∞–Ω—Å –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –ø–µ—Ä–µ–¥ –æ—Ä–¥–µ—Ä–æ–º

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –§–ê–ô–õ–ê autotrader.py

- **–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫:** 2356
- **–ö–ª–∞—Å—Å–æ–≤:** 1 (AutoTrader)
- **–ú–µ—Ç–æ–¥–æ–≤:** 26
- **–ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª:** _run() (—Å—Ç—Ä–æ–∫–∏ 2243-2323)
- **–°–∞–º—ã–π –±–æ–ª—å—à–æ–π –º–µ—Ç–æ–¥:** _try_start_cycle_impl() (709 —Å—Ç—Ä–æ–∫!)

---

## üéØ –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –ò –ò–• –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï

### 1. _try_start_cycle() - –°—Ç–∞—Ä—Ç –Ω–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞

**–°—Ç—Ä–æ–∫–∏:** 920-976  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º  
**–ü—Ä–æ–±–ª–µ–º—ã:**
- –î—É–±–ª–∏—Ä—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑ _try_start_cycle_impl()
- –ú–æ–∂–Ω–æ —É–ø—Ä–æ—Å—Ç–∏—Ç—å

### 2. _try_start_cycle_impl() - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ä—Ç–∞

**–°—Ç—Ä–æ–∫–∏:** 977-1685  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –ø–æ–∫—É–ø–∫–∏  
**–ü—Ä–æ–±–ª–µ–º—ã:**
- 709 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ - —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∞—è —Ñ—É–Ω–∫—Ü–∏—è!
- –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞
- –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö if/else
- –¢—Ä—É–¥–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 3. _try_rebuy() - –£—Å—Ä–µ–¥–Ω–µ–Ω–∏–µ (–¥–æ–∫—É–ø–∫–∞)

**–°—Ç—Ä–æ–∫–∏:** 1686-1953  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –î–æ–∫—É–ø–∫–∞ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ü–µ–Ω—ã  
**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ü–æ—Ö–æ–∂–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ _try_start_cycle_impl()
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- –ú–æ–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –æ–±—â—É—é –ª–æ–≥–∏–∫—É

### 4. _try_sell() - –ü—Ä–æ–¥–∞–∂–∞ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ breakeven

**–°—Ç—Ä–æ–∫–∏:** 1954-2210  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–¥–∞–∂–∞ –ø—Ä–∏ —Ä–æ—Å—Ç–µ —Ü–µ–Ω—ã  
**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ù–µ–¥–∞–≤–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏ –Ω–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞!
- –ü–æ—Ö–æ–∂–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ –¥—Ä—É–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫

---

## üîß –ß–¢–û –ù–£–ñ–ù–û –ò–°–ü–†–ê–í–ò–¢–¨ –°–†–û–ß–ù–û

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ö—Ä–∏—Ç–∏—á–Ω–æ

1. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ _try_sell()** - –ò–°–ü–†–ê–í–õ–ï–ù–û
2. ‚ùå **–£–≤–µ–ª–∏—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª —Ü–∏–∫–ª–∞ –¥–æ 2-5 —Å–µ–∫**
3. ‚ùå **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ (traceback)**
4. ‚ùå **–û—á–∏—Å—Ç–∏—Ç—å –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞ –æ—Ç —Ö–∞–æ—Å–∞**

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –í–∞–∂–Ω–æ

5. ‚ùå **–î–æ–±–∞–≤–∏—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
6. ‚ùå **–£–ø—Ä–æ—Å—Ç–∏—Ç—å _try_start_cycle_impl()** (—Ä–∞–∑–±–∏—Ç—å –Ω–∞ —á–∞—Å—Ç–∏)
7. ‚ùå **–£–ª—É—á—à–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**
8. ‚ùå **–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ rate limits**

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ

9. ‚ùå **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –æ–±—â–µ–≥–æ –∫–æ–¥–∞ buy/sell**
10. ‚ùå **–î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã**
11. ‚ùå **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–µ—à–µ–Ω–∏–π**
12. ‚ùå **–°–æ–∑–¥–∞—Ç—å debug —Ä–µ–∂–∏–º —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –ª–æ–≥–∞–º–∏**

---

## üìù –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –£–õ–£–ß–®–ï–ù–ò–Æ

### 1. –£–ø—Ä–æ—Å—Ç–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É

```python
# –ü–õ–û–•–û (—Å–µ–π—á–∞—Å):
def _try_start_cycle_impl(self, base: str, quote: str):
    # 709 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
    if condition1:
        if condition2:
            if condition3:
                # ...

# –•–û–†–û–®–û (–Ω—É–∂–Ω–æ):
def _try_start_cycle_impl(self, base: str, quote: str):
    if not self._check_start_conditions(base, quote):
        return
    
    if not self._check_balances(base, quote):
        return
    
    result = self._execute_start_buy(base, quote)
    self._handle_buy_result(base, result)
```

### 2. –î–æ–±–∞–≤–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É

```python
def _try_sell(self, base: str, quote: str):
    self.logger.debug(f"[{base}] –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π –ø—Ä–æ–¥–∞–∂–∏...")
    
    if not cycle.get('active'):
        self.logger.debug(f"[{base}] –¶–∏–∫–ª –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω, –ø—Ä–æ–¥–∞–∂–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞")
        return
    
    # ... –ª–æ–≥–∏–∫–∞ ...
```

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã

```python
# –ü–õ–û–•–û:
if filled >= sell_volume * 0.999:

# –•–û–†–û–®–û:
FILL_THRESHOLD = 0.999  # 99.9% —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–æ–ª–Ω—ã–º –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ–º
if filled >= sell_volume * FILL_THRESHOLD:
```

---

## üß™ –ö–ê–ö –¢–ï–°–¢–ò–†–û–í–ê–¢–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### 1. –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```powershell
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –æ—Ç–ª–∞–¥–∫–æ–π
python -u mTrade.py 2>&1 | Tee-Object -FilePath "autotrader_debug.log"
```

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ API

```powershell
# –ö–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ç–∞—Ç—É—Å
while ($true) {
    curl "http://localhost:5000/api/autotrader/stats?base_currency=SOL"
    Start-Sleep -Seconds 5
}
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```powershell
# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
Select-String -Pattern "error|exception|fail" -Path "*.log" -CaseSensitive:$false
```

---

## üìö –°–í–Ø–ó–ê–ù–ù–´–ï –î–û–ö–£–ú–ï–ù–¢–´

- [AUTOTRADER_COMPLETE_ARCHITECTURE.md](AUTOTRADER_COMPLETE_ARCHITECTURE.md) - –ü–æ–ª–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- [MISSING_TRY_SELL_PROBLEM.md](MISSING_TRY_SELL_PROBLEM.md) - –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–æ–¥–∞–∂–µ–π
- [SELL_FUNCTION_INTEGRATED.md](SELL_FUNCTION_INTEGRATED.md) - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–¥–∞–∂–∏
- [RESTORE_TRY_SELL_CHECKLIST.md](RESTORE_TRY_SELL_CHECKLIST.md) - –ß–µ–∫-–ª–∏—Å—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

---

**–°–æ–∑–¥–∞–Ω–æ:** 5 –¥–µ–∫–∞–±—Ä—è 2025 –≥., 13:15  
**–ê–≤—Ç–æ—Ä:** GitHub Copilot  
**–°—Ç–∞—Ç—É—Å:** üîç –ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–Å–ù, –¢–†–ï–ë–£–Æ–¢–°–Ø –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø
