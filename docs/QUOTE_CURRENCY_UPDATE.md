# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –°–µ–ª–µ–∫—Ç–æ—Ä –∫–æ—Ç–∏—Ä—É–µ–º–æ–π –≤–∞–ª—é—Ç—ã –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ

## –î–∞—Ç–∞: 9 –Ω–æ—è–±—Ä—è 2025

## –í–Ω–µ—Å—ë–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –∫–æ—Ç–∏—Ä—É–µ–º–æ–π –≤–∞–ª—é—Ç—ã

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ "üìà –†—ã–Ω–æ–∫ –∏ —Å—Ç–∞–∫–∞–Ω" (—Å–ø—Ä–∞–≤–∞)

**HTML** (templates/index.html, —Å—Ç—Ä–æ–∫–∞ ~391):
```html
<h3 style="display:flex;justify-content:space-between;align-items:center;">
    <span>üìà –†—ã–Ω–æ–∫ –∏ —Å—Ç–∞–∫–∞–Ω</span>
    <select id="quoteCurrencySelect" 
            style="background:#1a1a1a;color:#ccc;border:1px solid #3a3a3a;border-radius:4px;padding:6px 10px;font-size:13px;font-weight:600;cursor:pointer;outline:none;" 
            onchange="switchQuoteCurrency(this.value)">
        <option value="USDT">USDT</option>
        <option value="USDC">USDC</option>
        <option value="BTC">BTC</option>
        <option value="ETH">ETH</option>
    </select>
</h3>
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –°–µ–ª–µ–∫—Ç–æ—Ä —Ç–µ–ø–µ—Ä—å –æ–±—â–∏–π –¥–ª—è –≤—Å–µ—Ö –≤–∞–ª—é—Ç
- –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω —Å–ø—Ä–∞–≤–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ —Å–µ–∫—Ü–∏–∏
- –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

### 2. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é 2 –∑–Ω–∞–∫–∞

**–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã** –≤ —ç–ª–µ–º–µ–Ω—Ç–µ `#currentPairPrice`:
```javascript
// –¶–µ–Ω–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ "–†—ã–Ω–æ–∫ –∏ —Å—Ç–∞–∫–∞–Ω" —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é 2 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
const pp=$('currentPairPrice'); 
if(pp) pp.textContent='$'+(isNaN(last) ? '0.00' : last.toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2}));
```

**–ü—Ä–∏–º–µ—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è**:
- BTC/USDT: $42,567.89
- WLD/USDT: $3.45
- ETH/BTC: $0.06

### 3. –§—É–Ω–∫—Ü–∏—è switchQuoteCurrency()

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—Ç–∏—Ä—É–µ–º–æ–π –≤–∞–ª—é—Ç—ã –¥–ª—è –≤—Å–µ—Ö –±–∞–∑–æ–≤—ã—Ö –≤–∞–ª—é—Ç

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**:
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `currentQuoteCurrency`
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–æ —Å—Ç–∞—Ä—ã–º —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º (–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI (–∏–º–µ–Ω–∞ –ø–∞—Ä, —Å–∏–º–≤–æ–ª—ã)
- –ü–µ—Ä–µ–ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ WebSocket –¥–∞–Ω–Ω—ã–µ
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Å—Ç–∞–∫–∞–Ω, –±–∞–ª–∞–Ω—Å—ã, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
- –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ UI state —á–µ—Ä–µ–∑ API

**–ö–æ–¥** (templates/index.html):
```javascript
async function switchQuoteCurrency(newQuote){
  if(!newQuote) return;
  currentQuoteCurrency=newQuote.toUpperCase();
  
  // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –æ–±–∞ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞, –µ—Å–ª–∏ —Å—Ç–∞—Ä—ã–π —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  const oldSel=document.querySelector('#quoteCurrency');
  if(oldSel && oldSel.value!==currentQuoteCurrency){
    oldSel.value=currentQuoteCurrency;
  }
  
  updatePairNameUI();
  logDbg(`switchQuoteCurrency -> ${currentBaseCurrency}_${currentQuoteCurrency}`);
  await subscribeToPairData(currentBaseCurrency,currentQuoteCurrency);
  await new Promise(resolve => setTimeout(resolve, 1000));
  await loadMarketData(true);  // force refresh
  await loadPairBalances();
  await loadPairParams(true);
  await loadBreakEvenTable();
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä –∫–æ—Ç–∏—Ä—É–µ–º–æ–π –≤–∞–ª—é—Ç—ã –≤ UI state
  await UIStateManager.savePartial({quoteCurrency: currentQuoteCurrency});
}
```

### 4. UIStateManager

**–î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–æ—Å—Ç–æ–π –º–µ–Ω–µ–¥–∂–µ—Ä** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º UI:

```javascript
const UIStateManager = {
  async savePartial(updates) {
    try {
      const stateUpdates = {};
      if (updates.baseCurrency) stateUpdates.active_base_currency = updates.baseCurrency;
      if (updates.quoteCurrency) stateUpdates.active_quote_currency = updates.quoteCurrency;
      if (updates.autoTradeEnabled !== undefined) stateUpdates.auto_trade_enabled = updates.autoTradeEnabled;
      if (updates.networkMode) stateUpdates.network_mode = updates.networkMode;
      
      const response = await fetch('/api/ui/state/partial', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(stateUpdates)
      });
      const result = await response.json();
      if (result.success) {
        logDbg('UI State: —á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ');
      }
      return result;
    } catch (error) {
      logDbg('UI State: –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ - ' + error);
      return {success: false, error: String(error)};
    }
  }
};
```

### 5. –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

**–ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –±–∞–∑–æ–≤–æ–π –≤–∞–ª—é—Ç—ã**:
```javascript
// –í —Ñ—É–Ω–∫—Ü–∏–∏ switchBaseCurrency()
await UIStateManager.savePartial({baseCurrency: currentBaseCurrency});
```

**–ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –∫–æ—Ç–∏—Ä—É–µ–º–æ–π –≤–∞–ª—é—Ç—ã**:
```javascript
// –í —Ñ—É–Ω–∫—Ü–∏–∏ switchQuoteCurrency()
await UIStateManager.savePartial({quoteCurrency: currentQuoteCurrency});
```

### 6. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

**–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è loadUIState()**:
```javascript
if (state.active_quote_currency) {
  currentQuoteCurrency = state.active_quote_currency;
  // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä –∫–æ—Ç–∏—Ä—É–µ–º–æ–π –≤–∞–ª—é—Ç—ã –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
  const quoteSel = document.querySelector('#quoteCurrencySelect');
  if (quoteSel) quoteSel.value = currentQuoteCurrency;
  logDbg('UI State: –∫–æ—Ç–∏—Ä–æ–≤–æ—á–Ω–∞—è –≤–∞–ª—é—Ç–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ - ' + currentQuoteCurrency);
}
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ï–¥–∏–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä** - –∫–æ—Ç–∏—Ä—É–µ–º–∞—è –≤–∞–ª—é—Ç–∞ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –≤—Å–µ—Ö –±–∞–∑–æ–≤—ã—Ö –≤–∞–ª—é—Ç
2. **–£–¥–æ–±–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ** - —Å–µ–ª–µ–∫—Ç–æ—Ä –≤—Å–µ–≥–¥–∞ –≤–∏–¥–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ —Å–µ–∫—Ü–∏–∏ —Å —Ä—ã–Ω–æ—á–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
3. **–¢–æ—á–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ** - —Ü–µ–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é 2 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
4. **–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** - –≤—ã–±–æ—Ä –∫–æ—Ç–∏—Ä—É–µ–º–æ–π –≤–∞–ª—é—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
5. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞:

1. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—Ç–∏—Ä—É–µ–º–æ–π –≤–∞–ª—é—Ç—ã**:
   - –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   - –í –∑–∞–≥–æ–ª–æ–≤–∫–µ "üìà –†—ã–Ω–æ–∫ –∏ —Å—Ç–∞–∫–∞–Ω" —Å–ø—Ä–∞–≤–∞ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–æ—Ç–∏—Ä—É–µ–º—É—é –≤–∞–ª—é—Ç—É (USDC, BTC, ETH)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
     - –ò–º–µ–Ω–∏ –ø–∞—Ä—ã (BTC_USDC –≤–º–µ—Å—Ç–æ BTC_USDT)
     - –¶–µ–Ω—ã –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ ($42,567.89)
     - –°—Ç–∞–∫–∞–Ω–∞ (—Ü–µ–Ω—ã –≤ –Ω–æ–≤–æ–π –∫–æ—Ç–∏—Ä—É–µ–º–æ–π –≤–∞–ª—é—Ç–µ)
     - –ë–∞–ª–∞–Ω—Å–æ–≤ (–±–∞–ª–∞–Ω—Å –∫–æ—Ç–∏—Ä—É–µ–º–æ–π –≤–∞–ª—é—Ç—ã)

2. **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã**:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ü–µ–Ω–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é 2 –∑–Ω–∞–∫–∞
   - –ü—Ä–∏–º–µ—Ä—ã: $42,567.89, $3.45, $0.06
   - –î–ª—è –±–æ–ª—å—à–∏—Ö —á–∏—Å–µ–ª –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ —Ç—ã—Å—è—á

3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è**:
   - –í—ã–±—Ä–∞—Ç—å –∫–æ—Ç–∏—Ä—É–µ–º—É—é –≤–∞–ª—é—Ç—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, BTC)
   - –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—ã–±–æ—Ä —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è

4. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –±–∞–∑–æ–≤—ã–º–∏ –≤–∞–ª—é—Ç–∞–º–∏**:
   - –í—ã–±—Ä–∞—Ç—å –∫–æ—Ç–∏—Ä—É–µ–º—É—é –≤–∞–ª—é—Ç—É BTC
   - –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –º–µ–∂–¥—É –≤–∞–ª—é—Ç–∞–º–∏ (WLD ‚Üí ETH ‚Üí SOL)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∫–æ—Ç–∏—Ä—É–µ–º–∞—è –≤–∞–ª—é—Ç–∞ –æ—Å—Ç–∞—ë—Ç—Å—è BTC –¥–ª—è –≤—Å–µ—Ö

5. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–∏–Ω–≥–æ–º**:
   - –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–∏–Ω–≥
   - –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∫–æ—Ç–∏—Ä—É–µ–º—É—é –≤–∞–ª—é—Ç—É
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–∏–Ω–≥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å–æ –≤—Å–µ–º–∏ –±–∞–∑–æ–≤—ã–º–∏ –≤–∞–ª—é—Ç–∞–º–∏
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å WebSocket
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ ui_state.json
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –∫–æ—Ç–∏—Ä—É–µ–º—ã—Ö –≤–∞–ª—é—Ç (USDT, USDC, BTC, ETH)

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

- `templates/index.html` - –¥–æ–±–∞–≤–ª–µ–Ω —Å–µ–ª–µ–∫—Ç–æ—Ä, —Ñ—É–Ω–∫—Ü–∏—è switchQuoteCurrency, UIStateManager, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–µ–Ω—ã
- `QUOTE_CURRENCY_UPDATE.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–µ–Ω—ã
3. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
4. üî≤ –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ–≤—å—é –∫–æ–¥–∞
5. üî≤ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–µ–ª–∏–∑–∞
6. üî≤ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
