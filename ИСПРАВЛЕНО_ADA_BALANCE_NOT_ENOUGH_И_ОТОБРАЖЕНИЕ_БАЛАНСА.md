# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: ADA –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç (BALANCE_NOT_ENOUGH) + –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞

## üêõ –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ1: BALANCE_NOT_ENOUGH –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ ADA

### –°–∏–º–ø—Ç–æ–º—ã:
- ADA –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç —Ç–æ—Ä–≥–æ–≤–ª—é
- –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç: `{"label":"BALANCE_NOT_ENOUGH","message":"Not enough balance"}`
- –ê–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä –≤–∏–¥–∏—Ç 226.5 ADA, –Ω–æ API Gate.io –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –æ—Ä–¥–µ—Ä

### –ü—Ä–∏—á–∏–Ω–∞:
1. **–ü—Ä–æ–¥–∞–∂–∞ 100% –±–∞–ª–∞–Ω—Å–∞** - –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä –ø—ã—Ç–∞–ª—Å—è –ø—Ä–æ–¥–∞—Ç—å –≤–µ—Å—å available balance
2. **–ö–æ–º–∏—Å—Å–∏–∏ –∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è** - Gate.io —Ç—Ä–µ–±—É–µ—Ç –Ω–µ–º–Ω–æ–≥–æ –º–µ–Ω—å—à–µ –∏–∑-–∑–∞ –∫–æ–º–∏—Å—Å–∏–π
3. **–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å** - —á–∞—Å—Ç—å –º–æ–≥–ª–∞ –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –≤ –æ—Ä–¥–µ—Ä–∞—Ö

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Ññ1: –£–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–¥–∞–∂–∏ –æ—Å—Ç–∞—Ç–∫–æ–≤

**–§–∞–π–ª:** `autotrader_v2.py`  
**–ú–µ—Ç–æ–¥:** `_try_sell_idle_balance()`

### –ò–∑–º–µ–Ω–µ–Ω–∏—è:

#### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ locked –±–∞–ª–∞–Ω—Å–∞:
```python
available_balance = float(balance_info.get('available', 0))
locked_balance = float(balance_info.get('locked', 0))
total_balance = available_balance + locked_balance

print(f"[{base}] üí∞ –î–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å: {available_balance:.8f} {base}")
print(f"[{base}] üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å: {locked_balance:.8f} {base}")
print(f"[{base}] üìä –û–±—â–∏–π –±–∞–ª–∞–Ω—Å: {total_balance:.8f} {base}")
```

#### 2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–º–µ–Ω–∞ –æ—Ä–¥–µ—Ä–æ–≤ –ø—Ä–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –±–∞–ª–∞–Ω—Å–µ:
```python
if available_balance <= 0:
    if locked_balance > 0:
        print(f"[{base}] ‚ö†Ô∏è –ë–∞–ª–∞–Ω—Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –≤ –æ—Ä–¥–µ—Ä–∞—Ö ({locked_balance:.8f} {base})")
        print(f"[{base}] üîÑ –û—Ç–º–µ–Ω—è–µ–º –≤—Å–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –æ—Ä–¥–µ—Ä–∞...")
        try:
            api_client.cancel_all_open_orders(pair)
            print(f"[{base}] ‚úÖ –û—Ä–¥–µ—Ä–∞ –æ—Ç–º–µ–Ω–µ–Ω—ã, –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π –ø—Ä–æ–≤–µ—Ä–∫–µ")
        except Exception as e:
            print(f"[{base}] ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–º–µ–Ω–∏—Ç—å –æ—Ä–¥–µ—Ä–∞: {e}")
    else:
        print(f"[{base}] ‚úÖ –ë–∞–ª–∞–Ω—Å = 0, –æ—Å—Ç–∞—Ç–∫–æ–≤ –Ω–µ—Ç")
    return
```

#### 3. –ü—Ä–æ–¥–∞–∂–∞ 99.9% –≤–º–µ—Å—Ç–æ 100%:
```python
# –ò—Å–ø–æ–ª—å–∑—É–µ–º 99.9% –æ—Ç available –¥–ª—è —É—á—ë—Ç–∞ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∫–æ–º–∏—Å—Å–∏–π –∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–π
sell_amount = available_balance * 0.999
sell_amount_rounded = round(sell_amount, amount_precision)
total_value = sell_amount_rounded * orderbook_price

print(f"[{base}] üîÑ [DEBUG] available={available_balance:.8f}, sell_amount={sell_amount:.8f} (99.9%)")
print(f"[{base}] üîÑ [DEBUG] rounded={sell_amount_rounded}, total_value={total_value:.2f}")
```

---

## üêõ –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ2: –ù–µ –≤–∏–¥–Ω–æ –±–∞–ª–∞–Ω—Å–∞ –≤–∞–ª—é—Ç—ã –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

### –°–∏–º–ø—Ç–æ–º—ã:
- "–û–±—ä—ë–º –±–∞–∑—ã" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `-` –∏–ª–∏ —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- –ù–µ –≤–∏–¥–Ω–æ —Ä–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –∏–∑ Gate.io API
- –ù–µ –≤–∏–¥–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Ññ2: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞

### Backend (mTrade.py)

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `/api/trade/indicators`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```python
# –î–æ–±–∞–≤–ª—è–µ–º –†–ï–ê–õ–¨–ù–´–ô –±–∞–ª–∞–Ω—Å –≤–∞–ª—é—Ç—ã –∏–∑ API Gate.io
try:
    if account_manager.active_account:
        acc = account_manager.get_account(account_manager.active_account)
        api_client_temp = GateAPIClient(acc['api_key'], acc['api_secret'], CURRENT_NETWORK_MODE)
        all_balances = api_client_temp.get_account_balance()
        balance_info = next((b for b in all_balances if b.get('currency') == base_currency), None)
        
        if balance_info:
            available_balance = float(balance_info.get('available', 0))
            locked_balance = float(balance_info.get('locked', 0))
            autotrade_levels['real_balance'] = {
                'available': available_balance,
                'locked': locked_balance,
                'total': available_balance + locked_balance
            }
except Exception as e:
    print(f"[ERROR] –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –¥–ª—è {base_currency}: {e}")
    autotrade_levels['real_balance'] = None
```

### Frontend (static/app.js)

**–§—É–Ω–∫—Ü–∏—è:** –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤

**–ò–∑–º–µ–Ω–µ–Ω–æ:**
```javascript
// –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—ä—ë–º –±–∞–∑–æ–≤–æ–π –≤–∞–ª—é—Ç—ã
const volumeEl = $('autotradeBaseVolume');
if(volumeEl){
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å (–µ—Å–ª–∏ –µ—Å—Ç—å) –∏–ª–∏ base_volume –∏–∑ —Ü–∏–∫–ª–∞
    if (levels.real_balance && levels.real_balance.total !== undefined) {
        const total = levels.real_balance.total;
        const available = levels.real_balance.available;
        const locked = levels.real_balance.locked;
        
        if (locked > 0) {
            volumeEl.innerHTML = `${total.toFixed(8)}<br><small style="color: #999;">(${available.toFixed(8)} + <span style="color: #ff9800;">${locked.toFixed(8)} üîí</span>)</small>`;
        } else {
            volumeEl.textContent = total.toFixed(8);
        }
    } else if (levels.base_volume !== null) {
        volumeEl.textContent = levels.base_volume.toFixed(8);
    } else {
        volumeEl.textContent = '-';
    }
}
```

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ1 —Ä–µ—à–µ–Ω–∞:
1. **–ü—Ä–æ–¥–∞–∂–∞ 99.9%** - –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–ø–∞—Å –¥–ª—è –∫–æ–º–∏—Å—Å–∏–π
2. **–û—Ç–º–µ–Ω–∞ –æ—Ä–¥–µ—Ä–æ–≤** - –µ—Å–ª–∏ –±–∞–ª–∞–Ω—Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
3. **–î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏** - –≤–∏–¥–Ω–æ available/locked/total –±–∞–ª–∞–Ω—Å—ã

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ2 —Ä–µ—à–µ–Ω–∞:
1. **–†–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å** - –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –∏–∑ API
2. **–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ —Å üîí –∏–∫–æ–Ω–∫–æ–π
3. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** - –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ

---

## üéØ –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞

### –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å –ù–ï –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω:
```
–û–±—ä—ë–º –±–∞–∑—ã: 226.49591000
```

### –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω:
```
–û–±—ä—ë–º –±–∞–∑—ã: 226.49591000
            (200.00000000 + 26.49591000 üîí)
            ‚Üë available    ‚Üë locked
```

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:
```powershell
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ (Ctrl+C)
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞:
python mTrade.py
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ ADA:
```
[ADA] üí∞ –î–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å: 226.49591000 ADA
[ADA] üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å: 0.00000000 ADA
[ADA] üìä –û–±—â–∏–π –±–∞–ª–∞–Ω—Å: 226.49591000 ADA
[ADA] üîÑ [DEBUG] available=226.49591000, sell_amount=226.27264409 (99.9%)
[ADA] üîÑ [DEBUG] rounded=226.27, total_value=82.14
[DEBUG] create_spot_order: –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ API...
[DEBUG] _request: HTTP 201 –¥–ª—è POST /spot/orders
[SUCCESS] create_spot_order: –û—Ä–¥–µ—Ä —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ, ID=xxxxx
[ADA] ‚úÖ –û—Ä–¥–µ—Ä —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ: xxxxx
[ADA] ‚úÖ –¶–∏–∫–ª —Å–±—Ä–æ—à–µ–Ω –ø–æ—Å–ª–µ –ø—Ä–æ–¥–∞–∂–∏ –æ—Å—Ç–∞—Ç–∫–æ–≤
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
- –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:5000
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É ADA
- "–û–±—ä—ë–º –±–∞–∑—ã" –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
- –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω - –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω —Å üîí

---

## üìÅ –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ú–µ—Ç–æ–¥/–§—É–Ω–∫—Ü–∏—è | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|---------------|-----------|
| `autotrader_v2.py` | `_try_sell_idle_balance()` | –ü—Ä–æ–¥–∞–∂–∞ 99.9%, –ª–æ–≥–∏ locked –±–∞–ª–∞–Ω—Å–∞, –æ—Ç–º–µ–Ω–∞ –æ—Ä–¥–µ—Ä–æ–≤ |
| `mTrade.py` | `/api/trade/indicators` | –î–æ–±–∞–≤–ª–µ–Ω real_balance –≤ –æ—Ç–≤–µ—Ç |
| `static/app.js` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ | –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ real_balance –≤ UI |

---

## üéâ –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

**‚úÖ –í–°–Å –ò–°–ü–†–ê–í–õ–ï–ù–û:**
1. ADA —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–¥–∞—ë—Ç –æ—Å—Ç–∞—Ç–∫–∏ (99.9% –≤–º–µ—Å—Ç–æ 100%)
2. –û—Ç–º–µ–Ω—è—é—Ç—Å—è –æ—Ä–¥–µ—Ä–∞ –ø—Ä–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –±–∞–ª–∞–Ω—Å–µ
3. –†–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω–æ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
4. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è available + locked –±–∞–ª–∞–Ω—Å—ã

**üöÄ –î–µ–π—Å—Ç–≤–∏–µ:** –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ ADA!

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 2025-12-18  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û  
**–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:** ‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
