# –§–ò–ù–ê–õ–¨–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï P0 (start_price) - 19 –Ω–æ—è–±—Ä—è 2025

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –ø–æ–∫—É–ø–∫–µ P0 (start_price) –≤ —Ç–∞–±–ª–∏—Ü–µ –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏ **–Ω–µ –æ–±–Ω–æ–≤–ª—è–ª—Å—è** –Ω–∞ —Ü–µ–Ω—É –ø–æ–∫—É–ø–∫–∏ –∏ –æ—Å—Ç–∞–≤–∞–ª—Å—è —Å—Ç–∞—Ä—ã–º –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º.

### –ü—Ä–∏–º–µ—Ä –∏–∑ –ª–æ–≥–æ–≤:
```
[AutoTrader][BTC] üìä –û–±–Ω–æ–≤–ª—ë–Ω start_price –≤ state_manager: 97458.83000000 (save_result=True)
[AutoTrader][BTC] üìä –¢–∞–±–ª–∏—Ü–∞ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω–∞ —Å –Ω–æ–≤—ã–º P0: 97458.83000000
[AutoTrader][BTC] üîç DEBUG: P0 –≤ —Ç–∞–±–ª–∏—Ü–µ (row 0): 97458.83000000
```

–ù–æ –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ P0 –æ—Å—Ç–∞–≤–∞–ª—Å—è —Ä–∞–≤–Ω—ã–º 2980 (—Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ).

---

## üîç –ü—Ä–∏—á–∏–Ω–∞

–í –º–µ—Ç–æ–¥–µ `_recalc_table_if_needed()` (autotrader.py, —Å—Ç—Ä–æ–∫–∞ 219-230) —Ç–∞–±–ª–∏—Ü–∞ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–ª–∞—Å—å —Å **—Ç–µ–∫—É—â–µ–π —Ä—ã–Ω–æ—á–Ω–æ–π —Ü–µ–Ω–æ–π** (`current_price`), –∞ –Ω–µ —Å **–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º start_price** –∏–∑ `state_manager`:

```python
# –ë–´–õ–û (–Ω–µ–≤–µ—Ä–Ω–æ):
table = calculate_breakeven_table(params, current_price)
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–ª–æ, —á—Ç–æ –¥–∞–∂–µ –µ—Å–ª–∏ –º—ã —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ `start_price` –≤ `state_manager`, —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ—Å—á—ë—Ç–µ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª–∞ –µ–≥–æ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É —Ä—ã–Ω–∫–∞.

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### 1. –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π start_price –ø—Ä–∏ –ø–µ—Ä–µ—Å—á—ë—Ç–µ —Ç–∞–±–ª–∏—Ü—ã

**–§–∞–π–ª:** `autotrader.py`, –º–µ—Ç–æ–¥ `_recalc_table_if_needed()`

```python
# –°–¢–ê–õ–û (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
saved_start_price = params.get('start_price', 0)
price_for_table = saved_start_price if saved_start_price > 0 else current_price
table = calculate_breakeven_table(params, price_for_table)
```

**–õ–æ–≥–∏–∫–∞:**
- –ï—Å–ª–∏ `start_price` —É–∂–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω (–µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π —Ü–∏–∫–ª), –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã
- –ï—Å–ª–∏ `start_price = 0` (–Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞), –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é —Ä—ã–Ω–æ—á–Ω—É—é —Ü–µ–Ω—É –¥–ª—è –ø—Ä–µ–≤—å—é

---

### 2. –û–±–Ω—É–ª—è–µ–º start_price –ø—Ä–∏ —Å–±—Ä–æ—Å–µ —Ü–∏–∫–ª–∞

**–§–∞–π–ª:** `autotrader.py`, –º–µ—Ç–æ–¥ `_try_sell()`

```python
# –î–æ–±–∞–≤–ª–µ–Ω–æ:
current_params = self.state_manager.get_breakeven_params(base)
current_params['start_price'] = 0.0
self.state_manager.set_breakeven_params(base, current_params)
```

**–õ–æ–≥–∏–∫–∞:**
- –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ü–∏–∫–ª–∞ (–ø—Ä–æ–¥–∞–∂–∞) `start_price` –æ–±–Ω—É–ª—è–µ—Ç—Å—è –≤ `state_manager`
- –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º —Ü–∏–∫–ª–µ P0 —Å–Ω–æ–≤–∞ –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Ü–µ–Ω–µ –Ω–æ–≤–æ–π –ø–æ–∫—É–ø–∫–∏

---

## üìä –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –ø–æ–∫—É–ø–∫–µ `start_price` —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è –≤ `state_manager`
2. –ù–æ –ø—Ä–∏ –ø–µ—Ä–µ—Å—á—ë—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `current_price` –≤–º–µ—Å—Ç–æ `start_price`
3. P0 –≤ —Ç–∞–±–ª–∏—Ü–µ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–ª —Å —Ü–µ–Ω–æ–π –ø–æ–∫—É–ø–∫–∏

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –ø–æ–∫—É–ø–∫–µ `start_price` —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
2. –ü—Ä–∏ –ø–µ—Ä–µ—Å—á—ë—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `start_price`
3. P0 –≤ —Ç–∞–±–ª–∏—Ü–µ **–≤—Å–µ–≥–¥–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç** —Å —Ü–µ–Ω–æ–π –ø–µ—Ä–≤–æ–π –ø–æ–∫—É–ø–∫–∏
4. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ü–∏–∫–ª–∞ `start_price` –æ–±–Ω—É–ª—è–µ—Ç—Å—è –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç
–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç:
```powershell
python test_p0_fix_final.py
```

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
1. P0 (start_price) –≤ `app_state.json`
2. P0 –≤ —Ç–∞–±–ª–∏—Ü–µ –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ API
3. –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ P0 –º–µ–∂–¥—É state_manager –∏ —Ç–∞–±–ª–∏—Ü–µ–π
4. P0 –≤ `autotrader_cycles_state.json`

### –†—É—á–Ω–æ–π —Ç–µ—Å—Ç
1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä: `python mTrade.py`
2. –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä
3. –î–æ–∂–¥–∞—Ç—å—Å—è —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –ø–æ–∫—É–ø–∫–∏
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ UI, —á—Ç–æ P0 (row 0, rate) = —Ü–µ–Ω–µ –ø–æ–∫—É–ø–∫–∏
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ª–æ–≥–∞—Ö:
   ```
   [AutoTrader][BTC] üìä –¢–∞–±–ª–∏—Ü–∞ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ —Å P0=97458.83 (saved_start_price=97458.83, current=97500.00)
   ```

---

## üìù –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **autotrader.py**
   - –ú–µ—Ç–æ–¥ `_recalc_table_if_needed()`: –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π start_price
   - –ú–µ—Ç–æ–¥ `_try_sell()`: –æ–±–Ω—É–ª—è–µ–º start_price –ø—Ä–∏ —Å–±—Ä–æ—Å–µ —Ü–∏–∫–ª–∞
   - –î–æ–±–∞–≤–ª–µ–Ω—ã debug-–≤—ã–≤–æ–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

2. **test_p0_fix_final.py** (–Ω–æ–≤—ã–π)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ P0

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ P0 –≤ —Ç–∞–±–ª–∏—Ü–µ –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏ **–≤—Å–µ–≥–¥–∞** —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ü–µ–Ω–æ–π —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –ø–æ–∫—É–ø–∫–∏  
‚úÖ P0 –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Å—á—ë—Ç–µ —Ç–∞–±–ª–∏—Ü—ã (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ)  
‚úÖ P0 –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±–Ω—É–ª—è–µ—Ç—Å—è –ø—Ä–∏ —Å–±—Ä–æ—Å–µ —Ü–∏–∫–ª–∞  
‚úÖ –ê–ª–≥–æ—Ä–∏—Ç–º breakeven —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üìÖ –î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
19 –Ω–æ—è–±—Ä—è 2025

## üë§ –ê–≤—Ç–æ—Ä
GitHub Copilot + –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
