# ‚úÖ CYCLE ID FIX - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Ü–∏–∫–ª–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞

**–î–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:**
- –û–±—ä–µ–∫—Ç `TradingCycle` –±—ã–ª **–æ–¥–∏–Ω** –Ω–∞ –≤–∞–ª—é—Ç—É –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è
- –ü–æ—Å–ª–µ –ø—Ä–æ–¥–∞–∂–∏ –∏ –Ω–æ–≤–æ–π –ø–æ–∫—É–ø–∫–∏ **–ø—Ä–æ–¥–æ–ª–∂–∞–ª—Å—è —Å—Ç–∞—Ä—ã–π —Ü–∏–∫–ª**
- –ù–µ –±—ã–ª–æ —Å–ø–æ—Å–æ–±–∞ –æ—Ç–ª–∏—á–∏—Ç—å —Ä–∞–∑–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—ã–µ —Ü–∏–∫–ª—ã –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
- –ù–µ –±—ã–ª–æ —Å—á—ë—Ç—á–∏–∫–∞ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –±—ã–ª–æ –ø–æ–Ω—è—Ç—å, —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –º–æ–Ω–µ—Ç–∞ —Ç–æ—Ä–≥–æ–≤–∞–ª–∞—Å—å
- –ü–æ—Å–ª–µ –ø—Ä–æ–¥–∞–∂–∏ –∏ –Ω–æ–≤–æ–π –ø–æ–∫—É–ø–∫–∏ —Å–∏—Å—Ç–µ–º–∞ —Å—á–∏—Ç–∞–ª–∞ —ç—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º —Å—Ç–∞—Ä–æ–≥–æ —Ü–∏–∫–ª–∞
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤

## –†–µ—à–µ–Ω–∏–µ

### 1. –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ `TradingCycle`

```python
@dataclass
class TradingCycle:
    cycle_id: int = 0              # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ç–µ–∫—É—â–µ–≥–æ —Ü–∏–∫–ª–∞
    total_cycles_count: int = 0    # –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
```

### 2. –û–±–Ω–æ–≤–ª—ë–Ω –º–µ—Ç–æ–¥ `activate()`

**–ö–ê–ñ–î–ê–Ø –∞–∫—Ç–∏–≤–∞—Ü–∏—è = –ù–û–í–´–ô —Ü–∏–∫–ª —Å –ù–û–í–´–ú ID**

```python
def activate(self, start_price: float, base_volume: float, invested_usd: float):
    """–ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ü–∏–∫–ª–∞ –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –ø–æ–∫—É–ø–∫–∏
    
    –í–ê–ñ–ù–û: –ö–∞–∂–¥–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è = –ù–û–í–´–ô —Ü–∏–∫–ª —Å –ù–û–í–´–ú ID
    """
    # –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ–º ID —Ü–∏–∫–ª–∞ (–∫–∞–∂–¥–∞—è —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞ = –Ω–æ–≤—ã–π —Ü–∏–∫–ª!)
    self.cycle_id += 1
    
    # ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ ...
    
    print(f"[CYCLE] ‚ú® –ù–æ–≤—ã–π —Ü–∏–∫–ª #{self.cycle_id} –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!")
```

### 3. –û–±–Ω–æ–≤–ª—ë–Ω –º–µ—Ç–æ–¥ `reset()`

**–ü—Ä–∏ —Å–±—Ä–æ—Å–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è —Å—á—ë—Ç—á–∏–∫ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤**

```python
def reset(self, manual: bool = False):
    """–°–±—Ä–æ—Å —Ü–∏–∫–ª–∞ –≤ IDLE"""
    
    # –ï—Å–ª–∏ —Ü–∏–∫–ª –±—ã–ª –∞–∫—Ç–∏–≤–µ–Ω - —Å—á–∏—Ç–∞–µ–º –µ–≥–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–º
    if self.state == CycleState.ACTIVE:
        self.total_cycles_count += 1
        print(f"[CYCLE] ‚úÖ –¶–∏–∫–ª #{self.cycle_id} –∑–∞–≤–µ—Ä—à—ë–Ω! –í—Å–µ–≥–æ —Ü–∏–∫–ª–æ–≤: {self.total_cycles_count}")
    
    # ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ ...
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

**–§–∞–π–ª `autotrader_cycles_state.json` —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç:**
```json
{
  "ETH": {
    "cycle_id": 5,
    "total_cycles_count": 4,
    "active": true,
    ...
  }
}
```

### 5. –û–±–Ω–æ–≤–ª—ë–Ω API –º–µ—Ç–æ–¥ `get_cycle_info()`

**–¢–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ü–∏–∫–ª–∞—Ö:**
```python
{
    'cycle_id': 5,              # ID —Ç–µ–∫—É—â–µ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
    'total_cycles_count': 4,    # –°–∫–æ–ª—å–∫–æ —Ü–∏–∫–ª–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
    'state': 'active',
    ...
}
```

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
```
1. cycle_id = 0, total_cycles_count = 0, state = IDLE
2. –°—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞ ‚Üí activate()
3. cycle_id = 1, total_cycles_count = 0, state = ACTIVE
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—Ä–æ–¥–∞–∂–∞ –∏ –Ω–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞
```
1. cycle_id = 1, total_cycles_count = 0, state = ACTIVE
2. –ü—Ä–æ–¥–∞–∂–∞ ‚Üí reset()
3. cycle_id = 1, total_cycles_count = 1, state = IDLE
4. –ù–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞ ‚Üí activate()
5. cycle_id = 2, total_cycles_count = 1, state = ACTIVE  ‚úÖ –ù–û–í–´–ô –¶–ò–ö–õ!
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ù–µ—Å–∫–æ–ª—å–∫–æ —Ü–∏–∫–ª–æ–≤
```
–¶–∏–∫–ª 1: –ü–æ–∫—É–ø–∫–∞ ‚Üí –ü—Ä–æ–¥–∞–∂–∞
  - cycle_id: 1
  - –ü–æ—Å–ª–µ –ø—Ä–æ–¥–∞–∂–∏: total_cycles_count = 1

–¶–∏–∫–ª 2: –ü–æ–∫—É–ø–∫–∞ ‚Üí –ü—Ä–æ–¥–∞–∂–∞
  - cycle_id: 2
  - –ü–æ—Å–ª–µ –ø—Ä–æ–¥–∞–∂–∏: total_cycles_count = 2

–¶–∏–∫–ª 3: –ü–æ–∫—É–ø–∫–∞ (–∞–∫—Ç–∏–≤–Ω—ã–π)
  - cycle_id: 3
  - total_cycles_count = 2
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç `test_cycle_logic.py`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
- ‚úÖ –ö–∞–∂–¥–∞—è `activate()` —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç `cycle_id`
- ‚úÖ –ö–∞–∂–¥–∞—è `reset()` –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç `total_cycles_count`
- ‚úÖ –ü–æ—Å–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ü–∏–∫–ª–æ–≤ —Å—á—ë—Ç—á–∏–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

## –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

1. **–ö–∞–∂–¥–∞—è —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞ —Ç–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞—ë—Ç –ù–û–í–´–ô —Ü–∏–∫–ª** —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º ID
2. **–°–∏—Å—Ç–µ–º–∞ —Å—á–∏—Ç–∞–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã** (`total_cycles_count`)
3. **–ú–æ–∂–Ω–æ –æ—Ç–ª–∏—á–∏—Ç—å —Ä–∞–∑–Ω—ã–µ —Ç–æ—Ä–≥–æ–≤—ã–µ —Å–µ—Å—Å–∏–∏** –ø–æ `cycle_id`
4. **–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–∞:

- `cycle_id` - –∫–∞–∫–æ–π –ø–æ —Å—á—ë—Ç—É —Ü–∏–∫–ª —Å–µ–π—á–∞—Å –∞–∫—Ç–∏–≤–µ–Ω
- `total_cycles_count` - —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —É–∂–µ —Ç–æ—Ä–≥–æ–≤–∞–ª–∏ —ç—Ç–æ–π –º–æ–Ω–µ—Ç–æ–π
- –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Ü–∏–∫–ª–∞–º–∏:
  ```
  [CYCLE] ‚ú® –ù–æ–≤—ã–π —Ü–∏–∫–ª #3 –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!
  [CYCLE] ‚úÖ –¶–∏–∫–ª #3 –∑–∞–≤–µ—Ä—à—ë–Ω! –í—Å–µ–≥–æ —Ü–∏–∫–ª–æ–≤: 3
  ```

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ –°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑—è—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (cycle_id –∏ total_cycles_count –±—É–¥—É—Ç = 0)
- ‚úÖ API –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º (–Ω–æ–≤—ã–µ –ø–æ–ª—è –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã)
- ‚úÖ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –Ω–µ –∏–∑–º–µ–Ω–µ–Ω–∞, —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—á—ë—Ç—á–∏–∫–∏

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:

- `autotrader_v2.py` - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
- `test_cycle_logic.py` - —Ç–µ—Å—Ç—ã (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

---

**–î–∞—Ç–∞:** 2024-12-07  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û –ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û
