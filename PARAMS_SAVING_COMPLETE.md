# ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏

## –î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
16 –Ω–æ—è–±—Ä—è 2025

## –ü—Ä–æ–±–ª–µ–º–∞
–ù–µ –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–∞–±–ª–∏—Ü—ã –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –í —á–∞—Å—Ç–Ω–æ—Å—Ç–∏, –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `rk` (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —à–∞–≥–∞) –∏ `keep` (–æ—Å—Ç–∞—Ç–æ–∫ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ) –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –∏ –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª–∏—Å—å.

## –†–µ—à–µ–Ω–∏–µ

### 1. –û–±–Ω–æ–≤–ª—ë–Ω —Å–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ–º—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ `mTrade.py`
–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `rk` –∏ `keep` –≤ —Ñ—É–Ω–∫—Ü–∏—é `save_trade_params()`:

```python
for k, caster in (
    ('steps', int), ('start_volume', float), ('start_price', float),
    ('pprof', float), ('kprof', float), ('target_r', float), ('rk', float),  # ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
    ('geom_multiplier', float), ('rebuy_mode', str), ('keep', float), ('orderbook_level', float)  # ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
):
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ `state_manager.py`
–î–æ–±–∞–≤–ª–µ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:

```python
def _get_default_breakeven_params(self) -> Dict[str, Any]:
    return {
        'steps': 16,
        'start_volume': 3.0,
        'start_price': 0.0,
        'pprof': 0.6,
        'kprof': 0.02,
        'target_r': 3.65,
        'rk': 0.0,  # ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
        'geom_multiplier': 2.0,
        'rebuy_mode': 'geometric',
        'keep': 0.0,  # ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
        'orderbook_level': 1.0
    }
```

### 3. –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
‚úÖ JavaScript —É–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –≤–∫–ª—é—á–∞—è `rk` –∏ `keep`
‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∞–ª—é—Ç—ã –æ—Ç–¥–µ–ª—å–Ω–æ (per-currency)
‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∞–ª—é—Ç
‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```
Frontend (app.js)
    ‚Üì saveTradeParams()
Backend API (/api/trade/params)
    ‚Üì save_trade_params()
StateManager (state_manager.py)
    ‚Üì set_breakeven_params(currency, params)
app_state.json (—Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ `app_state.json`
```json
{
  "breakeven_params": {
    "BTC": {
      "steps": 16,
      "start_volume": 3.0,
      "target_r": 3.65,
      "rk": 0.1,
      "keep": 0.0,
      ...
    },
    "ETH": {
      "steps": 12,
      "start_volume": 5.0,
      ...
    }
  }
}
```

## –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ–º—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|--------------|----------|
| `steps` | int | 16 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ |
| `start_volume` | float | 3.0 | –°—Ç–∞—Ä—Ç–æ–≤—ã–π –æ–±—ä—ë–º –∑–∞–∫—É–ø–∫–∏ ($) |
| `start_price` | float | 0.0 | –°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ü–µ–Ω–∞ (0 = —Ç–µ–∫—É—â–∞—è) |
| `pprof` | float | 0.6 | –ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ—Ñ–∏—Ç–∞ (%) |
| `kprof` | float | 0.02 | –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —É–º–µ–Ω—å—à–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏—Ç–∞ |
| `target_r` | float | 3.65 | R - –±–∞–∑–æ–≤—ã–π —à–∞–≥ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ (%) |
| `rk` | float | 0.0 | Rk - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —à–∞–≥–∞ (%) |
| `geom_multiplier` | float | 2.0 | –ú–Ω–æ–∂–∏—Ç–µ–ª—å –≥–µ–æ–º–µ—Ç—Ä–∏–∏ |
| `rebuy_mode` | str | 'geometric' | –†–µ–∂–∏–º –¥–æ–∫—É–ø–æ–∫ |
| `keep` | float | 0.0 | –û—Å—Ç–∞—Ç–æ–∫ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ ($) |
| `orderbook_level` | float | 1.0 | –£—Ä–æ–≤–µ–Ω—å —Å—Ç–∞–∫–∞–Ω–∞ |

## –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∞–ª—é—Ç
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è —Å BTC –Ω–∞ ETH
2. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `loadTradeParams()` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `base_currency=ETH`
3. –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è ETH –∏–∑ `app_state.json`
4. –¢–∞–±–ª–∏—Ü–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –¥–ª—è ETH

### 2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω—è–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, R = 4.0, Rk = 0.2)
2. –ù–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
3. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `saveTradeParams()`
4. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–ª—è —Ç–µ–∫—É—â–µ–π –≤–∞–ª—é—Ç—ã –≤ `app_state.json`
5. –°—Ç–∞—Ç—É—Å: "‚úì –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ"

### 3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
2. –ü—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `loadTradeParams()`
3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∞–ª—é—Ç—ã
4. –¢–∞–±–ª–∏—Ü–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
1. –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
2. StateManager –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `app_state.json`
3. –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –≤—Å–µ—Ö –≤–∞–ª—é—Ç –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–≤–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

## –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. ‚úÖ `mTrade.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã `rk` –∏ `keep` –≤ —Å–ø–∏—Å–æ–∫ —Å–æ—Ö—Ä–∞–Ω—è–µ–º—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
2. ‚úÖ `state_manager.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è `rk` –∏ `keep`

## –ü—Ä–æ–≤–µ—Ä–∫–∞

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:
```python
# Python
from state_manager import StateManager
sm = StateManager()

# –ü–æ–ª—É—á–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è BTC
params_btc = sm.get_breakeven_params('BTC')
print(params_btc)

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è ETH
params_eth = {'steps': 20, 'rk': 0.15, 'keep': 10.0, ...}
sm.set_breakeven_params('ETH', params_eth)
```

### JavaScript:
```javascript
// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
await saveTradeParams();

// –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
await loadTradeParams();
```

## –°—Ç–∞—Ç—É—Å
**‚úÖ –í–°–ï –ü–ê–†–ê–ú–ï–¢–†–´ –°–û–•–†–ê–ù–Ø–Æ–¢–°–Ø –ò –í–û–°–°–¢–ê–ù–ê–í–õ–ò–í–ê–Æ–¢–°–Ø**

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è:
- ‚úÖ –î–ª—è –∫–∞–∂–¥–æ–π –≤–∞–ª—é—Ç—ã –æ—Ç–¥–µ–ª—å–Ω–æ
- ‚úÖ –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ `app_state.json`
- ‚úÖ –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∞–ª—é—Ç
- ‚úÖ –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞

---
–î–∞—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: 16 –Ω–æ—è–±—Ä—è 2025
