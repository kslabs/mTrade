# ‚úÖ –§–ò–ù–ê–õ–¨–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï - –î–û–°–¢–£–ü –ö LOCKS

## üéØ –ü–†–û–ë–õ–ï–ú–ê

–í —Ñ—É–Ω–∫—Ü–∏–∏ `_try_sell_idle_balance` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–ª–æ–≤–∞—Ä—é –∑–∞–º–∫–æ–≤**:

```python
# ‚ùå –ë–´–õ–û (–ù–ï –†–ê–ë–û–¢–ê–õ–û):
with self.locks[base]:
    ...
```

**–û—à–∏–±–∫–∞:** –í –∫–ª–∞—Å—Å–µ `AutoTraderV2` —Å–ª–æ–≤–∞—Ä—å –∑–∞–º–∫–æ–≤ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `_locks` (—Å –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ–º), –∞ –Ω–µ `locks`.

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï

–ó–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `_get_lock()`:

```python
# ‚úÖ –°–¢–ê–õ–û (–†–ê–ë–û–¢–ê–ï–¢):
lock = self._get_lock(base)
with lock:
    if base in self.cycles:
        self.cycles[base].reset(manual=False)
        self._save_state(base)
        print(f"[{base}] ‚úÖ –¶–∏–∫–ª —Å–±—Ä–æ—à–µ–Ω")
```

**–ú–µ—Ç–æ–¥ `_get_lock(base)`:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç lock –¥–ª—è –≤–∞–ª—é—Ç—ã, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç `threading.Lock`
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

---

## üìä –ö–û–õ–ò–ß–ï–°–¢–í–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

| –ú–µ—Å—Ç–æ | –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | –°—Ç—Ä–æ–∫–∞ |
|-------|----------------|--------|
| –°–±—Ä–æ—Å –ø—Ä–∏ –º–∞–ª–æ–º –æ–±—ä—ë–º–µ (base) | `self.locks[base]` ‚Üí `self._get_lock(base)` | ~1177 |
| –°–±—Ä–æ—Å –ø—Ä–∏ –º–∞–ª–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (quote) | `self.locks[base]` ‚Üí `self._get_lock(base)` | ~1189 |
| –°–±—Ä–æ—Å –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–¥–∞–∂–∏ | `self.locks[base]` ‚Üí `self._get_lock(base)` | ~1209 |
| –°–±—Ä–æ—Å –ø–æ—Å–ª–µ –Ω–µ—É–¥–∞—á–Ω–æ–π –ø—Ä–æ–¥–∞–∂–∏ | `self.locks[base]` ‚Üí `self._get_lock(base)` | ~1218 |
| –°–±—Ä–æ—Å –ø—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–∏ | `self.locks[base]` ‚Üí `self._get_lock(base)` | ~1228 |

**–ò–¢–û–ì–û:** 5 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

---

## üîç –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### 1. –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞

```python
with lock:
    if base in self.cycles:
        self.cycles[base].reset(manual=False)
        self._save_state(base)  # ‚Üê –í–ê–ñ–ù–û!
        print(f"[{base}] ‚úÖ –¶–∏–∫–ª —Å–±—Ä–æ—à–µ–Ω")
```

**–ó–∞—á–µ–º:** –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–±—Ä–æ—à–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ —Ñ–∞–π–ª `autotrader_cycles_state.json`, —á—Ç–æ–±—ã –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±—ã–ª–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º.

### 2. –î–æ–±–∞–≤–ª–µ–Ω traceback –ø—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–∏

```python
except Exception as e:
    print(f"[{base}] ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ–ø—Ä–æ–¥–∞–∂–µ –æ—Å—Ç–∞—Ç–∫–æ–≤: {e}")
    traceback.print_exc()  # ‚Üê –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ
    ...
```

**–ó–∞—á–µ–º:** –ü–æ–º–æ–≥–∞–µ—Ç –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ –ø—Ä–∏—á–∏–Ω—É –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ.

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê

### –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
```bash
get_errors("autotrader_v2.py")
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ **No errors found**

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ `_get_lock(base)`
- ‚úÖ Lock —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞
- ‚úÖ –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–æ–±–ª—é–¥–µ–Ω–∞

---

## üöÄ –ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢ –¢–ï–ü–ï–†–¨

### –ê–ª–≥–æ—Ä–∏—Ç–º —Å–±—Ä–æ—Å–∞ —Ü–∏–∫–ª–∞:

```
1. –ë–æ—Ç –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Å–±—Ä–æ—Å–∞ —Ü–∏–∫–ª–∞
   ‚Üì
2. –ü–æ–ª—É—á–∞–µ—Ç lock —á–µ—Ä–µ–∑ self._get_lock(base)
   ‚Üì
3. –ü–æ–¥ lock –≤—ã–ø–æ–ª–Ω—è–µ—Ç:
   - –°–±—Ä–æ—Å —Ü–∏–∫–ª–∞: self.cycles[base].reset(manual=False)
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è: self._save_state(base)
   ‚Üì
4. –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç: "‚úÖ –¶–∏–∫–ª —Å–±—Ä–æ—à–µ–Ω"
   ‚Üì
5. –¶–∏–∫–ª –º–æ–∂–µ—Ç —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å –∑–∞–Ω–æ–≤–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

---

## üìã –ò–¢–û–ì–ò

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å –¥–æ | –°—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ |
|-----------|-----------|--------------|
| –î–æ—Å—Ç—É–ø –∫ locks | ‚ùå `self.locks[base]` (–Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç) | ‚úÖ `self._get_lock(base)` |
| –°–æ–∑–¥–∞–Ω–∏–µ lock | ‚ùå –ö—Ä–∞—à –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ |
| –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | ‚úÖ –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Å–±—Ä–æ—Å–∞ |
| Traceback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω—ã–π | ‚úÖ –ü–æ–ª–Ω—ã–π |
| –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ | ‚ùå –ï—Å—Ç—å | ‚úÖ –ù–µ—Ç |
| –ê–≤—Ç–æ–ø—Ä–æ–¥–∞–∂–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤ | ‚ùå –ù–ï –†–ê–ë–û–¢–ê–õ–ê | ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢** |

---

## üéØ –û–ñ–ò–î–ê–ï–ú–´–ï –õ–û–ì–ò

### –£—Å–ø–µ—à–Ω–∞—è –ø—Ä–æ–¥–∞–∂–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤:
```
[DOGE] üîÑ === –ê–í–¢–û–ü–†–û–î–ê–ñ–ê –û–°–¢–ê–¢–ö–û–í –í IDLE –°–û–°–¢–û–Ø–ù–ò–ò ===
[DOGE] üí∞ –î–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏: 72.01213000
[DOGE] üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞—Ä—ã: min_base=10.0, min_quote=1.0
[DOGE] üöÄ –°–æ–∑–¥–∞–µ–º –æ—Ä–¥–µ—Ä –Ω–∞ –ø—Ä–æ–¥–∞–∂—É –æ—Å—Ç–∞—Ç–∫–æ–≤:
[DOGE] üöÄ   –û–±—ä–µ–º: 72.01 DOGE
[DOGE] üöÄ   –¶–µ–Ω–∞: 0.13998000 USDT
[DOGE] ‚úÖ –û—Ä–¥–µ—Ä —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ: 123456789
[DOGE] ‚úÖ –¶–∏–∫–ª —Å–±—Ä–æ—à–µ–Ω –ø–æ—Å–ª–µ –ø—Ä–æ–¥–∞–∂–∏ –æ—Å—Ç–∞—Ç–∫–æ–≤
```

### –°–±—Ä–æ—Å —Ü–∏–∫–ª–∞ (–æ—Å—Ç–∞—Ç–∫–∏ —Å–ª–∏—à–∫–æ–º –º–∞–ª—ã):
```
[DOGE] üîÑ === –ê–í–¢–û–ü–†–û–î–ê–ñ–ê –û–°–¢–ê–¢–ö–û–í –í IDLE –°–û–°–¢–û–Ø–ù–ò–ò ===
[DOGE] üí∞ –î–æ—Å—Ç—É–ø–Ω—ã–π –±–∞–ª–∞–Ω—Å –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏: 0.50000000
[DOGE] üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞—Ä—ã: min_base=10.0, min_quote=1.0
[DOGE] ‚ö†Ô∏è –û–±—ä–µ–º 0.5 –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ 10.0
[DOGE] üóëÔ∏è –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ü–∏–∫–ª, –æ—Å—Ç–∞—Ç–∫–∏ —Å–ª–∏—à–∫–æ–º –º–∞–ª—ã –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏
[DOGE] ‚úÖ –¶–∏–∫–ª —Å–±—Ä–æ—à–µ–Ω, –æ—Å—Ç–∞—Ç–∫–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è
```

---

**–î–ê–¢–ê:** 12 –¥–µ–∫–∞–±—Ä—è 2025 –≥.  
**–§–ê–ô–õ:** autotrader_v2.py  
**–§–£–ù–ö–¶–ò–Ø:** `_try_sell_idle_balance`  
**–°–¢–ê–¢–£–°:** ‚úÖ **–ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ**
