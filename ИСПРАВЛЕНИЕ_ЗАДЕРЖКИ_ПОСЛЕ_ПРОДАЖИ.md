# üêõ –ü–†–û–ë–õ–ï–ú–ê: ETH –Ω–µ –ø—Ä–æ–¥–∞—ë—Ç—Å—è (FOK –æ—Ä–¥–µ—Ä + –∑–∞–¥–µ—Ä–∂–∫–∞)

## üìã –°–∏–º–ø—Ç–æ–º—ã

1. **–£—Å–ª–æ–≤–∏–µ –ø—Ä–æ–¥–∞–∂–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ** (—Ç–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ > breakeven)
2. **–ü—Ä–æ–¥–∞–∂–∞ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç** –∏–ª–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –Ω–æ **—Å—Ä–∞–∑—É –Ω–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞**
3. –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ: –ø—Ä–æ–¥–∞–∂–∞ ‚Üí –Ω–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞ —á–µ—Ä–µ–∑ 11 —Å–µ–∫—É–Ω–¥

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ1: FOK –æ—Ä–¥–µ—Ä –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è

**FOK (Fill-Or-Kill)** –æ—Ä–¥–µ—Ä —Ç—Ä–µ–±—É–µ—Ç **–ü–û–õ–ù–û–ì–û** –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –∏–ª–∏ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è.

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è:**
1. ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–±—ä—ë–º–∞ –≤ —Å—Ç–∞–∫–∞–Ω–µ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —É—Ä–æ–≤–Ω–µ
2. ‚ùå –¶–µ–Ω–∞ —Å—Ç–∞–∫–∞–Ω–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ —Å–æ–∑–¥–∞–Ω–∏–µ–º –æ—Ä–¥–µ—Ä–∞
3. ‚ùå –ü—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ (slippage)

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–∫–∞–Ω–∞** (`debug_eth_sell.py`):
```
‚úÖ –û–±—ä—ë–º–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ! (0.94530000 >= 0.00310000)
üí∞ –ú–æ–∂–Ω–æ –ø—Ä–æ–¥–∞—Ç—å –∑–∞: 10.1017 USDT
```

–ó–Ω–∞—á–∏—Ç, –ø—Ä–æ–±–ª–µ–º–∞ –ù–ï –≤ –æ–±—ä—ë–º–µ —Å—Ç–∞–∫–∞–Ω–∞.

### –ü—Ä–æ–±–ª–µ–º–∞ ‚Ññ2: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ –ø—Ä–æ–¥–∞–∂–∏

**–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê** –≤ –∫–æ–¥–µ `_try_sell`:

```python
# –ë–´–õ–û (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
cycle._selling_in_progress = False
cycle.reset(manual=False)  # ‚Üê –ù–ï —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è last_sell_at!
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ü–æ—Å–ª–µ –ø—Ä–æ–¥–∞–∂–∏ `last_sell_at` –æ—Å—Ç–∞—ë—Ç—Å—è **0.0**
- –ó–∞–¥–µ—Ä–∂–∫–∞ 60 —Å–µ–∫—É–Ω–¥ **–ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç**
- –ù–æ–≤—ã–π —Ü–∏–∫–ª –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **–°–†–ê–ó–£** (—á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É)

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Ññ1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ last_sell_at

**–§–∞–π–ª**: `autotrader_v2.py`, –º–µ—Ç–æ–¥ `_try_sell`, ~—Å—Ç—Ä–æ–∫–∞ 1330

```python
# –°–¢–ê–õ–û (–ü–†–ê–í–ò–õ–¨–ù–û):
# üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º last_sell_at –ü–ï–†–ï–î reset()!
cycle.last_sell_at = time.time()
print(f"[{base}] ‚è∞ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ 60 —Å–µ–∫ –ø–µ—Ä–µ–¥ –Ω–æ–≤—ã–º —Ü–∏–∫–ª–æ–º")

# –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ü–∏–∫–ª —á–µ—Ä–µ–∑ reset()
cycle._selling_in_progress = False
cycle.reset(manual=False)
```

**–¢–µ–ø–µ—Ä—å**:
- ‚úÖ –ü–æ—Å–ª–µ –ø—Ä–æ–¥–∞–∂–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `last_sell_at`
- ‚úÖ –ó–∞–¥–µ—Ä–∂–∫–∞ 60 —Å–µ–∫—É–Ω–¥ **—Ä–∞–±–æ—Ç–∞–µ—Ç**
- ‚úÖ –ù–æ–≤—ã–π —Ü–∏–∫–ª –ù–ï –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Ññ2: –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ FOK –æ—Ä–¥–µ—Ä–∞

–î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º FOK –æ—Ä–¥–µ—Ä–∞:

```python
print(f"[{base}] üìä –î–µ—Ç–∞–ª–∏ FOK –æ—Ä–¥–µ—Ä–∞:")
print(f"[{base}]    –ü–∞—Ä–∞: {currency_pair}")
print(f"[{base}]    –û–±—ä—ë–º: {base_volume:.8f} {base}")
print(f"[{base}]    –¶–µ–Ω–∞: {orderbook_price:.8f} {quote}")
print(f"[{base}]    –¢–∏–ø: LIMIT + FOK (Fill-Or-Kill)")
print(f"[{base}]    –£—Å–ª–æ–≤–∏–µ: –û—Ä–¥–µ—Ä –±—É–¥–µ—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω –ü–û–õ–ù–û–°–¢–¨–Æ –∏–ª–∏ –æ—Ç–º–µ–Ω—ë–Ω")
```

**–¢–µ–ø–µ—Ä—å** –≤—ã –±—É–¥–µ—Ç–µ –≤–∏–¥–µ—Ç—å –≤ –ª–æ–≥–∞—Ö:
- –¢–æ—á–Ω—É—é —Ü–µ–Ω—É –∏–∑ —Å—Ç–∞–∫–∞–Ω–∞
- –û–±—ä—ë–º –æ—Ä–¥–µ—Ä–∞
- –†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è

## üìä –ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
[21:04:23] Sell (–ø—Ä–æ–¥–∞–∂–∞)
[21:04:34] Buy (–Ω–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞) ‚Üê –°–†–ê–ó–£ —á–µ—Ä–µ–∑ 11 —Å–µ–∫—É–Ω–¥!
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
[21:04:23] Sell (–ø—Ä–æ–¥–∞–∂–∞)
[21:04:23] ‚è∞ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ 60 —Å–µ–∫
...
[21:05:23] ‚úÖ –ó–∞–¥–µ—Ä–∂–∫–∞ –∏—Å—Ç–µ–∫–ª–∞, —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤—ã–π —Ü–∏–∫–ª
[21:05:24] Buy (–Ω–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞) ‚Üê –ß–µ—Ä–µ–∑ 60+ —Å–µ–∫—É–Ω–¥
```

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç—Ä–µ–π–¥–µ—Ä** (—á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
2. **–î–æ–∂–¥–∏—Ç–µ—Å—å —Å–ª–µ–¥—É—é—â–µ–π –ø—Ä–æ–¥–∞–∂–∏**
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏**:
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `‚è∞ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ 60 —Å–µ–∫`
   - –ù–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å **–ù–ï –†–ê–ù–¨–®–ï** —á–µ–º —á–µ—Ä–µ–∑ 60 —Å–µ–∫—É–Ω–¥
4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—Ä–æ–¥–∞–∂–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
   - –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: `‚úÖ –û—Ä–¥–µ—Ä –Ω–∞ –ø—Ä–æ–¥–∞–∂—É –∏—Å–ø–æ–ª–Ω–µ–Ω –ü–û–õ–ù–û–°–¢–¨–Æ!`
   - –ò–ª–∏: `‚ö†Ô∏è FOK –æ—Ä–¥–µ—Ä –æ—Ç–∫–ª–æ–Ω—ë–Ω` (–µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–±—ä—ë–º–∞)

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ï—Å–ª–∏ FOK –æ—Ä–¥–µ—Ä –≤—Å—ë —Ä–∞–≤–Ω–æ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è:

**–í–∞—Ä–∏–∞–Ω—Ç 1**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É—Ä–æ–≤–µ–Ω—å —Å—Ç–∞–∫–∞–Ω–∞ 0 (best bid) –≤–º–µ—Å—Ç–æ 1:
```python
orderbook_level = 0  # –í–º–µ—Å—Ç–æ 1
```

**–í–∞—Ä–∏–∞–Ω—Ç 2**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ MARKET –æ—Ä–¥–µ—Ä –≤–º–µ—Å—Ç–æ FOK:
```python
order = api_client.create_spot_order(
    currency_pair=currency_pair,
    side='sell',
    order_type='market',  # –í–º–µ—Å—Ç–æ 'limit'
    amount=str(base_volume)
    # –ë–ï–ó price –∏ time_in_force
)
```

**–í–∞—Ä–∏–∞–Ω—Ç 3**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ IOC (Immediate-Or-Cancel) –≤–º–µ—Å—Ç–æ FOK:
```python
time_in_force='ioc'  # –í–º–µ—Å—Ç–æ 'fok'
```

IOC –∏—Å–ø–æ–ª–Ω–∏—Ç **—á–∞—Å—Ç–∏—á–Ω–æ**, –µ—Å–ª–∏ –ø–æ–ª–Ω—ã–π –æ–±—ä—ë–º –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

## üéØ –°—Ç–∞—Ç—É—Å

- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ**: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `last_sell_at` –ø–æ—Å–ª–µ –ø—Ä–æ–¥–∞–∂–∏
- ‚úÖ **–£–ª—É—á—à–µ–Ω–æ**: –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ FOK –æ—Ä–¥–µ—Ä–∞
- ‚úÖ **–ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é**

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 2025-12-11  
**–§–∞–π–ª—ã**: `autotrader_v2.py`, `debug_eth_sell.py`
