# –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–º –¥–∞–Ω–Ω—ã—Ö

## –î–∞—Ç–∞: 6 –Ω–æ—è–±—Ä—è 2025

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç —Å—Ç–æ–ª–∫–Ω—É—Ç—å—Å—è —Å –ø—Ä–æ–±–ª–µ–º–æ–π –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –∏ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∏–∑-–∑–∞:
- –ù–∞–∫–æ–ø–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö WebSocket (—Å—Ç–∞–∫–∞–Ω—ã, —Å–¥–µ–ª–∫–∏, —Ç–∏–∫–µ—Ä—ã)
- –†–æ—Å—Ç–∞ —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ö—Ä–∞–Ω–∏–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –†–µ—à–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–º –¥–∞–Ω–Ω—ã—Ö —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ –∑–∞—â–∏—Ç—ã.

---

## üìä –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (data_limits.py)

### WebSocket –∫—ç—à (–≤ –ø–∞–º—è—Ç–∏):

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| `MAX_CURRENCY_PAIRS_CACHE` | 10 | –ú–∞–∫—Å–∏–º—É–º –≤–∞–ª—é—Ç–Ω—ã—Ö –ø–∞—Ä –≤ –∫—ç—à–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ |
| `MAX_ORDERBOOK_LEVELS` | 20 | –ú–∞–∫—Å–∏–º—É–º —É—Ä–æ–≤–Ω–µ–π —Å—Ç–∞–∫–∞–Ω–∞ (asks/bids) |
| `MAX_TRADES_HISTORY` | 50 | –ú–∞–∫—Å–∏–º—É–º —Å–¥–µ–ª–æ–∫ –≤ –∏—Å—Ç–æ—Ä–∏–∏ |
| `CACHE_TTL_SECONDS` | 300 | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∫—ç—à–∞ (5 –º–∏–Ω—É—Ç) |

### –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| `MAX_CURRENCIES` | 50 | –ú–∞–∫—Å–∏–º—É–º –≤–∞–ª—é—Ç –≤ —Å–ø–∏—Å–∫–µ |
| `MAX_ACCOUNTS` | 10 | –ú–∞–∫—Å–∏–º—É–º –∞–∫–∫–∞—É–Ω—Ç–æ–≤ |
| `MAX_CURRENCIES_FILE_SIZE_KB` | 100 | –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä currencies.json |
| `MAX_ACCOUNTS_FILE_SIZE_KB` | 500 | –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä accounts.json |

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| `CLEANUP_INTERVAL_SECONDS` | 600 | –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—á–∏—Å—Ç–∫–∏ (10 –º–∏–Ω—É—Ç) |
| `MIN_PAIRS_TO_KEEP` | 1 | –ú–∏–Ω–∏–º—É–º –ø–∞—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è |

---

## üîÑ –ú–µ—Ö–∞–Ω–∏–∑–º—ã –∫–æ–Ω—Ç—Ä–æ–ª—è

### 1. WebSocket –∫—ç—à (PairWebSocketManager)

#### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞:
```python
# –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
def _cleanup_old_cache(self):
    # 1. –£–¥–∞–ª—è–µ—Ç –ø–∞—Ä—ã –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π > 5 –º–∏–Ω—É—Ç
    # 2. –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä –¥–æ 10
    # 3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –º–∏–Ω–∏–º—É–º 1 –∞–∫—Ç–∏–≤–Ω—É—é –ø–∞—Ä—É
```

#### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Å—Ç–∞–∫–∞–Ω–∞:
```python
def _limit_orderbook_size(self, orderbook: dict):
    # –û–±—Ä–µ–∑–∞–µ—Ç asks –∏ bids –¥–æ 20 —É—Ä–æ–≤–Ω–µ–π
    orderbook['asks'] = orderbook['asks'][:20]
    orderbook['bids'] = orderbook['bids'][:20]
```

#### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–¥–µ–ª–æ–∫:
```python
# –ü—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
self.data_cache[pair]['trades'] = trades[:50]
```

### 2. –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

#### currencies.json:
```python
def save_currencies(currencies):
    # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
    if len(currencies) > 50:
        currencies = currencies[:50]
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    file_size = os.path.getsize('currencies.json') / 1024
    if file_size > 100:
        print(f"WARNING: –†–∞–∑–º–µ—Ä {file_size} KB –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç")
```

#### accounts.json:
```python
def _save_accounts(self):
    # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
    if len(self.accounts) > 10:
        # –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ 10 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö (–ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è)
        sorted_accounts = sorted(accounts, key=created_at, reverse=True)
        self.accounts = sorted_accounts[:10]
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞
    file_size = os.path.getsize('accounts.json') / 1024
    if file_size > 500:
        print(f"WARNING: –†–∞–∑–º–µ—Ä {file_size} KB –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç")
```

---

## üéØ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –ø–∞—Ä–∞–º–∏

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –º–µ–∂–¥—É 15 –ø–∞—Ä–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞:**

1. **–ü–µ—Ä–≤—ã–µ 10 –ø–∞—Ä:** –í—Å–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏
2. **–ü–∞—Ä–∞ 11:** –°–∞–º–∞—è —Å—Ç–∞—Ä–∞—è –ø–∞—Ä–∞ (–ø–æ last_update) —É–¥–∞–ª—è–µ—Ç—Å—è
3. **–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ (—á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç):** –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä—ã > 5 –º–∏–Ω—É—Ç —É–¥–∞–ª—è—é—Ç—Å—è
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í –ø–∞–º—è—Ç–∏ –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ 2-3 –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä—ã

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞

**–°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç 24/7:**

1. **–ö–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. **WebSocket:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –æ—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–∞—Ä
3. **–ü–∞–º—è—Ç—å:** –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –æ—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ø–∞–º—è—Ç–∏ ~5-10 MB

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ë–æ–ª—å—à–æ–π —Ñ–∞–π–ª accounts.json

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç 20 –∞–∫–∫–∞—É–Ω—Ç–æ–≤:**

1. **–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ (10 –∞–∫–∫–∞—É–Ω—Ç–æ–≤)
2. **–ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω:** –í–æ–∑–≤—Ä–∞—Ç –æ—à–∏–±–∫–∏
3. **–ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—Ä–µ–∑–∞–Ω–∏–µ –¥–æ 10 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –§–∞–π–ª –Ω–µ –ø—Ä–µ–≤—ã—Å–∏—Ç ~50 KB

---

## üìà –û—Ü–µ–Ω–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤

### –ü–∞–º—è—Ç—å (–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞—è):

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –†–∞–∑–º–µ—Ä –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É | –ú–∞–∫—Å–∏–º—É–º | –ò—Ç–æ–≥–æ |
|-----------|-------------------|----------|-------|
| 1 –ø–∞—Ä–∞ (ticker) | ~1 KB | 10 –ø–∞—Ä | 10 KB |
| 1 —Å—Ç–∞–∫–∞–Ω (20+20 —É—Ä–æ–≤–Ω–µ–π) | ~3 KB | 10 –ø–∞—Ä | 30 KB |
| 1 –∏—Å—Ç–æ—Ä–∏—è —Å–¥–µ–ª–æ–∫ (50 —à—Ç) | ~5 KB | 10 –ø–∞—Ä | 50 KB |
| **–ò–¢–û–ì–û** | | | **~90 KB** |

### –î–∏—Å–∫ (—Ñ–∞–π–ª—ã):

| –§–∞–π–ª | –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä | –ú–∞–∫—Å–∏–º—É–º | –õ–∏–º–∏—Ç |
|------|----------------|----------|-------|
| currencies.json | ~5 KB | ~10 KB | 100 KB |
| accounts.json | ~2 KB | ~20 KB | 500 KB |
| secrets.json | ~0.5 KB | ~0.5 KB | - |
| mtrade_server.pid | ~10 bytes | ~10 bytes | - |
| **–ò–¢–û–ì–û** | | | **~30 KB** |

---

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π:

```python
# –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤
[WARNING] –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞–ª—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ –¥–æ 50
[WARNING] –†–∞–∑–º–µ—Ä currencies.json (120.45 KB) –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç
[WARNING] –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ (15) –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç 10
```

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –ª–æ–≥–∏:

```python
# –ü—Ä–∏ –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–µ
[INFO] –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞: —É–¥–∞–ª–µ–Ω–æ 3 –ø–∞—Ä
[INFO] –£–¥–∞–ª–µ–Ω–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞—è –ø–∞—Ä–∞ –∏–∑ –∫—ç—à–∞: BTC_USDT
[INFO] –ü–æ—Ç–æ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞ –∑–∞–ø—É—â–µ–Ω
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤

–í—Å–µ –ª–∏–º–∏—Ç—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `data_limits.py`:

```python
class DataLimits:
    # –ò–∑–º–µ–Ω—è–π—Ç–µ —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–¥ —Å–≤–æ–∏ –Ω—É–∂–¥—ã
    MAX_CURRENCY_PAIRS_CACHE = 10  # –£–≤–µ–ª–∏—á—å—Ç–µ –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –∫—ç—à–∞
    MAX_ORDERBOOK_LEVELS = 20      # –£–≤–µ–ª–∏—á—å—Ç–µ –¥–ª—è –≥–ª—É–±–∏–Ω—ã —Å—Ç–∞–∫–∞–Ω–∞
    MAX_TRADES_HISTORY = 50        # –£–≤–µ–ª–∏—á—å—Ç–µ –¥–ª—è –±–æ–ª—å—à–µ–π –∏—Å—Ç–æ—Ä–∏–∏
    CACHE_TTL_SECONDS = 300        # –£–º–µ–Ω—å—à–∏—Ç–µ –¥–ª—è –±–æ–ª–µ–µ —á–∞—Å—Ç–æ–π –æ—á–∏—Å—Ç–∫–∏
    CLEANUP_INTERVAL_SECONDS = 600 # –£–º–µ–Ω—å—à–∏—Ç–µ –¥–ª—è –±–æ–ª–µ–µ —á–∞—Å—Ç–æ–π –æ—á–∏—Å—Ç–∫–∏
```

---

## üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è

### –£—Ä–æ–≤–µ–Ω—å 1: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—Ä–µ–∑–∞–Ω–∏–µ –¥–æ –ª–∏–º–∏—Ç–∞

### –£—Ä–æ–≤–µ–Ω—å 2: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
- –ö–∞–∂–¥–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ WebSocket –ø—Ä–∏–º–µ–Ω—è–µ—Ç –ª–∏–º–∏—Ç—ã
- –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–º–µ–Ω—è—é—Ç—Å—è –Ω–æ–≤—ã–º–∏

### –£—Ä–æ–≤–µ–Ω—å 3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
- –§–æ–Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫ –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
- –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—â–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞

### –£—Ä–æ–≤–µ–Ω—å 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤
- –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ –ª–æ–≥–∞—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—Ä–µ–∑–∞–Ω–∏–µ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –ø–∞—Ä –≤ –∫—ç—à–µ:

```python
# data_limits.py
MAX_CURRENCY_PAIRS_CACHE = 20  # –ë—ã–ª–æ: 10
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–æ–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –¥–æ 20 –ø–∞—Ä –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

### –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≥–ª—É–±–∏–Ω—ã —Å—Ç–∞–∫–∞–Ω–∞:

```python
# data_limits.py
MAX_ORDERBOOK_LEVELS = 50  # –ë—ã–ª–æ: 20
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°—Ç–∞–∫–∞–Ω –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å 50 —É—Ä–æ–≤–Ω–µ–π –≤–º–µ—Å—Ç–æ 20

### –£—Å–∫–æ—Ä–µ–Ω–∏–µ –æ—á–∏—Å—Ç–∫–∏:

```python
# data_limits.py
CLEANUP_INTERVAL_SECONDS = 300   # –ë—ã–ª–æ: 600 (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
CACHE_TTL_SECONDS = 180          # –ë—ã–ª–æ: 300 (3 –º–∏–Ω—É—Ç—ã –≤–º–µ—Å—Ç–æ 5)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏** - –Ω–µ –±–æ–ª–µ–µ 100 KB –≤ –û–ó–£
2. **–ú–∞–ª—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤** - –Ω–µ –±–æ–ª–µ–µ 30 KB –Ω–∞ –¥–∏—Å–∫–µ
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞** - –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞
4. **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ** - —á–µ—Ç–∫–∏–µ –ª–∏–º–∏—Ç—ã
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ –Ω—É–∂–¥—ã
6. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö

---

## üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫—ç—à–∞ –ø–∞—Ä

```python
# –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ 20 –ø–∞—Ä –ø–æ–¥—Ä—è–¥
for i in range(20):
    ws_manager.create_connection(f"COIN{i}_USDT")

# –ü—Ä–æ–≤–µ—Ä—è–µ–º: –¥–æ–ª–∂–Ω–æ –æ—Å—Ç–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ 10
assert len(ws_manager.data_cache) == 10
```

### –¢–µ—Å—Ç 2: –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```python
# –ñ–¥–µ–º 6 –º–∏–Ω—É—Ç –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
time.sleep(360)

# –ó–∞–ø—É—Å–∫–∞–µ–º –æ—á–∏—Å—Ç–∫—É
ws_manager._cleanup_old_cache()

# –ü—Ä–æ–≤–µ—Ä—è–µ–º: —Å—Ç–∞—Ä—ã–µ –ø–∞—Ä—ã —É–¥–∞–ª–µ–Ω—ã
assert len(ws_manager.data_cache) >= MIN_PAIRS_TO_KEEP
```

### –¢–µ—Å—Ç 3: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å—Ç–∞–∫–∞–Ω–∞

```python
# –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞–∫–∞–Ω —Å 100 —É—Ä–æ–≤–Ω—è–º–∏
orderbook = {"asks": [[1, 1]] * 100, "bids": [[1, 1]] * 100}

# –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
limited = ws_manager._limit_orderbook_size(orderbook)

# –ü—Ä–æ–≤–µ—Ä—è–µ–º
assert len(limited['asks']) == 20
assert len(limited['bids']) == 20
```

---

## üìù –ò—Ç–æ–≥

–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

‚úÖ **–ó–∞—â–∏—Ç—É –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –ø–∞–º—è—Ç–∏**  
‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤**  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É**  
‚úÖ **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**  
‚úÖ **–ü—Ä–æ—Å—Ç—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É**  

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å 24/7 –±–µ–∑ —Ä–∏—Å–∫–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –∏–ª–∏ –¥–∏—Å–∫–∞!

---

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 6 –Ω–æ—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** üü¢ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
