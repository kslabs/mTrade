# 🎯 mTrade - Актуальное состояние (6 ноября 2025)

> **Быстрый доступ к текущему функционалу платформы**

---

## 🚀 Запуск

```bash
python mTrade.py          # Запуск сервера
python restart.py         # Перезапуск
python status.py          # Проверка статуса
```

**Адрес:** http://localhost:5000

---

## 📊 Стакан ордеров (Order Book) - Главная фича

### Структура: 4 колонки

| Цена (USDT) | Кол-во | Сумма | **Σ Накоп.** ⭐ |
|-------------|--------|-------|-----------------|
| 0.71346     | 150.25 | 107.20| **107.20**      |
| 0.71345     | 200.50 | 143.05| **250.25**      |
| 0.71344     | 85.75  | 61.18 | **311.43**      |

### Зачем нужна "Σ Накоп." (накопительная сумма)?

**Покупка на 300 USDT:**
1. Смотрите колонку "Σ Накоп." в BIDS (зеленые)
2. Найдите уровень, где сумма >= 300
3. Это покажет среднюю цену с учетом проскальзывания

**Преимущества:**
- ✅ Контроль ликвидности
- ✅ Оценка проскальзывания
- ✅ Планирование сделок

---

## 🎨 Визуальный интерфейс

```
╔════════════════════════════════════════════════════════════╗
║              РЫНОК И СТАКАН: WLD/USDT                     ║
╠════════════════════════════════════════════════════════════╣
║  Цена: 0.7134 USDT          ↑ +0.0045 (+0.63%)           ║
║  Объем 24ч: 15,234,567 USDT                               ║
╠════════════════════════════════════════════════════════════╣
║  Баланс WLD:  123.46         ≈ $88.05                    ║
║  Баланс USDT: 1,234.56       ≈ $1,234.56                 ║
╠════════════════════════════════════════════════════════════╣
║  СТАКАН:                                                   ║
║  Цена    │ Кол-во │ Сумма  │ Σ Накоп.                    ║
║  0.71346 │ 150.25 │ 107.20 │ 107.20   🔴 ASKS (продажа) ║
║  0.71345 │ 200.50 │ 143.05 │ 250.25                      ║
║  ─────────────────────────────────────                    ║
║  Спред: 0.00001 (0.0014%)                                 ║
║  ─────────────────────────────────────                    ║
║  0.71341 │ 180.50 │ 128.76 │ 128.76   🟢 BIDS (покупка) ║
║  0.71340 │ 220.75 │ 157.50 │ 286.26                      ║
╚════════════════════════════════════════════════════════════╝
```

---

## 🔧 Форматирование

### Точность отображения:

| Поле | Формат | Пример |
|------|--------|--------|
| Цена | Все значащие цифры | 0.71345 |
| Количество | 2 знака | 150.25 |
| Сумма | 2 знака | 107.20 |
| Накопительная | 2 знака | 250.25 |

### Функция formatPrice():
- < 0.0001: научная нотация (`1.0000e-8`)
- 0.0001-1000: до 8 знаков (`0.12345`)
- > 1000: с запятыми (`1,234.56`)

---

## 📡 API Endpoints

### Валютные пары:
```http
GET  /api/currencies                    # Список валют
POST /api/pair/subscribe                # Подписка на пару
GET  /api/pair/data?base=WLD&quote=USDT # Данные
GET  /api/pair/balances?base=WLD        # Балансы
POST /api/pair/unsubscribe              # Отписка
```

### Ответ /api/pair/data:
```json
{
  "success": true,
  "pair": "WLD_USDT",
  "data": {
    "ticker": { "last": "0.7134", ... },
    "orderbook": {
      "asks": [["0.71346", "150.25"], ...],
      "bids": [["0.71341", "180.50"], ...]
    }
  }
}
```

---

## 🎯 Примеры использования

### Пример 1: Покупка на 500 USDT

**Смотрим BIDS:**
```
Цена    │ Кол-во │ Сумма  │ Σ Накоп.
0.71341 │ 180.50 │ 128.76 │ 128.76   ← недостаточно
0.71340 │ 220.75 │ 157.50 │ 286.26   ← недостаточно
0.71339 │ 165.25 │ 117.92 │ 404.18   ← недостаточно
0.71338 │  90.00 │  64.20 │ 468.38   ← недостаточно
0.71337 │ 155.80 │ 111.14 │ 579.52   ← достаточно! ✅
```

**Результат:**
- Купим ~700 WLD за 579.52 USDT
- Средняя цена: ~0.71336 USDT
- Проскальзывание: ~0.00004 USDT

### Пример 2: Клик по уровню

1. **Кликните** на строку стакана
2. **Форма торговли** автоматически заполнится:
   - Цена: выбранный уровень
   - Сторона: buy/sell
3. **Tooltip** покажет детали накопления

---

## 🎨 Компактность

### Было:
```
padding: 5px  → много пустого пространства
height: 200px → мало строк видно
```

### Стало:
```
padding: 2px  → компактно ✅
height: 250px → больше строк ✅
line-height: 1.3 → плотно ✅
```

---

## 📚 Документация

| Файл | Описание |
|------|----------|
| **PROJECT_STATUS.md** | Полное состояние проекта |
| **ORDERBOOK_VISUAL_EXAMPLE.md** | Визуальные примеры |
| **ORDERBOOK_CUMULATIVE_SUM.md** | Накопительная сумма |
| **SUMMARY_2025_11_06.md** | Итоги последнего обновления |

---

## 🔄 WebSocket

### Каналы:
- `spot.tickers` - тикер (цена, объем)
- `spot.order_book` - стакан (snapshot)
- `spot.trades` - история сделок

### Автоматика:
- ✅ Auto-reconnect при обрыве
- ✅ Ping-pong для поддержания связи
- ✅ Singleton manager для эффективности

---

## ⚡ Ключевые изменения (6 ноя 2025)

1. **Накопительная сумма** - новая 4-я колонка
2. **Точность** - правильное форматирование
3. **Компактность** - уменьшены отступы
4. **Балансы** - эквивалент для обеих валют

---

## 🐛 Troubleshooting

### Сервер не запускается:
```bash
netstat -ano | findstr :5000  # Проверка порта
taskkill /PID <PID> /F        # Убить процесс
```

### WebSocket не работает:
```bash
python restart.py  # Перезапуск
```

### Данные не обновляются:
- Проверьте консоль браузера (F12)
- Проверьте логи сервера

---

## 📊 Статистика

- **Колонок в стакане:** 4
- **Уровней:** 10 asks + 10 bids
- **Точность цены:** до 8 знаков
- **Точность объемов:** 2 знака
- **Компактность:** +60% больше строк

---

## 🎯 Следующие шаги

- [ ] Визуализация глубины стакана (depth chart)
- [ ] Автоматический расчет средней цены
- [ ] Подсветка уровня с достаточным объемом
- [ ] Приватные данные через WebSocket

---

**Обновлено:** 6 ноября 2025, 23:00  
**Статус:** 🟢 Активно и протестировано  
**Адрес:** http://localhost:5000  

**Успешной торговли! 🚀**
