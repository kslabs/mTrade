# UI State Persistence - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å —Å–æ—Å—Ç–æ—è–Ω–∏—è:
- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å AutoTrade (ON/OFF)
- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–∞ —Å–µ—Ç–∏ (Work/Test)
- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏ (Trade/Copy)
- –†–∞–∑—Ä–µ—à–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤–ª–∏ –¥–ª—è –≤–∞–ª—é—Ç
- –ê–∫—Ç–∏–≤–Ω–∞—è –±–∞–∑–æ–≤–∞—è –∏ –∫–æ—Ç–∏—Ä–æ–≤–æ—á–Ω–∞—è –≤–∞–ª—é—Ç–∞
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å (`mTrade.py`)

#### –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∂–∏–º–∞ —Å–µ—Ç–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:
```python
# –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∂–∏–º —Å–µ—Ç–∏ –∏–∑ state_manager (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã)
state_mgr = get_state_manager()
CURRENT_NETWORK_MODE = state_mgr.get_network_mode()
```

#### –ó–∞–≥—Ä—É–∑–∫–∞ AutoTrade –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:
```python
AUTO_TRADE_GLOBAL_ENABLED = state_mgr.get_auto_trade_enabled()
```

#### –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π —Ç–æ—Ä–≥–æ–≤–ª–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:
```python
TRADING_PERMISSIONS = state_mgr.get_trading_permissions()
```

#### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ AutoTrade:
```python
@app.route('/api/autotrade/start', methods=['POST'])
def api_autotrade_start():
    global AUTO_TRADE_GLOBAL_ENABLED
    AUTO_TRADE_GLOBAL_ENABLED = True
    state_mgr.set_auto_trade_enabled(True)
    return jsonify({'success': True, 'message': 'global autotrade cycles start enabled'})
```

#### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏:
```python
@app.route('/api/mode', methods=['POST'])
def set_mode():
    mode = str(data.get('mode', '')).lower()
    if state_mgr.set_trading_mode(mode):
        return jsonify({"success": True, "mode": mode})
```

#### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π —Ç–æ—Ä–≥–æ–≤–ª–∏:
```python
@app.route('/api/trade/permission', methods=['POST'])
def api_trade_permission_set():
    TRADING_PERMISSIONS[base] = enabled
    state_mgr.set_trading_permission(base, enabled)
    return jsonify({'success': True, 'base': base, 'enabled': enabled})
```

### 2. API endpoints (`server_control_routes.py`)

#### –û–±–Ω–æ–≤–ª–µ–Ω GET /api/ui/state:
–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `active_base_currency` –∏ `active_quote_currency` –≤ –æ—Ç–≤–µ—Ç:
```python
def get_ui_state(self):
    return jsonify({
        "success": True,
        "state": {
            "auto_trade_enabled": self.state_manager.get_auto_trade_enabled(),
            "enabled_currencies": self.state_manager.get_trading_permissions(),
            "network_mode": self.state_manager.get_network_mode(),
            "trading_mode": self.state_manager.get_trading_mode(),
            "active_base_currency": self.state_manager.get_active_base_currency(),
            "active_quote_currency": self.state_manager.get_active_quote_currency(),
            "breakeven_params": self.state_manager.get_breakeven_params()
        }
    })
```

### 3. –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å (`app.js`)

–§—É–Ω–∫—Ü–∏—è `loadUIState()` —É–∂–µ –±—ã–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è:
- AutoTrade enabled/disabled
- –†–∞–∑—Ä–µ—à–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤–ª–∏ –¥–ª—è –≤–∞–ª—é—Ç
- –ê–∫—Ç–∏–≤–Ω—É—é –±–∞–∑–æ–≤—É—é –∏ –∫–æ—Ç–∏—Ä–æ–≤–æ—á–Ω—É—é –≤–∞–ª—é—Ç—É
- –†–µ–∂–∏–º —Ç–æ—Ä–≥–æ–≤–ª–∏ (trade/copy)
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏

–§—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏:
- `toggleAutoTrade()` ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
- `switchNetworkMode()` ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
- `switchTradingMode()` ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
- `switchBaseCurrency()` ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—ã–±–æ—Ä –±–∞–∑–æ–≤–æ–π –≤–∞–ª—é—Ç—ã
- `switchQuoteCurrency()` ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—ã–±–æ—Ä –∫–æ—Ç–∏—Ä–æ–≤–æ—á–Ω–æ–π –≤–∞–ª—é—Ç—ã
- `saveTradeParams()` ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏

## –ò—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã

**StateManager** (`state_manager.py`) - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –≤—Å–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π UI.

–§–∞–π–ª: `app_state.json`

–ü—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ:
```json
{
  "trading_mode": "trade",
  "auto_trade_enabled": true,
  "trading_permissions": {
    "BTC": true,
    "ETH": true,
    "SOL": false
  },
  "network_mode": "test",
  "active_base_currency": "BTC",
  "active_quote_currency": "USDT",
  "breakeven_params": {
    "BTC": {
      "steps": 16,
      "start_volume": 3.0,
      "start_price": 0.0,
      "pprof": 0.6,
      "kprof": 0.02,
      "target_r": 3.65,
      "geom_multiplier": 2.0,
      "rebuy_mode": "geometric",
      "keep": 0.0001
    }
  }
}
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: AutoTrade
1. –í–∫–ª—é—á–∏—Ç–µ AutoTrade (–∫–Ω–æ–ø–∫–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å ON)
2. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
3. ‚úÖ AutoTrade –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è –≤–∫–ª—é—á–µ–Ω–Ω—ã–º (ON)
4. –í—ã–∫–ª—é—á–∏—Ç–µ AutoTrade (OFF)
5. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
6. ‚úÖ AutoTrade –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–∫–ª—é—á–µ–Ω (OFF)

### –¢–µ—Å—Ç 2: –†–µ–∂–∏–º —Å–µ—Ç–∏ (Work/Test)
1. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ –Ω–∞ TEST
2. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
3. ‚úÖ –î–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è TEST
4. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ –Ω–∞ WORK
5. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
6. ‚úÖ –î–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è WORK

### –¢–µ—Å—Ç 3: –†–µ–∂–∏–º —Ç–æ—Ä–≥–æ–≤–ª–∏ (Trade/Copy)
1. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ –Ω–∞ COPY
2. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
3. ‚úÖ –î–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è COPY
4. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ –Ω–∞ TRADE
5. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
6. ‚úÖ –î–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è TRADE

### –¢–µ—Å—Ç 4: –í–∞–ª—é—Ç–Ω–∞—è –ø–∞—Ä–∞
1. –í—ã–±–µ—Ä–∏—Ç–µ –±–∞–∑–æ–≤—É—é –≤–∞–ª—é—Ç—É ETH
2. –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ç–∏—Ä–æ–≤–æ—á–Ω—É—é –≤–∞–ª—é—Ç—É USDC
3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
4. ‚úÖ –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã–±—Ä–∞–Ω–∞ –ø–∞—Ä–∞ ETH_USDC

### –¢–µ—Å—Ç 5: –†–∞–∑—Ä–µ—à–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤–ª–∏
1. –û—Ç–∫–ª—é—á–∏—Ç–µ —Ç–æ—Ä–≥–æ–≤–ª—é –¥–ª—è BTC (–∫—Ä–∞—Å–Ω–∞—è —Ç–æ—á–∫–∞)
2. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
3. ‚úÖ –¢–æ—Ä–≥–æ–≤–ª—è –¥–ª—è BTC –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω–∞
4. –í–∫–ª—é—á–∏—Ç–µ –æ–±—Ä–∞—Ç–Ω–æ
5. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
6. ‚úÖ –¢–æ—Ä–≥–æ–≤–ª—è –¥–ª—è BTC –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω–∞

### –¢–µ—Å—Ç 6: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏
1. –ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, steps=20, start_volume=5)
2. –ù–∞–∂–º–∏—Ç–µ "üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
4. ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. `mTrade.py` - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞
   - –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –∏–∑ state_manager –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏

2. `server_control_routes.py`
   - –û–±–Ω–æ–≤–ª–µ–Ω endpoint GET /api/ui/state

3. `state_manager.py` (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã

4. `app.js` (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
   - –£–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è

## –î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

12 –Ω–æ—è–±—Ä—è 2025 –≥.

## –°—Ç–∞—Ç—É—Å

‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û** - –í—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è UI —Ç–µ–ø–µ—Ä—å —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ —Å–µ—Ä–≤–µ—Ä–∞.
