# 📊 Стакан ордеров - Визуальный пример

## Текущая реализация (6 ноября 2025)

### Полный вид интерфейса

```
╔════════════════════════════════════════════════════════════╗
║              РЫНОК И СТАКАН: WLD/USDT                     ║
╠════════════════════════════════════════════════════════════╣
║  Текущая цена: 0.7134 USDT          ↑ +0.0045 (+0.63%)   ║
║  Объем 24ч: 15,234,567 USDT                               ║
║  Макс/Мин: 0.7250 / 0.7050                                ║
╠════════════════════════════════════════════════════════════╣
║  Баланс WLD:  123.45678912           ≈ $88.05            ║
║  Баланс USDT: 1,234.56               ≈ $1,234.56         ║
╠════════════════════════════════════════════════════════════╣
║  СТАКАН ОРДЕРОВ:                                          ║
║  ┌──────────┬────────┬────────┬──────────┐                ║
║  │ Цена     │ Кол-во │ Сумма  │ Σ Накоп. │                ║
║  │ (USDT)   │        │        │          │                ║
║  ├──────────┼────────┼────────┼──────────┤                ║
║  │ 0.71346  │ 150.25 │ 107.20 │ 107.20   │ ← ASKS       ║
║  │ 0.71345  │ 200.50 │ 143.05 │ 250.25   │ (Продажа)    ║
║  │ 0.71344  │  85.75 │  61.18 │ 311.43   │ КРАСНЫЕ      ║
║  │ 0.71343  │ 125.00 │  89.18 │ 400.61   │              ║
║  │ 0.71342  │  95.30 │  68.00 │ 468.61   │              ║
║  ├──────────┴────────┴────────┴──────────┤                ║
║  │  Спред: 0.00001 (0.0014%)             │                ║
║  ├──────────┬────────┬────────┬──────────┤                ║
║  │ 0.71341  │ 180.50 │ 128.76 │ 128.76   │              ║
║  │ 0.71340  │ 220.75 │ 157.50 │ 286.26   │ BIDS         ║
║  │ 0.71339  │ 165.25 │ 117.92 │ 404.18   │ (Покупка)    ║
║  │ 0.71338  │  90.00 │  64.20 │ 468.38   │ ЗЕЛЕНЫЕ      ║
║  │ 0.71337  │ 155.80 │ 111.14 │ 579.52   │              ║
║  └──────────┴────────┴────────┴──────────┘                ║
╚════════════════════════════════════════════════════════════╝
```

---

## Детальное описание колонок

### 1. **Цена (USDT)**
- **Формат**: Полная точность (все значащие цифры)
- **Функция**: `formatPrice(value)`
- **Примеры**:
  - `0.71345` - обычное число
  - `1,234.5678` - большое число с запятыми
  - `1.0000e-8` - очень маленькое число
- **Цвет**:
  - 🔴 Красный для ASKS (продажа)
  - 🟢 Зеленый для BIDS (покупка)

### 2. **Кол-во** (Количество базовой валюты)
- **Формат**: `amount.toFixed(2)` (2 знака)
- **Пример**: `150.25` (WLD)
- **Цвет**: 🔘 Серый (#999)

### 3. **Сумма** (Цена × Количество)
- **Формат**: `total.toFixed(2)` (2 знака)
- **Расчет**: `price × amount`
- **Пример**: `107.20` (USDT)
- **Цвет**: 🔘 Серый (#999)

### 4. **Σ Накоп.** (Накопительная сумма) ⭐ НОВАЯ
- **Формат**: `cumulativeTotal.toFixed(2)` (2 знака)
- **Расчет**: Сумма всех `total` от лучшей цены до текущей
- **Направление**:
  - **ASKS**: накопление снизу вверх (от лучшей цены продажи)
  - **BIDS**: накопление сверху вниз (от лучшей цены покупки)
- **Пример**: `400.61` (USDT)
- **Цвет**: 🔘 Темно-серый (#888), жирный шрифт
- **Применение**: Показывает общий объем ликвидности в USDT

---

## Примеры использования

### Сценарий 1: Покупка WLD на 500 USDT

**Ищем в BIDS колонку "Σ Накоп.":**
```
Цена     | Кол-во | Сумма  | Σ Накоп.
0.71341  | 180.50 | 128.76 | 128.76   ← недостаточно
0.71340  | 220.75 | 157.50 | 286.26   ← недостаточно
0.71339  | 165.25 | 117.92 | 404.18   ← недостаточно
0.71338  |  90.00 |  64.20 | 468.38   ← недостаточно
0.71337  | 155.80 | 111.14 | 579.52   ← достаточно! ✅
```

**Результат:**
- Потребуется объем до уровня **0.71337 USDT**
- Получим примерно **700 WLD** за **579.52 USDT**
- Средняя цена: **~0.71336 USDT**
- Проскальзывание: **~0.00004 USDT** (0.006%)

---

### Сценарий 2: Продажа 300 WLD

**Считаем количество в ASKS:**
```
Цена     | Кол-во | Сумма  | Σ Накоп.
0.71346  | 150.25 | 107.20 | 107.20   ← продали 150.25
0.71345  | 200.50 | 143.05 | 250.25   ← продали еще 149.75
                                        (всего 300 WLD) ✅
```

**Результат:**
- Продали **300 WLD** по двум уровням
- Получим примерно **214 USDT**
- Средняя цена: **~0.71333 USDT**
- Проскальзывание минимальное

---

## Интерактивность

### При наведении мыши (hover):
```
┌──────────────────────────────────────────────────┐
│ Tooltip:                                         │
│ Нажмите для выбора.                              │
│ Накопительно: 404.18 WLD ≈ 286.26 USDT         │
└──────────────────────────────────────────────────┘
```

### При клике:
- Автоматически заполняется форма торговли
- Выбирается цена и сторона (buy/sell)
- Показывается alert с деталями
- Прокрутка к форме торговли

---

## Визуальные эффекты

### Цветовая схема:
```
ASKS (Продажа):
┌────────────────────┐
│ 🔴 0.71346  150.25 │ ← Красная цена
│ 🔴 0.71345  200.50 │
│ 🔴 0.71344   85.75 │
└────────────────────┘

BIDS (Покупка):
┌────────────────────┐
│ 🟢 0.71341  180.50 │ ← Зеленая цена
│ 🟢 0.71340  220.75 │
│ 🟢 0.71339  165.25 │
└────────────────────┘
```

### При наведении:
```
┌────────────────────┐      ┌────────────────────┐
│ 0.71346  150.25    │  →   │ 🌟 0.71346  150.25 │ ← Подсветка
└────────────────────┘      └────────────────────┘
```

---

## Технические детали

### CSS Grid:
```css
grid-template-columns: 1fr 0.9fr 0.9fr 1fr;
```
- Цена: **1fr** (широкая колонка)
- Кол-во: **0.9fr** (узкая)
- Сумма: **0.9fr** (узкая)
- Накоп: **1fr** (широкая)

### Компактность:
```css
padding: 2px 5px;      /* малые отступы */
line-height: 1.3;      /* плотные строки */
font-size: 11px;       /* небольой шрифт */
```

### Высота:
```css
max-height: 250px;     /* 250px вместо 200px */
overflow-y: auto;      /* прокрутка при переполнении */
```

---

## Формат данных от API

### Запрос:
```http
GET /api/pair/data?base_currency=WLD&quote_currency=USDT
```

### Ответ:
```json
{
  "success": true,
  "pair": "WLD_USDT",
  "data": {
    "ticker": {
      "last": "0.7134",
      "change_percentage": "0.63",
      "high_24h": "0.7250",
      "low_24h": "0.7050",
      "volume": "15234567"
    },
    "orderbook": {
      "asks": [
        ["0.71346", "150.25"],
        ["0.71345", "200.50"],
        ["0.71344", "85.75"]
      ],
      "bids": [
        ["0.71341", "180.50"],
        ["0.71340", "220.75"],
        ["0.71339", "165.25"]
      ]
    }
  }
}
```

---

## Преимущества новой реализации

✅ **Визуальная ясность** - вся информация в одной таблице  
✅ **Контроль ликвидности** - сразу видно доступный объем  
✅ **Оценка проскальзывания** - можно рассчитать среднюю цену  
✅ **Компактность** - больше уровней на экране  
✅ **Точность** - правильное форматирование для каждого типа  
✅ **Интерактивность** - клик для выбора уровня  

---

## Сравнение: До vs После

### До (3 колонки):
```
Цена (USDT) | Количество (WLD) | Сумма (USDT)
0.71346000  | 150.25000000     | 107.20000000
```
❌ Много лишних нулей  
❌ Широкие колонки  
❌ Нет накопительной информации  

### После (4 колонки):
```
Цена    | Кол-во | Сумма  | Σ Накоп.
0.71346 | 150.25 | 107.20 | 107.20
```
✅ Оптимальное форматирование  
✅ Компактные колонки  
✅ Накопительная сумма для контроля  

---

**Обновлено:** 6 ноября 2025  
**Статус:** 🟢 Полностью реализовано и протестировано
