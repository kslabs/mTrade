# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –†–∞–∑–¥–µ–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç ‚ÜìŒî% –∏ ‚Üì%

## –î–∞—Ç–∞: 2025-01-XX
## –°—Ç–∞—Ç—É—Å: ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

---

## üìã –ü—Ä–æ–±–ª–µ–º–∞

–í –ª–æ–≥–∞—Ö –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –¥–≤–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–∞:
- **‚ÜìŒî%** (delta_percent)
- **‚Üì%** (total_drop_percent)

–ù–æ –æ–±–∞ —Å—á–∏—Ç–∞–ª–∏—Å—å –æ—Ç **—Å—Ç–∞—Ä—Ç–æ–≤–æ–π —Ü–µ–Ω—ã**, —á—Ç–æ –±—ã–ª–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
```python
# –ë–´–õ–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
delta_percent = ((executed_price - start_price) / start_price) * 100.0
total_drop_percent = abs(delta_percent)  # –ü—Ä–æ—Å—Ç–æ –º–æ–¥—É–ª—å –¥–µ–ª—å—Ç—ã
```

**–¢—Ä–µ–±—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
1. **‚ÜìŒî%** (delta_percent) ‚Äî –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç **–ü–û–°–õ–ï–î–ù–ï–ô** –ø–æ–∫—É–ø–∫–∏ (–ù–ï –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è)
2. **‚Üì%** (total_drop_percent) ‚Äî –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç **–°–¢–ê–†–¢–û–í–û–ô** –ø–æ–∫—É–ø–∫–∏ (–ù–ê–ö–ê–ü–õ–ò–í–ê–ï–¢–°–Ø)

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ä–∞—Å—á—ë—Ç –≤ `autotrader_v2.py`

**–§–∞–π–ª:** `c:\Users\–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä\Documents\bGate.mTrade\autotrader_v2.py`  
**–§—É–Ω–∫—Ü–∏—è:** `_try_rebuy()` ‚Üí –®–ê–ì 7 (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–∫—É–ø–∫–∏)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
# ‚úÖ –ù–û–í–ê–Ø –õ–û–ì–ò–ö–ê:
with lock:
    cycle = self.cycles[base]
    start_price = cycle.start_price          # –°—Ç–∞—Ä—Ç–æ–≤–∞—è —Ü–µ–Ω–∞ (–ø–µ—Ä–≤–∞—è –ø–æ–∫—É–ø–∫–∞ —Ü–∏–∫–ª–∞)
    last_buy_price = cycle.last_buy_price    # –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–∫—É–ø–∫–∞ (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–π –¥–æ–∫—É–ø–∫–µ)
    current_step = cycle.active_step

# ‚ÜìŒî% ‚Äî –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–∫—É–ø–∫–∏ (–ù–ï –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è)
if last_buy_price > 0:
    delta_percent = ((executed_price - last_buy_price) / last_buy_price) * 100.0
else:
    delta_percent = 0.0

# ‚Üì% ‚Äî –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –ø–æ–∫—É–ø–∫–∏ (–ù–ê–ö–ê–ü–õ–ò–í–ê–ï–¢–°–Ø)
if start_price > 0:
    total_drop_percent = ((executed_price - start_price) / start_price) * 100.0
else:
    total_drop_percent = 0.0
```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á—ë—Ç–∞

### –ü—Ä–∏–º–µ—Ä 1: –¶–∏–∫–ª —Å –¥–≤—É–º—è –¥–æ–∫—É–ø–∫–∞–º–∏

| –î–µ–π—Å—Ç–≤–∏–µ | –¶–µ–Ω–∞ | start_price | last_buy_price | ‚ÜìŒî% (–æ—Ç last) | ‚Üì% (–æ—Ç start) |
|----------|------|-------------|----------------|---------------|---------------|
| –°—Ç–∞—Ä—Ç    | 2.500 | 2.500 | 2.500 | 0.0% | 0.0% |
| –î–æ–∫—É–ø–∫–∞ 1 | 2.250 | 2.500 | 2.250 | **-10.0%** | **-10.0%** |
| –î–æ–∫—É–ø–∫–∞ 2 | 2.100 | 2.500 | 2.100 | **-6.67%** | **-16.0%** |

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- –î–æ–∫—É–ø–∫–∞ 1: ‚ÜìŒî% = (2.250 - 2.500) / 2.500 = **-10.0%**, ‚Üì% = (2.250 - 2.500) / 2.500 = **-10.0%**
- –î–æ–∫—É–ø–∫–∞ 2: ‚ÜìŒî% = (2.100 - 2.250) / 2.250 = **-6.67%**, ‚Üì% = (2.100 - 2.500) / 2.500 = **-16.0%**

---

### –ü—Ä–∏–º–µ—Ä 2: –¶–∏–∫–ª —Å –æ—Ç—Å–∫–æ–∫–æ–º –≤–≤–µ—Ä—Ö

| –î–µ–π—Å—Ç–≤–∏–µ | –¶–µ–Ω–∞ | start_price | last_buy_price | ‚ÜìŒî% (–æ—Ç last) | ‚Üì% (–æ—Ç start) |
|----------|------|-------------|----------------|---------------|---------------|
| –°—Ç–∞—Ä—Ç    | 2.500 | 2.500 | 2.500 | 0.0% | 0.0% |
| –î–æ–∫—É–ø–∫–∞ 1 | 2.200 | 2.500 | 2.200 | **-12.0%** | **-12.0%** |
| –î–æ–∫—É–ø–∫–∞ 2 | 2.300 | 2.500 | 2.300 | **+4.55%** | **-8.0%** |

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- –î–æ–∫—É–ø–∫–∞ 2: –¶–µ–Ω–∞ –≤—ã—Ä–æ—Å–ª–∞ –æ—Ç 2.200 –¥–æ 2.300
  - ‚ÜìŒî% = (2.300 - 2.200) / 2.200 = **+4.55%** (—Ü–µ–Ω–∞ –≤—ã—à–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–π!)
  - ‚Üì% = (2.300 - 2.500) / 2.500 = **-8.0%** (–≤—Å—ë –µ—â—ë –Ω–∏–∂–µ —Å—Ç–∞—Ä—Ç–∞)

---

## üîç –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### 1. **–°—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞** (—Å—Ç—Ä–æ–∫–∞ ~827)
```python
self.logger.log_buy(
    delta_percent=0.0,  # –î–ª—è —Å—Ç–∞—Ä—Ç–∞ –æ–±–∞ = 0
    total_drop_percent=0.0
)
```

### 2. **–î–æ–∫—É–ø–∫–∞** (—Å—Ç—Ä–æ–∫–∞ ~1075)
```python
self.logger.log_buy(
    delta_percent=delta_percent,           # ‚ÜìŒî% ‚Äî –æ—Ç last_buy_price
    total_drop_percent=total_drop_percent  # ‚Üì%  ‚Äî –æ—Ç start_price
)
```

### 3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ trade_logger.py**
```python
print(f"üü¢ Buy{{...–ö—É—Ä—Å:{price}; ‚ÜìŒî%:{delta_percent:.2f}; ‚Üì%:{total_drop_percent:.2f}; ...}}")
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

### –¢–µ—Å—Ç 1: –°—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞
- ‚úÖ delta_percent = 0.0
- ‚úÖ total_drop_percent = 0.0

### –¢–µ—Å—Ç 2: –î–æ–∫—É–ø–∫–∞ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏
- ‚úÖ delta_percent < 0 (—Ü–µ–Ω–∞ –Ω–∏–∂–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–∫—É–ø–∫–∏)
- ‚úÖ total_drop_percent < 0 (—Ü–µ–Ω–∞ –Ω–∏–∂–µ —Å—Ç–∞—Ä—Ç–∞)

### –¢–µ—Å—Ç 3: –î–æ–∫—É–ø–∫–∞ –ø—Ä–∏ –æ—Ç—Å–∫–æ–∫–µ –≤–≤–µ—Ä—Ö
- ‚úÖ delta_percent > 0 (—Ü–µ–Ω–∞ –≤—ã—à–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–∫—É–ø–∫–∏)
- ‚úÖ total_drop_percent < 0 (—Ü–µ–Ω–∞ –≤—Å—ë –µ—â—ë –Ω–∏–∂–µ —Å—Ç–∞—Ä—Ç–∞)

---

## üìù –ò—Ç–æ–≥

‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:**
1. ‚ÜìŒî% —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç **–ø–æ—Å–ª–µ–¥–Ω–µ–π** –ø–æ–∫—É–ø–∫–∏ (–ù–ï –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è)
2. ‚Üì% —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç **—Å—Ç–∞—Ä—Ç–æ–≤–æ–π** –ø–æ–∫—É–ø–∫–∏ (–ù–ê–ö–ê–ü–õ–ò–í–ê–ï–¢–°–Ø)
3. –õ–æ–≥–∏ —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç –æ–±–∞ –∑–Ω–∞—á–µ–Ω–∏—è
4. –õ–æ–≥–∏–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ git.
