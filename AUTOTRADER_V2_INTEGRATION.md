# üéØ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è AutoTraderV2 - –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

## üìÖ –î–∞—Ç–∞: 2024-01-XX

---

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û: –≠—Ç–∞–ø 1 - –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

#### 1. –§–∞–π–ª: `autotrader_v2.py`
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –°–æ–∑–¥–∞–Ω –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- ‚úÖ `CycleState` - Enum –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–π (IDLE/ACTIVE)
- ‚úÖ `TradingCycle` - dataclass –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ü–∏–∫–ª–∞
- ‚úÖ `AutoTraderV2` - –≥–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä–∞

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         AutoTraderV2                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                         ‚îÇ
‚îÇ  cycles: Dict[str, TradingCycle]       ‚îÇ  ‚Üê –°–æ—Å—Ç–æ—è–Ω–∏–µ –í –ü–ê–ú–Ø–¢–ò
‚îÇ  _locks: Dict[str, Lock]               ‚îÇ  ‚Üê Lock –Ω–∞ –≤–∞–ª—é—Ç—É
‚îÇ                                         ‚îÇ
‚îÇ  _main_loop()                          ‚îÇ  ‚Üê –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª
‚îÇ  _get_lock(base)                       ‚îÇ  ‚Üê –ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å
‚îÇ  _ensure_cycle(base)                   ‚îÇ  ‚Üê –°–æ–∑–¥–∞–Ω–∏–µ —Ü–∏–∫–ª–∞
‚îÇ                                         ‚îÇ
‚îÇ  get_status()                          ‚îÇ  ‚Üê API –¥–ª—è –≤–µ–±
‚îÇ  get_cycle_info(base)                  ‚îÇ  ‚Üê API –¥–ª—è –≤–µ–±
‚îÇ  get_all_cycles()                      ‚îÇ  ‚Üê API –¥–ª—è –≤–µ–±
‚îÇ                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–∏–Ω—Ü–∏–ø—ã:**
1. ‚úÖ **–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏** - –Ω–∏–∫–∞–∫–∏—Ö —Ñ–∞–π–ª–æ–≤, –Ω–∏–∫–∞–∫–∏—Ö –≥–æ–Ω–æ–∫
2. ‚úÖ **–ü—Ä–æ—Å—Ç–∞—è –º–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π** - IDLE ‚Üí ACTIVE ‚Üí IDLE
3. ‚úÖ **–û–¥–∏–Ω Lock –Ω–∞ –≤–∞–ª—é—Ç—É** - –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
4. ‚úÖ **–ù–∏–∫–∞–∫–∏—Ö –∑–∞–¥–µ—Ä–∂–µ–∫** - —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏–∫–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
5. ‚úÖ **API –¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–ß—Ç–æ –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–≠–¢–ê–ü 2):**
- ‚è≥ –°—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞ (`_try_start_cycle`)
- ‚è≥ –î–æ–∫—É–ø–∫–∞ (`_try_rebuy`)
- ‚è≥ –ü—Ä–æ–¥–∞–∂–∞ (`_try_sell`)

---

#### 2. –§–∞–π–ª: `mTrade.py`
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

**2.1. –ò–º–ø–æ—Ä—Ç—ã (—Å—Ç—Ä–æ–∫–∞ 27-31):**
```python
# –°–¢–ê–†–´–ô (DEPRECATED)
# from autotrader import AutoTrader
# from dual_thread_autotrader import DualThreadAutoTrader

# –ù–û–í–´–ô (V2)
from autotrader_v2 import AutoTraderV2
```

**2.2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (—Å—Ç—Ä–æ–∫–∞ ~1262):**
```python
# –ë–´–õ–û:
AUTO_TRADER = DualThreadAutoTrader(
    api_client_provider=_create_api_client,
    ws_manager=ws_manager,
    state_manager=state_manager,
    currencies=enabled_currencies,
    debounce_seconds=0.005,
    max_urgent_per_cycle=10
)
AUTO_TRADER.autotrader._load_cycles_state()

# –°–¢–ê–õ–û:
AUTO_TRADER = AutoTraderV2(
    api_client_provider=_create_api_client,
    ws_manager=ws_manager,
    state_manager=state_manager
)
```

**2.3. API-—Ä–æ—É—Ç—ã (—Å—Ç—Ä–æ–∫–∞ ~1330):**

**`/api/autotrader/stats` - –û–ë–ù–û–í–õ–Å–ù:**
```python
# –ù–æ–≤—ã–π API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ—Ç–æ–¥ get_cycle_info(base)
cycle_info = AUTO_TRADER.get_cycle_info(base_currency)
if cycle_info:
    stats.update({
        "state": cycle_info.get('state'),
        "active": cycle_info.get('active', False),
        ...
    })
```

**`/api/autotrader/reset_cycle` - –û–ë–ù–û–í–õ–Å–ù:**
```python
# –ê—Ç–æ–º–∞—Ä–Ω—ã–π —Å–±—Ä–æ—Å —á–µ—Ä–µ–∑ Lock
lock = AUTO_TRADER._get_lock(base_currency)
with lock:
    AUTO_TRADER._ensure_cycle(base_currency)
    cycle = AUTO_TRADER.cycles[base_currency]
    cycle.reset()  # –ü—Ä–æ—Å—Ç–æ–π –º–µ—Ç–æ–¥ —Å–±—Ä–æ—Å–∞
```

---

### üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç –≠—Ç–∞–ø–∞ 1

‚úÖ **–ö–∞—Ä–∫–∞—Å –≥–æ—Ç–æ–≤!**
- –ù–æ–≤—ã–π –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ mTrade.py
- API –æ–±–Ω–æ–≤–ª—ë–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
- –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–æ–∂–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Ü–∏–∫–ª–æ–≤
- –ì–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –≤–∞–ª—é—Ç—ã (–Ω–æ –Ω–µ —Ç–æ—Ä–≥—É–µ—Ç!)

‚ö†Ô∏è **–í–ê–ñ–ù–û: –¢–æ—Ä–≥–æ–≤–ª—è –ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞!**
–ê–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –Ω–æ —Ç–æ–ª—å–∫–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
–ù–∏–∫–∞–∫–∏—Ö –ø–æ–∫—É–ø–æ–∫/–ø—Ä–æ–¥–∞–∂ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç.

---

## üìã –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥: –≠—Ç–∞–ø 2

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤–æ–π –ª–æ–≥–∏–∫–∏

#### –ú–µ—Ç–æ–¥ 1: `_try_start_cycle(base, quote, cycle, price)`
**–ó–∞–¥–∞—á–∞:** –°—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞ (MARKET –æ—Ä–¥–µ—Ä)

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π:
   - –¶–∏–∫–ª –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ IDLE
   - –ù–∞ –±–∞–ª–∞–Ω—Å–µ –ù–ï–¢ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –æ–±—ä—ë–º–∞ BASE
   - –ü—Ä–æ—à–ª–æ N —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–¥–∞–∂–∏
2. –†–∞—Å—á—ë—Ç –æ–±—ä—ë–º–∞ –ø–æ–∫—É–ø–∫–∏ (–∏–∑ config)
3. MARKET –æ—Ä–¥–µ—Ä –Ω–∞ –ø–æ–∫—É–ø–∫—É
4. –ü–µ—Ä–µ—Ö–æ–¥ –≤ ACTIVE, —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã breakeven
5. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ö—Ä–∏—Ç–∏—á–Ω–æ:**
- ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ü–ï–†–ï–î –ø–æ–∫—É–ø–∫–æ–π
- ‚ö†Ô∏è –ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å (–≤—Å—ë –ø–æ–¥ Lock!)
- ‚ö†Ô∏è –ü–µ—Ä–µ—Ö–æ–¥ –≤ ACTIVE —Ç–æ–ª—å–∫–æ –ü–û–°–õ–ï —É—Å–ø–µ—à–Ω–æ–π –ø–æ–∫—É–ø–∫–∏

---

#### –ú–µ—Ç–æ–¥ 2: `_try_rebuy(base, quote, cycle, price)`
**–ó–∞–¥–∞—á–∞:** –î–æ–∫—É–ø–∫–∞ –ø—Ä–∏ –ø—Ä–æ—Å–∞–¥–∫–µ

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π:
   - –¶–∏–∫–ª –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ ACTIVE
   - –¶–µ–Ω–∞ —É–ø–∞–ª–∞ –¥–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—É–ø–µ–Ω–∏ breakeven
   - –ï—Å—Ç—å USDT –Ω–∞ –±–∞–ª–∞–Ω—Å–µ
2. –†–∞—Å—á—ë—Ç –æ–±—ä—ë–º–∞ –¥–æ–∫—É–ø–∫–∏ (–∏–∑ —Ç–∞–±–ª–∏—Ü—ã)
3. MARKET –æ—Ä–¥–µ—Ä –Ω–∞ –¥–æ–∫—É–ø–∫—É
4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã breakeven
5. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ö—Ä–∏—Ç–∏—á–Ω–æ:**
- ‚ö†Ô∏è –¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ –¥–æ–∫—É–ø–∫–∞ –∑–∞ —Ä–∞–∑
- ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ USDT
- ‚ö†Ô∏è –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã –ø–æ–∫—É–ø–∫–∏

---

#### –ú–µ—Ç–æ–¥ 3: `_try_sell(base, quote, cycle, price)`
**–ó–∞–¥–∞—á–∞:** –ü—Ä–æ–¥–∞–∂–∞ —Å –ø—Ä–æ—Ñ–∏—Ç–æ–º

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π:
   - –¶–∏–∫–ª –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ ACTIVE
   - –¶–µ–Ω–∞ –≤—ã—à–µ —Ç–æ—á–∫–∏ –±–µ–∑—É–±—ã—Ç–∫–∞ + % –ø—Ä–æ—Ñ–∏—Ç–∞
2. –ü—Ä–æ–¥–∞–∂–∞ –í–°–ï–ì–û –æ–±—ä—ë–º–∞ BASE (MARKET –æ—Ä–¥–µ—Ä)
3. –ü–µ—Ä–µ—Ö–æ–¥ –≤ IDLE (—Å–±—Ä–æ—Å —Ü–∏–∫–ª–∞)
4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏—Ç–∞

**–ö—Ä–∏—Ç–∏—á–Ω–æ:**
- ‚ö†Ô∏è –ü—Ä–æ–¥–∞–∂–∞ –í–°–ï–ì–û –æ–±—ä—ë–º–∞ (–Ω–∏–∫–∞–∫–∏—Ö —á–∞—Å—Ç–∏—á–Ω—ã—Ö!)
- ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ BASE –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∂–µ–π
- ‚ö†Ô∏è –°–±—Ä–æ—Å —Ü–∏–∫–ª–∞ –ü–û–°–õ–ï —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–æ–¥–∞–∂–∏

---

## üß™ –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–≠—Ç–∞–ø 3)

### –¢–µ—Å—Ç 1: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–µ–π —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –ø–æ–∫—É–ø–∫–∏
**–°—Ü–µ–Ω–∞—Ä–∏–π:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä
2. –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ-—Ç–æ—Ä–≥–æ–≤–ª—é –¥–ª—è BTC
3. –ü—Ä–æ–¥–∞—Ç—å BTC –≤—Ä—É—á–Ω—É—é (—Å–∏–º—É–ª—è—Ü–∏—è –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ü–∏–∫–ª–∞)
4. –ù–∞–±–ª—é–¥–∞—Ç—å —Å—Ç–∞—Ä—Ç–æ–≤—É—é –ø–æ–∫—É–ø–∫—É

**–û–∂–∏–¥–∞–Ω–∏–µ:**
- ‚úÖ –†–æ–≤–Ω–æ –û–î–ù–ê —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –ø–æ–∫—É–ø–∫–∞
- ‚úÖ –¶–∏–∫–ª –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ ACTIVE
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫

---

### –¢–µ—Å—Ç 2: Race condition –º–µ–∂–¥—É –∏—Ç–µ—Ä–∞—Ü–∏—è–º–∏
**–°—Ü–µ–Ω–∞—Ä–∏–π:**
1. –£–º–µ–Ω—å—à–∏—Ç—å `_sleep_interval` –¥–æ 0.1 —Å–µ–∫—É–Ω–¥—ã
2. –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ-—Ç–æ—Ä–≥–æ–≤–ª—é –¥–ª—è 10 –≤–∞–ª—é—Ç
3. –ü—Ä–æ–¥–∞—Ç—å –≤—Å–µ –≤–∞–ª—é—Ç—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
4. –ù–∞–±–ª—é–¥–∞—Ç—å —Å—Ç–∞—Ä—Ç–æ–≤—ã–µ –ø–æ–∫—É–ø–∫–∏

**–û–∂–∏–¥–∞–Ω–∏–µ:**
- ‚úÖ –ü–æ –æ–¥–Ω–æ–π —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –ø–æ–∫—É–ø–∫–µ –Ω–∞ –≤–∞–ª—é—Ç—É
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –¥—É–±–ª–µ–π
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –æ—à–∏–±–æ–∫ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

---

### –¢–µ—Å—Ç 3: –†—É—á–Ω–∞—è –ø–æ–∫—É–ø–∫–∞ —á–µ—Ä–µ–∑ Quick Trade
**–°—Ü–µ–Ω–∞—Ä–∏–π:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–∫—É–ø–∫—É BTC —á–µ—Ä–µ–∑ Quick Trade
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä –ù–ï –¥–µ–ª–∞–µ—Ç –¥—É–±–ª—å

**–û–∂–∏–¥–∞–Ω–∏–µ:**
- ‚úÖ –ê–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä –≤–∏–¥–∏—Ç –±–∞–ª–∞–Ω—Å BTC
- ‚úÖ –ù–ï –¥–µ–ª–∞–µ—Ç —Å—Ç–∞—Ä—Ç–æ–≤—É—é –ø–æ–∫—É–ø–∫—É
- ‚úÖ –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ü–∏–∫–ª–∞

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –°—Ç–∞—Ä—ã–π vs –ù–æ–≤—ã–π

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –°—Ç–∞—Ä—ã–π AutoTrader | –ù–æ–≤—ã–π AutoTraderV2 |
|----------|-------------------|---------------------|
| **–°–æ—Å—Ç–æ—è–Ω–∏–µ** | –§–∞–π–ª JSON | –ü–∞–º—è—Ç—å (—Å–ª–æ–≤–∞—Ä—å) |
| **–ú–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π** | 8+ —Å–æ—Å—Ç–æ—è–Ω–∏–π | 2 —Å–æ—Å—Ç–æ—è–Ω–∏—è (IDLE/ACTIVE) |
| **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å** | ‚ùå –ù–µ—Ç | ‚úÖ Lock –Ω–∞ –≤–∞–ª—é—Ç—É |
| **Race conditions** | ‚ùå –ï—Å—Ç—å | ‚úÖ –ù–µ—Ç |
| **–î—É–±–ª–∏—Ä—É—é—â–∏–µ –ø–æ–∫—É–ø–∫–∏** | ‚ùå –ï—Å—Ç—å | ‚úÖ –ù–µ—Ç (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ) |
| **–ó–∞–¥–µ—Ä–∂–∫–∏ (–∫–æ—Å—Ç—ã–ª–∏)** | ‚ùå 3+ —Å–µ–∫—É–Ω–¥—ã | ‚úÖ 0 —Å–µ–∫—É–Ω–¥ |
| **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∫–æ–¥–∞** | ‚ùå 2000+ —Å—Ç—Ä–æ–∫ | ‚úÖ 300 —Å—Ç—Ä–æ–∫ |
| **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** | ‚ùå –°–ª–æ–∂–Ω–æ | ‚úÖ –õ–µ–≥–∫–æ |
| **API –¥–ª—è –≤–µ–±–∞** | ‚ö†Ô∏è –ß–µ—Ä–µ–∑ –æ–±—ë—Ä—Ç–∫—É | ‚úÖ –ü—Ä—è–º–æ–π |

---

## üéì –í—ã–≤–æ–¥—ã

### –ß—Ç–æ –±—ã–ª–æ –Ω–µ —Ç–∞–∫ –≤ —Å—Ç–∞—Ä–æ–º –∫–æ–¥–µ:
1. ‚ùå **–°–ª–æ–∂–Ω–∞—è –º–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π** - –º–Ω–æ–≥–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π
2. ‚ùå **–ì–æ–Ω–∫–∏ —Å —Ñ–∞–π–ª–∞–º–∏** - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ JSON, race conditions
3. ‚ùå **–ó–∞–¥–µ—Ä–∂–∫–∏ –∫–∞–∫ –∫–æ—Å—Ç—ã–ª–∏** - sleep() –≤–º–µ—Å—Ç–æ –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏
4. ‚ùå **–ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏** - –¥—É–±–ª–∏ –∏–∑-–∑–∞ late check
5. ‚ùå **–ó–∞–ø—É—Ç–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞** - 2000+ —Å—Ç—Ä–æ–∫, —Ç—è–∂–µ–ª–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å

### –ß—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤ –Ω–æ–≤–æ–º –∫–æ–¥–µ:
1. ‚úÖ **–ü—Ä–æ—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - IDLE/ACTIVE, –≤—Å—ë –ø–æ–Ω—è—Ç–Ω–æ
2. ‚úÖ **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å** - Lock –Ω–∞ –≤–∞–ª—é—Ç—É, race condition –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω
3. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –¥–µ–π—Å—Ç–≤–∏–µ–º** - –Ω–µ—Ç –¥—É–±–ª–µ–π –ø–æ design
4. ‚úÖ **–ß–∏—Å—Ç—ã–π –∫–æ–¥** - 300 —Å—Ç—Ä–æ–∫, –ª–µ–≥–∫–æ —á–∏—Ç–∞—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
5. ‚úÖ **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ñ–∏—á–∏

---

## üìå –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫

### –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (‚úÖ –í–´–ü–û–õ–ù–ï–ù)
- [x] –°–æ–∑–¥–∞–Ω `autotrader_v2.py`
- [x] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ `mTrade.py`
- [x] –û–±–Ω–æ–≤–ª–µ–Ω—ã API-—Ä–æ—É—Ç—ã
- [x] –ü—Ä–æ–≤–µ—Ä–µ–Ω —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
- [x] –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –≠—Ç–∞–ø 2: –¢–æ—Ä–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ (‚è≥ –û–ñ–ò–î–ê–ù–ò–ï)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_try_start_cycle()`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_try_rebuy()`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_try_sell()`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### –≠—Ç–∞–ø 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (‚è≥ –û–ñ–ò–î–ê–ù–ò–ï)
- [ ] –¢–µ—Å—Ç: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–µ–π —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –ø–æ–∫—É–ø–∫–∏
- [ ] –¢–µ—Å—Ç: race condition –º–µ–∂–¥—É –∏—Ç–µ—Ä–∞—Ü–∏—è–º–∏
- [ ] –¢–µ—Å—Ç: —Ä—É—á–Ω–∞—è –ø–æ–∫—É–ø–∫–∞ —á–µ—Ä–µ–∑ Quick Trade
- [ ] –¢–µ—Å—Ç: –¥–æ–∫—É–ø–∫–∏ –∏ –ø—Ä–æ–¥–∞–∂–∏
- [ ] –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ live-–¥–∞–Ω–Ω—ã—Ö

---

## üöÄ –ó–∞–ø—É—Å–∫

**–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≠—Ç–∞–ø–∞ 2 (—Ç–æ—Ä–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞):**

1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–π —Å–µ—Ä–≤–µ—Ä:
   ```powershell
   python restart_server.bat
   ```

2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä:
   ```powershell
   python mTrade.py
   ```

3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ:
   - –°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "running")
   - –í–µ—Ä—Å–∏—è (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å "v2")
   - –¶–∏–∫–ª—ã –≤–∞–ª—é—Ç (–¥–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è)

4. –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ-—Ç–æ—Ä–≥–æ–≤–ª—é –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π –≤–∞–ª—é—Ç—ã

5. –ù–∞–±–ª—é–¥–∞—Ç—å –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

‚ö†Ô∏è **–í–ê–ñ–ù–û:** 
- –≠—Ç–∞–ø 1 –∑–∞–≤–µ—Ä—à—ë–Ω - –∫–∞—Ä–∫–∞—Å –≥–æ—Ç–æ–≤, –≤–µ–± —Ä–∞–±–æ—Ç–∞–µ—Ç
- –≠—Ç–∞–ø 2 - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç–æ—Ä–≥–æ–≤–ª–∏ (–µ—â—ë –Ω–µ –Ω–∞—á–∞—Ç)
- –ù–ï –≤–∫–ª—é—á–∞–π—Ç–µ –∞–≤—Ç–æ-—Ç–æ—Ä–≥–æ–≤–ª—é –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≠—Ç–∞–ø–∞ 2!

üìß **–í–æ–ø—Ä–æ—Å—ã:**
- –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –æ—à–∏–±–∫–∏, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
- –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å, –æ–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –∏ –ø—Ä–∏–ª–æ–∂–∏—Ç–µ –ª–æ–≥–∏

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2024-01-XX  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** –≠—Ç–∞–ø 1 –∑–∞–≤–µ—Ä—à—ë–Ω, –æ–∂–∏–¥–∞–Ω–∏–µ –≠—Ç–∞–ø–∞ 2
