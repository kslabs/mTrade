# üêõ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ë–ê–ì: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–¥–µ–Ω–∏—è —Ü–µ–Ω—ã –ø—Ä–∏ –¥–æ–∫—É–ø–∫–µ

**–î–∞—Ç–∞:** 2025-12-15  
**–°—Ç–∞—Ç—É—Å:** –ò–°–ü–†–ê–í–õ–ï–ù–û ‚úÖ

## –ü—Ä–æ–±–ª–µ–º–∞

–ê–≤—Ç–æ—Ç—Ä–µ–π–¥–µ—Ä —Å–æ–≤–µ—Ä—à–∞–ª –¥–æ–∫—É–ø–∫—É –ø—Ä–∏ **–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –ø–∞–¥–µ–Ω–∏–∏** —Ü–µ–Ω—ã.

### –ü—Ä–∏–º–µ—Ä (XRP5L):

```
[20:38:14] [XRP5L] Buy{9.9998; –ö—É—Ä—Å:0.0468; –®–∞–≥ 0}
[20:39:11] [XRP5L] Buy{13.7098; –ö—É—Ä—Å:0.0464; ‚ÜìŒî%:-0.85%; –®–∞–≥ 1}  ‚úÖ OK (-0.85% >= -0.73%)
[20:46:19] [XRP5L] Buy{18.7964; –ö—É—Ä—Å:0.0461; ‚ÜìŒî%:-0.65%; –®–∞–≥ 2}  ‚ùå –û–®–ò–ë–ö–ê (-0.65% < -0.86%)
```

**–û–∂–∏–¥–∞–ª–æ—Å—å:** –î–æ–∫—É–ø–∫–∞ –Ω–∞ —à–∞–≥–µ 2 —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ **>= -0.86%** –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø–æ–∫—É–ø–∫–∏.  
**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏:** –î–æ–∫—É–ø–∫–∞ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ **-0.65%**.

## –¢–∞–±–ª–∏—Ü–∞ GEOM –¥–ª—è XRP5L

| –®–∞–≥ | decrease_step_pct | –¢—Ä–µ–±—É–µ–º–æ–µ –ø–∞–¥–µ–Ω–∏–µ |
|-----|-------------------|-------------------|
| 0   | 0.00%            | -                 |
| 1   | -0.73%           | >= -0.73%         |
| 2   | -0.86%           | >= -0.86%         |
| 3   | -0.99%           | >= -0.99%         |

## –ü—Ä–∏—á–∏–Ω–∞ –±–∞–≥–∞

### –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥ (autotrader_v2.py, —Å—Ç—Ä–æ–∫–∞ ~1032):

```python
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!
if last_buy_price > 0 and decrease_step_pct != 0:
    min_price_for_real_drop = last_buy_price * (1 + decrease_step_pct / 100.0)
    actual_drop_pct = ((price - last_buy_price) / last_buy_price * 100)
    
    if price >= min_price_for_real_drop:  # ‚Üê –ë–ê–ì –ó–î–ï–°–¨!
        print(f"–†–µ–∞–ª—å–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ!")
        return
```

### –ü–æ—á–µ–º—É —ç—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ?

**–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á—ë—Ç–∞ –¥–ª—è —à–∞–≥–∞ 2:**
- `last_buy_price` = 0.0464 (—à–∞–≥ 1)
- `decrease_step_pct` = -0.86% (—Ç—Ä–µ–±—É–µ–º–æ–µ –ø–∞–¥–µ–Ω–∏–µ –¥–ª—è —à–∞–≥–∞ 2)
- `min_price_for_real_drop` = 0.0464 * (1 + (-0.86) / 100) = 0.0464 * 0.9914 = **0.046001**

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ —Ü–µ–Ω–µ 0.0461:**
```python
if 0.0461 >= 0.046001:  # ‚Üê FALSE!
    # –ë–ª–æ–∫–∏—Ä—É–µ–º –¥–æ–∫—É–ø–∫—É
```

–£—Å–ª–æ–≤–∏–µ **–ù–ï —Å—Ä–∞–±–æ—Ç–∞–ª–æ** (`0.0461 < 0.046001`), –ø–æ—ç—Ç–æ–º—É –¥–æ–∫—É–ø–∫–∞ –ø—Ä–æ—à–ª–∞!

**–ù–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–∞–¥–µ–Ω–∏–µ:**
```
(0.0461 - 0.0464) / 0.0464 * 100 = -0.647%
```

**-0.647% < -0.86%** (–ø–æ –º–æ–¥—É–ª—é: 0.647 < 0.86) ‚Äî **–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ!**

### –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã:

–£—Å–ª–æ–≤–∏–µ `if price >= min_price` **–ø–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç–æ**!

–î–ª—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤:
- –ï—Å–ª–∏ `decrease_step_pct = -0.86%`, —Ç–æ –Ω—É–∂–Ω–æ —á—Ç–æ–±—ã **—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–∞–¥–µ–Ω–∏–µ –±—ã–ª–æ <= -0.86%**
- –¢–æ –µ—Å—Ç—å `actual_drop_pct <= decrease_step_pct` (–æ–±–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ)

–ù–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ `price >= min_price` **–Ω–µ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–∞** –ø—Ä–æ–≤–µ—Ä–∫–µ —á–µ—Ä–µ–∑ –ø—Ä–æ—Ü–µ–Ω—Ç—ã!

## –†–µ—à–µ–Ω–∏–µ

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥:

```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û!
if last_buy_price > 0 and decrease_step_pct != 0:
    # –í—ã—á–∏—Å–ª—è–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–∞–¥–µ–Ω–∏–µ –æ—Ç last_buy_price
    actual_drop_pct = ((price - last_buy_price) / last_buy_price) * 100.0
    
    print(f"  –¢—Ä–µ–±—É–µ–º–æ–µ –ø–∞–¥–µ–Ω–∏–µ: {decrease_step_pct:.2f}%")
    print(f"  –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–∞–¥–µ–Ω–∏–µ: {actual_drop_pct:.2f}%")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–∞–¥–µ–Ω–∏–µ >= —Ç—Ä–µ–±—É–µ–º–æ–≥–æ
    # –î–ª—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö: -0.86% >= -0.73% –æ–∑–Ω–∞—á–∞–µ—Ç -0.86 < -0.73 (–ø–æ –º–æ–¥—É–ª—é –±–æ–ª—å—à–µ)
    # –ü–æ—ç—Ç–æ–º—É: actual_drop_pct <= decrease_step_pct
    if actual_drop_pct > decrease_step_pct:
        print(f"‚ùå –†–µ–∞–ª—å–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ!")
        print(f"  –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ: {actual_drop_pct:.2f}% > –¢—Ä–µ–±—É–µ–º–æ–µ: {decrease_step_pct:.2f}%")
        return
    
    print(f"‚úÖ –£—Å–ª–æ–≤–∏–µ 2: –†–µ–∞–ª—å–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ")
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞:

**–®–∞–≥ 2 (XRP5L):**
- `last_buy_price` = 0.0464
- `decrease_step_pct` = -0.86%
- `price` = 0.0461
- `actual_drop_pct` = (0.0461 - 0.0464) / 0.0464 * 100 = **-0.647%**

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```python
if -0.647 > -0.86:  # ‚Üê TRUE! (-0.647 –±–æ–ª—å—à–µ -0.86)
    print("–ü–∞–¥–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ!")
    return  # –ë–ª–æ–∫–∏—Ä—É–µ–º –¥–æ–∫—É–ø–∫—É!
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î–æ–∫—É–ø–∫–∞ **–ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–ê** ‚úÖ

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ

```
last_buy_price = 0.0464
decrease_step_pct = -0.86%
price = 0.0460

actual_drop_pct = (0.0460 - 0.0464) / 0.0464 * 100 = -0.862%

–ü—Ä–æ–≤–µ—Ä–∫–∞: -0.862 > -0.86? ‚Üí FALSE (–ø–æ –º–æ–¥—É–ª—é: 0.862 >= 0.86)
–†–µ–∑—É–ª—å—Ç–∞—Ç: –î–æ–∫—É–ø–∫–∞ –†–ê–ó–†–ï–®–ï–ù–ê ‚úÖ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ (–±–∞–≥)

```
last_buy_price = 0.0464
decrease_step_pct = -0.86%
price = 0.0461

actual_drop_pct = (0.0461 - 0.0464) / 0.0464 * 100 = -0.647%

–ü—Ä–æ–≤–µ—Ä–∫–∞: -0.647 > -0.86? ‚Üí TRUE (–ø–æ –º–æ–¥—É–ª—é: 0.647 < 0.86)
–†–µ–∑—É–ª—å—Ç–∞—Ç: –î–æ–∫—É–ø–∫–∞ –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–ê ‚úÖ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ!)
```

## –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–π —Ñ–∞–π–ª

`autotrader_v2.py`, —Ñ—É–Ω–∫—Ü–∏—è `_try_rebuy()`, —Å—Ç—Ä–æ–∫–∏ ~1032-1048

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:

```powershell
# –°–ª–µ–¥–∏–º –∑–∞ –ª–æ–≥–∞–º–∏ –¥–æ–∫—É–ø–∫–∏
Get-Content server_debug.log -Wait | Select-String -Pattern "BLOCK_2|–†–µ–∞–ª—å–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ|–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–∞–¥–µ–Ω–∏–µ"
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –¥–æ–∫—É–ø–∫–∏ —Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º –ø–∞–¥–µ–Ω–∏–µ–º:

```
[XRP5L] üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –î–û–ö–£–ü–ö–ò (—à–∞–≥ 2):
[XRP5L]   Last buy price: 0.04640000
[XRP5L]   –¢—Ä–µ–±—É–µ–º–æ–µ –ø–∞–¥–µ–Ω–∏–µ: -0.86%
[XRP5L]   –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø–∞–¥–µ–Ω–∏–µ: -0.65%
[XRP5L] ‚ùå [BLOCK_2] –†–µ–∞–ª—å–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ! –î–æ–∫—É–ø–∫–∞ –û–¢–ú–ï–ù–ï–ù–ê
[XRP5L]   –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ: -0.65% > –¢—Ä–µ–±—É–µ–º–æ–µ: -0.86%
[XRP5L]   (–ü–æ –º–æ–¥—É–ª—é: |‚àí0.65| < |‚àí0.86|)
```

## –í–ª–∏—è–Ω–∏–µ –Ω–∞ —Ç–æ—Ä–≥–æ–≤–ª—é

### ‚ùå –î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- –î–æ–∫—É–ø–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∏ **—Ä–∞–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏**
- –°—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞ —Ä–æ—Å–ª–∞ **–±—ã—Å—Ç—Ä–µ–µ**
- **–ú–µ–Ω—å—à–µ –∑–∞—â–∏—Ç–∞** –æ—Ç –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –ø–∞–¥–µ–Ω–∏—è
- –¢–∞–±–ª–∏—Ü–∞ GEOM **–Ω–µ —Å–æ–±–ª—é–¥–∞–ª–∞—Å—å**

### ‚úÖ –ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- –î–æ–∫—É–ø–∫–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ **–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –ø–∞–¥–µ–Ω–∏–∏**
- –°—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞ —Ä–∞—Å—Ç—ë—Ç **–ø–æ –ø–ª–∞–Ω—É**
- **–ë–æ–ª—å—à–µ –∑–∞—â–∏—Ç–∞** –æ—Ç –ø–∞–¥–µ–Ω–∏—è (–±–æ–ª—å—à–∏–π –∑–∞–ø–∞—Å –ø–æ —à–∞–≥–∞–º)
- –¢–∞–±–ª–∏—Ü–∞ GEOM **—Å—Ç—Ä–æ–≥–æ —Å–æ–±–ª—é–¥–∞–µ—Ç—Å—è**

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. ‚úÖ **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä** –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
2. üß™ **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (—Å–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏)
3. üìä **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å** –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ü–∏–∫–ª—ã –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç —Ä–∞–Ω–Ω–∏—Ö –¥–æ–∫—É–ø–æ–∫
4. üìù **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å** –ª—é–±—ã–µ –∞–Ω–æ–º–∞–ª—å–Ω—ã–µ –¥–æ–∫—É–ø–∫–∏

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `_try_sell()` (–ø—Ä–æ–¥–∞–∂–∞)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ `target_delta_pct` (–ø—Ä–æ—Ñ–∏—Ç)
- ‚úÖ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

---

**–ê–≤—Ç–æ—Ä:** GitHub Copilot  
**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 2025-12-15  
**–°—Ç–∞—Ç—É—Å:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–∞–≥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
